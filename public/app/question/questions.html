<script>
    $(document).ready(function () {

        $('.dropdown-menu input, .dropdown-menu label, .dropdown-menu li a, .dr').click(function (e) {
            e.stopPropagation();
        });

    });
</script>

<div id="sitnet-header" class="header">
    <div class="col-md-12 header-wrapper">
        <span class="header-text">{{'sitnet_questions_all' | translate}}</span>
    </div>
</div>

<div id="dashboard">
    <!-- toolbar -->
    <div class="main-row">
        <div class="col-md-12">
            <span class="pull-left fa-stack fa-lg header-top-icon">
                <i class="fa sitnet-text-theme fa-stop fa-stack-2x"></i>
                <i class="fa sitnet-white fa-list-ol fa-stack-1x"></i>
            </span>
            <div class="dropdown" uib-dropdown>
                <a uib-dropdown-toggle class="header-top-link dropdown-toggle" data-toggle="dropdown">
                    {{'sitnet_toolbar_new_question' | translate}}
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li role="presentation">
                        <a role="menuitem" ng-click="createQuestion('MultipleChoiceQuestion')" class="pointer">{{'sitnet_toolbar_multiplechoice_question'
                            | translate}}</a>
                        <a role="menuitem" ng-click="createQuestion('EssayQuestion')" class="pointer">{{'sitnet_toolbar_essay_question'
                            | translate}}</a>
                        <a role="menuitem" ng-click="createQuestion('WeightedMultipleChoiceQuestion')" class="pointer">{{'sitnet_toolbar_weighted_multiplechoice_question'
                            | translate}}</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- filter form -->
    <div class="detail-row">
        <div class="col-md-4">
            <label for="filters">{{'sitnet_search' | translate}}</label>

            <div id="filters" class="form-group">
                <span class="dropdown" uib-dropdown>
                    <button uib-dropdown-toggle class="btn btn-default dropdown-toggle" type="button" id="dropDownMenu1"
                            data-toggle="dropdown" aria-expanded="true" ng-click="listCourses()">
                        {{'sitnet_course' | translate}}&nbsp;<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" style="padding-left: 0; min-width: 17em" role="menu"
                        aria-labelledby="dropDownMenu1">
                        <li role="presentation" class="input-group">
                            <input ng-model="limitations.courses" type="text" class="form-control"
                                   placeholder="{{'sitnet_search' | translate }}">

                            <div class="input-group-addon">
                                <i class="fa fa-search fa-fw"></i>
                            </div>
                        </li>
                        <li ng-repeat="course in courses | filter:limitations.courses" ng-hide='course.filtered'
                            role="presentation"
                            ng-click="applyFilter(course)">
                            <a role="menuitem">{{course.name | truncate:30}}</a>
                        </li>
                    </ul>
                </span>
                <span class="dropdown" uib-dropdown>
                    <button uib-dropdown-toggle class="btn btn-default dropdown-toggle" type="button" id="dropDownMenu2"
                            data-toggle="dropdown" aria-expanded="true" ng-click="listExams()">
                        {{'sitnet_exam' | translate}}&nbsp;<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-left" style="padding-left: 0; min-width: 17em" role="menu"
                        aria-labelledby="dropDownMenu2">
                        <li role="presentation" class="input-group">
                            <input ng-model="limitations.exams" type="text" class="form-control"
                                   placeholder="{{'sitnet_search' | translate }}">

                            <div class="input-group-addon">
                                <i class="fa fa-search fa-fw"></i>
                            </div>
                        </li>
                        <li ng-repeat="exam in exams | filter:limitations.exams" ng-hide='exam.filtered'
                            role="presentation"
                            ng-click="applyFilter(exam)">
                            <a role="menuitem">{{exam.name | truncate:30}}</a>
                        </li>
                    </ul>
                </span>

                <span class="dropdown" uib-dropdown>
                    <button uib-dropdown-toggle class="btn btn-default dropdown-toggle" type="button" id="dropDownMenu3"
                            data-toggle="dropdown" aria-expanded="true" ng-click="listTags()">
                        {{'sitnet_category' | translate}}&nbsp;<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" style="padding-left: 0; min-width: 17em" role="menu"
                        aria-labelledby="dropDownMenu3">
                        <li role="presentation" class="input-group">
                            <input ng-model="limitations.tags" type="text" class="form-control"
                                   placeholder="{{'sitnet_search' | translate }}">

                            <div class="input-group-addon">
                                <i class="fa fa-search fa-fw"></i>
                            </div>
                        </li>
                        <li ng-repeat="tag in tags | filter:limitations.tags" ng-hide='tag.filtered' role="presentation"
                            ng-click="applyFilter(tag)">
                            <a role="menuitem" ng-class="tag.isSectionTag ? 'text-dim' : 'text'"
                               title="{{tag.isSectionTag ? 'sitnet_exam_section' : 'sitnet_category' | translate; }}">
                                {{tag.name | truncate:30}}
                            </a>
                        </li>
                    </ul>
                </span>
            </div>
        </div>
        <div class="col-md-4">
            <label for="freesearch">{{'sitnet_search_by_question_text' | translate }}</label>
            <div id="freesearch" class="form-group input-group">
                <input ng-change="applyFreeSearchFilter()" ng-model="filter.text" type="text" class="form-control"
                       placeholder="{{'sitnet_search' | translate }}">

                <div class="input-group-addon">
                    <i class="fa fa-search fa-fw"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4" ng-if="user.isAdmin">
            <label for="ownerSearch">{{'sitnet_search_by_owner' | translate }}</label>
            <div id="ownerSearch" class="form-group input-group">
                <input ng-change="applyOwnerSearchFilter()" ng-model="filter.owner" type="text" class="form-control"
                       placeholder="{{'sitnet_search' | translate }}">

                <div class="input-group-addon">
                    <i class="fa fa-search fa-fw"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="detail-row content-group">
        <div class="col-md-12 row">
            <ul class="inline-list">
                <li>
                    <button ng-repeat='tag in getTags()' type='button'
                            ng-click="applyFilter(tag)" class="btn btn-primary btn-xs" style="margin: 0.2em">
                        {{tag.name}}
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="detail-row">
        <div id="question-listing" class="col-md-12">
            <table class="table table-striped table-condensed questions-table">
                <thead>
                <tr>
                    <th>
                        <input type="checkbox" name="select_all" class="selectAllQuestions"
                               ng-click="selectAll('selectAllQuestions', 'questionToUpdate')" popover-placement="top"
                               popover-trigger="mouseenter" uib-popover="{{ 'sitnet_check_uncheck_all' | translate }}"/>
                    </th>
                    <th colspan="2" sort by="id" text="sitnet_question" predicate="questionsPredicate" reverse="reverse"></th>
                    <th sort by="modified" text="sitnet_modified" predicate="questionsPredicate" reverse="reverse"></th>
                    <th sort by="displayedMaxScore" text="sitnet_max_score" predicate="questionsPredicate" reverse="reverse"></th>
                    <th sort by="typeOrd" text="sitnet_question_type" predicate="questionsPredicate" reverse="reverse"></th>
                    <th sort by="attachment.fileName" text="sitnet_attachment" predicate="questionsPredicate" reverse="reverse"></th>
                    <th ng-show="user.isAdmin" sort by="ownerAggregate" text="sitnet_owner" predicate="questionsPredicate" reverse="reverse"></th>
                    <th>{{ 'sitnet_copy' | translate }}</th>
                    <th>{{ 'sitnet_exam_remove' | translate }}</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="question in filteredQuestions | orderBy: questionsPredicate:reverse | offset: currentPage*pageSize | limitTo: pageSize">
                    <td>
                        <input type="checkbox" class="questionToUpdate" value="{{question.id}}"/>
                    </td>
                    <td>
                        <a href="/questions/{{question.id}}">{{question.id}}</a>
                    </td>
                    <td>
                        <span ng-if="question.question" mathjax ng-bind-html="question.question | truncate: 360"></span>
                        <span ng-if="!question.question" class="text-danger">
                            {{'sitnet_no_name' | translate}}
                        </span>
                    </td>
                    <td>
                        <span ng-if="question.modified" class="timestamp">{{question.modified | date:'dd.MM.yyyy HH:mm'}}</span>
                    </td>
                    <td>{{ question.displayedMaxScore | translate}}</td>
                    <td>
                        <span ng-if="question.type === 'MultipleChoiceQuestion'">{{ 'sitnet_question_mc' | translate }}</span>
                        <span ng-if="question.type === 'WeightedMultipleChoiceQuestion'">{{ 'sitnet_question_weighted_mc' | translate}}</span>
                        <span ng-if="question.type === 'EssayQuestion'">{{ 'sitnet_essay' | translate }}</span>
                    </td>
                    <td ng-controller="AttachmentController">
                        <a ng-if="question.attachment" class="pointer" ng-click="downloadQuestionAttachment(question)">{{
                            question.attachment.fileName }}
                        </a>
                    </td>
                    <td ng-if="user.isAdmin">
                        <span>{{question.creator.firstName}} {{question.creator.lastName}}</span>
                        <span ng-if="question.creator.userIdentifier">&nbsp;({{question.creator.userIdentifier}})</span>
                        <span><br/><a href="mailto:{{question.creator.email}}">{{question.creator.email}}</a></span>
                    </td>
                    <td>
                        <a class="bold-button" ng-click="copyQuestion(question)"><i
                                class="fa fa-lg fa-copy text-info"></i></a>
                    </td>
                    <td>
                        <i ng-if="!question.allowedToRemove" class="fa fa-lg fa-times text-muted" title="{{'sitnet_question_removal_disallowed' | translate}}"></i>
                        <a class="bold-button" ng-if="question.allowedToRemove" ng-click="deleteQuestion(question)">
                            <i  class="fa fa-lg fa-times sitnet-red"></i>
                        </a>
                    </td>
                </tr>
                <!--Fill if page not full-->
                <tr ng-repeat="r in [] | pagefill: filteredQuestions.length:currentPage:pageSize">
                    <td colspan="9">&nbsp;</td>
                    <td ng-if="user.isAdmin"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="detail-row">
        <div col-md-12 ng-show="filteredQuestions.length > pageSize">
            <paginator items="filteredQuestions" page-size="pageSize" current-page="currentPage"/>
        </div>
    </div>

    <div class="main-row">
        <div class="col-md-4">
            <div class="input-group">
                <input type="text" class="form-control ng-pristine ng-valid"
                       ng-model="newTeacher"
                       placeholder="{{'sitnet_add_question_owner' | translate}}"
                       uib-typeahead="t as t.name for t in teachers | filter:$viewValue | limitTo:8"
                       typeahead-on-select="onTeacherSelect($item, $model, $label, newExam)"
                       typeahead-wait-ms="100"
                       typeahead-focus-first="false"
                       typeahead-min-length="2"
                       typeahead-loading="teachersLoad">
                           <span class="input-group-addon">
                                <i class="fa fa-question-circle fa-fw"
                                   popover-placement="left"
                                   popover-trigger="mouseenter"
                                   uib-popover="{{'sitnet_name' | translate}}"></i>
                           </span>
            </div>
        </div>
        <div class="col-md-2 bottom-padding-2">
            <input type="button" class="btn btn-primary" ng-disabled="ownerProcess" ng-click="addOwnerForSelected()"
                   value="{{'sitnet_add' | translate}}"/>
        </div>
    </div>
</div>
