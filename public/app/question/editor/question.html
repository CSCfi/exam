<div ng-controller="QuestionCtrl">

    <div id="sitnet-header" class="header">
        <div class="header-wrapper col-md-7">
            <div ng-show="newQuestion.state == 'NEW' ? true : false">
                <span ng-show="newQuestion.type == 'EssayQuestion'"
                      class="header-text">{{'sitnet_questions_new_essay' | translate}}</span>
                <span ng-show="newQuestion.type == 'MultipleChoiceQuestion'"
                      class="header-text">{{'sitnet_questions_new_multiplechoice' | translate}}</span>
                <span ng-show="newQuestion.type == 'WeightedMultipleChoiceQuestion'"
                      class="header-text">{{'sitnet_questions_new_weighted_multiplechoice' | translate}}</span>
            </div>
            <span ng-hide="newQuestion.state == 'NEW' ? true : false" class="header-text">{{'sitnet_questions_edit' | translate}}</span>
        </div>
        <div class="header-wrapper col-md-5" ng-show="newQuestion.state == 'NEW' ? true : false">
            <a ng-click="deleteQuestion(newQuestion)" class="pull-right btn btn-primary btn-lg active header-button">
                {{'sitnet_button_cancel' | translate}} </a>
        </div>
    </div>

    <div id="dashboard">
        <div class="main-row">
            <div class="col-md-12 top-margin-1">
                <form role="form" class="form-horizontal" name="questionForm" novalidate>
                    <!-- Question editor -->
                    <div class="form-group">
                        <label for="editor" ng-show="newQuestion && !newQuestion.question">
                            <span class="text-danger">{{ 'sitnet_write_question_below' | translate }}</span>
                        </label>
                        <textarea id="editor" name="editor" ck-editor rows="10" cols="80" ng-model="newQuestion.question"
                                  ui-change="updateQuestion()" required>
                        </textarea>
                    </div>

                    <!-- Type specific content -->
                    <div class="top-margin-1" ng-include="questionTemplate"></div>

                    <!-- Evaluation type -->
                    <div class="row">
                        <div class="form-group col-md-3" ng-show="newQuestion.type == 'EssayQuestion'">
                            <label class="sitnet-info-text" for="evaluationType">{{'sitnet_evaluation_type' |
                                translate}}</label>
                            <select id="evaluationType" class="form-control" ng-model="newQuestion.evaluationType"
                                    ng-change="updateEvaluationType()"
                                    ng-required="newQuestion.type == 'EssayQuestion'">
                                <option value="Points">{{ 'sitnet_word_points' | translate }}</option>
                                <option value="Select">{{ 'sitnet_evaluation_select' | translate }}</option>
                            </select>
                        </div>
                    </div>

                    <!-- Max score -->
                    <div class="row">
                        <div class="form-group col-md-3"
                             ng-show="newQuestion.type == 'MultipleChoiceQuestion' ||
                                      newQuestion.evaluationType == 'Points'">
                            <label class="sitnet-info-text" for="maxScore">{{'sitnet_max_score' | translate}}</label>
                            <label ng-hide="questionForm.maxScore.$valid" class="text-danger">
                                {{ 'sitnet_positive_integer_required' | translate }}
                            </label>
                            <input id="maxScore" name="maxScore" type="text" class="col-md-2 form-control"
                                   ui-change="updateQuestion()"
                                   ng-model="newQuestion.maxScore"
                                   ng-pattern="/^([1-9][0-9]*)$/"
                                   ng-required="newQuestion.evaluationType=='Points'"
                                    />
                        </div>
                    </div>

                    <!-- New tag -->
                    <div class="row" ng-show="!newQuestion.parent">
                        <div class="form-group col-md-3">
                            <label class="sitnet-info-text" for="newTag">{{'sitnet_tag_question' | translate}}</label>
                            <div ng-controller="TagTypeaheadCtrl">
                                <input id="newTag" name="newTag" type="text" maxlength="30" lowercase class="form-control"
                                       ng-model="newQuestion.newTag"
                                       typeahead-on-select="onTagSelect($item, newQuestion)"
                                       typeahead="t as t.name for t in getTags($viewValue, newQuestion)"
                                       typeahead-min-length="2"/>
                            </div>
                        </div>
                    </div>

                    <!-- Categories -->
                    <div class="form-group">
                        <label class="sitnet-info-text" for="metaInfo">{{'sitnet_question_metainfo' | translate}}</label>

                        <div id="metaInfo">
                            <div class="row">
                                <div class="col-md-2 sitnet-info-text-compact">{{'sitnet_added_to_exams' | translate}}:
                                </div>
                                <div class="col-md-10">
                                    <div ng-repeat="name in examNames">
                                        <span class="sitnet-badge pull-left inline">{{ name }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2 sitnet-info-text-compact">{{'sitnet_added_to_sections' | translate}}:
                                </div>
                                <div class="col-md-10">
                                    <div ng-repeat="name in sectionNames">
                                        <span class="sitnet-badge pull-left inline">{{ name }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2 sitnet-info-text-compact">{{'sitnet_added_to_categories' | translate}}:
                                </div>
                                <div ng-show="newQuestion.parent" class="col-md-10">
                                    <div ng-repeat="tag in newQuestion.parent.tags">
                                        <span class="sitnet-badge pull-left inline">
                                            {{ tag.name }}
                                        </span>
                                    </div>
                                </div>
                                <div ng-hide="newQuestion.parent" class="col-md-10">
                                    <div ng-repeat="tag in newQuestion.tags">
                                        <span class="pointer sitnet-badge pull-left inline"
                                              popover-placement="top" popover-popup-delay="500" popover-trigger="mouseenter"
                                              popover="{{ 'sitnet_remove' | translate }}" ng-click="removeTag(tag)">
                                            {{ tag.name }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="form-group">
                        <label class="sitnet-info-text" for="instruction">{{'sitnet_question_instruction' |
                            translate}}</label>
                        <textarea id="instruction" class="form-control" rows="3" ng-model="newQuestion.instruction"
                                  ui-change="updateQuestion()" placeholder="{{'sitnet_question_instruction' | translate}}">
                        </textarea>
                    </div>

                    <!-- Evaluation criteria -->
                    <div ng-show="newQuestion.type == 'EssayQuestion'" class="form-group">
                        <label class="sitnet-info-text" for="evaluationCriteria">{{'sitnet_exam_evaluation_criteria' |
                            translate}}</label>
                        <textarea id="evaluationCriteria" class="form-control" rows="3"
                                  ng-model="newQuestion.evaluationCriterias"
                                  ui-change="updateQuestion()" placeholder="{{'sitnet_question_instruction' | translate}}">
                        </textarea>
                    </div>

                    <!-- Attachment -->
                    <div ng-controller="AttachmentController" class="form-group">
                        <label class="sitnet-info-text" for="attachment">{{ 'sitnet_question_attachment' | translate
                            }}</label>

                        <div id="attachment">
                            <div ng-show="newQuestion.attachment">
                                <a class="pointer" ng-click="downloadQuestionAttachment(newQuestion)">{{
                                    newQuestion.attachment.fileName }}</a>
                                <span class="sitnet-red pointer" ng-click="removeQuestionAttachment(newQuestion)">
                                    <i class="fa fa-times" title="{{'sitnet_remove_attachment' | translate }}"></i>
                                </span>
                            </div>
                            <button type="button" ng-click="selectFile()" class="btn btn-default btn-sm">{{ 'sitnet_attach_file' |
                                translate }}
                            </button>
                        </div>
                    </div>

                </form>
            </div>
        </div>

        <div class="main-row">
            <div class="col-md-12">
                <button ng-disabled="!questionForm.$valid" ng-click="saveQuestion()"
                        type="submit" class="btn btn-success">{{'sitnet_save' | translate}}
                </button>
            </div>
        </div>

    </div>
</div>
