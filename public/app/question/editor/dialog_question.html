<div id="dashboard" ng-controller="ExamSectionQuestionCtrl">

    <div class="top-row">
        <div class="col-md-12">
            <div class="student-details-title-wrap" ng-hide="newQuestion.id">
                <a href="/"><img class="arrow_icon" src="../../../assets/assets/images/icon_history.png"></a>
                <div class="student-enroll-title-wrap">
                    <div class="student-enroll-title">{{'sitnet_toolbar_new_question' | translate}}</div>
                </div>

            </div>
            <div class="student-details-title-wrap" ng-hide="!newQuestion.id">
                <div class="student-enroll-title-wrap">
                    <div class="student-enroll-title">{{'sitnet_questions_edit' | translate}}</div>
                </div>
            </div>

        </div>
    </div>

    <div class="marl50 marr50">

        <!-- Question body //-->
        <div class="col-md-12 question-border padl40 padr40">

            <form role="form" class="form-horizontal" name="questionForm" novalidate>


                <div class="student-enrolment-wrapper review-view exam-view-warning mart40" ng-if="examNames.length > 0">

                    <!-- Exam contexts -->
                    <div class="row">
                        <div ng-if="showWarning()">

                            <div class="col-md-12">
                                <div class="col-md-1"><img src="../../../assets/assets/images/icon_warning.png" alt="exam"
                                                           onerror="this.onerror=null;this.src='../../../assets/assets/images/icon_warning.svg'" />
                                </div>
                                <div class="col-md-11 warning-text">
                                    {{'sitnet_exam_question_edit_instructions' | translate}}
                                    <ul class="list-inline margin-10">
                                        <li>
                                <span ng-repeat="name in examNames" class="exists-text">
                                    <span class="padr10">{{name}}</span>
                                </span>
                                        </li>
                                    </ul>

                                </div>
                            </div>


                        </div>
                        <div ng-if="!showWarning()">

                            <div class="col-md-12">
                                <div class="col-md-1"><img src="../../../assets/assets/images/icon_warning.png" alt="exam"
                                                           onerror="this.onerror=null;this.src='../../../assets/assets/images/icon_warning.svg'" />
                                </div>
                                {{'sitnet_added_to_exams' | translate}}
                                <div class="col-md-11 warning-text">
                                    <ul class="list-inline margin-10">
                                        <li>
                                <span ng-repeat="name in examNames" class="exists-text">
                                    {{name}}
                                </span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


                <!-- Question editor -->
                <div class="col-md-12 mart40 wide-column padl0">
                    <div class="review-list-title">{{ 'sitnet_exam_basic_information_tab' | translate }}
                        <i ng-if="showWarning()" class="fa fa-exclamation-circle padl20 reddish"></i>
                        <span class="warning-text-small" ng-if="showWarning()">{{'sitnet_shared_question_property_info' | translate}}</span>
                    </div>
                </div>

                <div class="col-md-12 mart40 padl0 padr0">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{'sitnet_question_text' | translate}}
                    </div>
                    <div class="col-md-9 padr0" ng-show="question.type">
                        <textarea id="editor" name="editor" ck-editor enable-cloze-test="question.type === 'ClozeTestQuestion'" rows="10" cols="60"
                                  ng-model="question.question" required>
                        </textarea>
                    </div>
                </div>
                <div class="col-md-12 margin-20 padl0 padr0">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{'sitnet_new_question_type' | translate}}
                    </div>
                    <div class="col-md-9 padr0">
                        <select ng-if="!question.type"
                                id="question"
                                name="question"
                                class="form-control wdtin"
                                ng-model="createQuestionModel.QuestionToBe"
                                ng-change="createQuestion()"
                                ng-options="type.name | translate for type in questionTypes">
                            <option value="">{{'sitnet_choose' | translate}}</option>
                        </select>
                        <span ng-if="question.type">
                            <span ng-if="question.type == 'EssayQuestion'">{{'sitnet_toolbar_essay_question'
                                | translate}}</span>
                            <span ng-if="question.type == 'ClozeTestQuestion'">{{'sitnet_toolbar_cloze_test_question'
                                | translate}}</span>
                            <span ng-if="question.type == 'MultipleChoiceQuestion'">{{'sitnet_toolbar_multiplechoice_question'
                                | translate}}</span>
                            <span ng-if="question.type == 'WeightedMultipleChoiceQuestion'">{{'sitnet_toolbar_weighted_multiplechoice_question'
                                | translate}}</span>
                        </span>
                    </div>
                </div>

                <div ng-if="question.type">

                    <!-- Evaluation -->
                    <div class="col-md-12 mart40 wide-column padl0" ng-show="question.type == 'EssayQuestion'">
                        <div class="review-list-title">{{ 'sitnet_comments' | translate }}
                        </div>
                    </div>

                    <!-- Type specific content - essay -->
                    <div class="col-md-12 margin-20 padl0 padr0"  ng-if="question.type === 'EssayQuestion'">
                        <div class="col-md-3 exam-basic-title padl0">
                            {{'sitnet_essay_length_recommendation' | translate}}

                        </div>
                        <div class="col-md-9">
                            <div class="input-group" id="expectedWordCount">
                                <input name="expectedWordCount" type="number" class="form-control wdt100" ng-model="sectionQuestion.expectedWordCount"
                                       ui-change="estimateCharacters(sectionQuestion)" min="1" max="1000000">
                            </div>
                            <div ng-hide="questionForm.defaultExpectedWordCount.$valid" class="warning-text-small margin-10">
                                <i class="fa fa-exclamation-circle reddish"></i>
                                {{'sitnet_essay_length_recommendation_bounds' | translate}}
                            </div>
                        </div>
                    </div>

                    <!-- Multiple choises - title -->
                    <div class="col-md-12 mart40 wide-column padl0 marb20" ng-show="question.type == 'MultipleChoiceQuestion' ||
                                                                     question.type == 'WeightedMultipleChoiceQuestion'">
                        <div class="review-list-title">{{ 'sitnet_question_options' | translate }}
                        </div>
                    </div>

                    <!-- Type specific content - multiple choices table titles -->

                    <div class="col-md-12 mart20 marb10"
                         ng-if="question.type === 'WeightedMultipleChoiceQuestion'">
                        <div class="col-md-7 padl0">
                            <span class="question-option-title">{{'sitnet_option' | translate}}</span>
                            <br/><span>
                                <i ng-if="showWarning()" class="fa fa-exclamation-circle reddish"></i>
                                <small ng-if="showWarning()">{{'sitnet_shared_question_property_info' | translate}}</small>
                                </span>
                        </div>
                        <div class="col-md-5 question-option-title">
                            {{'sitnet_word_points' | translate | uppercase}}
                        </div>
                    </div>

                    <!-- Type specific content - weighted option -->
                    <div ng-if="question.type === 'WeightedMultipleChoiceQuestion'"
                         ng-repeat="option in sectionQuestion.options">
                        <div class="col-md-12 form-horizontal question-editor-option">

                            <div class="col-md-7">
                                <input id="weightedOptionText" type="text" focus-on="opt{{option.id}}" class="question-option-input"
                                       ng-model="option.option.option"
                                       ng-click="selectIfDefault(option.option, $event)"
                                       required="true"/>
                            </div>
                            <div class="col-md-5">
                                <input id="optionScore" name="maxScore" class="question-option-input points"
                                       type="number" step="0.01" ng-pattern="/^-?[0-9]+(\.[0-9]{1,2})?$/"
                                       ng-model="option.score"
                                       required="true"
                                       ng-disabled="lotteryOn"/>
                                    <span ng-click="removeOption(option)" class="question-option-trash pointer">
                                        <i class="fa fa-trash-o fa-fw" title="{{'sitnet_remove' | translate}}"></i>
                                    </span>
                            </div>
                        </div>
                    </div>

                    <!-- Type specific content - option -->
                    <div ng-if="question.type === 'MultipleChoiceQuestion'"
                         ng-repeat="option in sectionQuestion.options">

                        <div class="form-horizontal question-editor-option">

                            <input name="correctOption" type="radio" ng-model="option.option.correctOption" ng-value="true" ng-click="correctAnswerToggled(option)"
                                   ng-disabled="optionDisabled(option)" class="make-inline question-option-radio">

                            <input id="optionText" type="text" focus-on="opt{{option.id}}" class="make-inline question-option-input"
                                   ng-model="option.option.option"
                                   ng-click="selectIfDefault(option.option.option, $event)"
                                   required="true"/>

                            <div ng-click="removeOption(option)" class="make-inline question-option-trash">
                                <i class="fa fa-trash-o fa-fw" title="{{'sitnet_remove' | translate}}"></i>
                            </div>
                        </div>
                    </div>


                    <!-- Evaluation type -->
                    <div class="col-md-12 margin-20 padl0 padr0" ng-show="question.type == 'EssayQuestion'">
                        <div class="col-md-3 exam-basic-title padl0">
                            {{'sitnet_evaluation_type' | translate}}
                        </div>
                        <div class="col-md-9">
                            <select id="evaluationType" class="form-control wdt240" ng-model="sectionQuestion.evaluationType"
                                    ng-change="updateEvaluationType()"
                                    ng-required="question.type == 'EssayQuestion'">
                                <option value="Points">{{ 'sitnet_word_points' | translate }}</option>
                                <option value="Selection">{{ 'sitnet_evaluation_select' | translate }}</option>
                            </select>
                        </div>
                    </div>
                 </div>

                <!-- Max score -->
                <div class="col-md-12 margin-20 padl0 padr0" ng-if="question.type == 'MultipleChoiceQuestion' ||
                                              question.type == 'ClozeTestQuestion' ||
                                              sectionQuestion.evaluationType == 'Points'">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{'sitnet_max_score' | translate}}
                    </div>
                    <div class="col-md-9">
                        <input id="maxScore" name="maxScore" type="number" class="form-control wdt100"
                               ng-model="sectionQuestion.maxScore" step="0.01" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/"
                               min="1" max="1000000"
                               required ng-disabled="lotteryOn"/>
                    </div>
                </div>

                <!-- Additional info -->
                <div class="col-md-12 mart40 wide-column padl0">
                    <div class="review-list-title">{{ 'sitnet_additional_info' | translate }}
                    </div>
                </div>

                <!-- Exam owners -->
                <div class="col-md-12 margin-20 padl0 padr0">
                    <div class="col-md-3 exam-basic-title padl0">{{'sitnet_question_owners' | translate}}
                    </div>
                    <div class="col-md-9">
                        <ul class="list-inline mart10 padl10">
                            <li ng-repeat="user in question.questionOwners">{{user.firstName }} {{ user.lastName }}
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Attachment -->
                <div ng-controller="AttachmentController" class="col-md-12 margin-20 padl0 padr0">

                    <div class="col-md-3 exam-basic-title padl0">
                        {{ 'sitnet_question_attachment' | translate}}
                    </div>

                    <div class="col-md-9" id="attachment">
                        <div class="review-attachment-button wdt120 make-inline">
                            <a class="pointer" ng-click="selectFile()">{{ 'sitnet_attach_file' | translate }}</a>
                        </div>
                        <div ng-show="question.attachment && !question.attachment.removed" class="make-inline padl10">
                            <!-- Uploaded -->
                            <a ng-if="question.attachment.id" class="pointer attachment-link" ng-click="downloadQuestionAttachment(question)">
                                <i class="fa fa-paperclip fa-fw"></i> {{question.attachment.fileName}}
                            </a>
                            <!-- Not yet uploaded -->
                    <span ng-if="!question.attachment.id" class="attachment-link">
                        <i class="fa fa-paperclip fa-fw"></i> {{question.attachment.name}} <small>
                        ({{ getFileSize(question.attachment) }})</small></span>
                    <span class="pointer remove-attachment" ng-click="removeQuestionAttachment(question)">
                        <img src="../../../assets/assets/images/icon_remove.svg" alt="{{'sitnet_remove_attachment' | translate }}"
                             onerror="this.onerror=null;this.src='../../../assets/assets/images/icon_remove.png'" />
                    </span>
                        </div>
                        <div class="mart10" ng-if="showWarning()">
                            <i class="fa fa-exclamation-circle reddish"></i>
                            <span class="warning-text-small">{{'sitnet_shared_question_property_info' | translate}}</span>

                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="col-md-12 margin-20 padl0 padr0">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{ 'sitnet_question_instruction' | translate}}
                    </div>
                    <div class="col-md-9 padr0">
                <textarea id="instruction" class="form-control" rows="3"
                          ng-model="sectionQuestion.answerInstructions"
                          placeholder="{{'sitnet_question_instruction' | translate}}">
                </textarea>
                    </div>
                </div>

                <!-- Evaluation criteria -->
                <div ng-show="question.type == 'EssayQuestion'" class="col-md-12 margin-20 padl0 padr0">

                    <div class="col-md-3 exam-basic-title padl0">
                        {{ 'sitnet_exam_evaluation_criteria' | translate}}
                    </div>
                    <div class="col-md-9 padr0">
                <textarea id="evaluationCriteria" class="form-control" rows="3"
                          ng-model="sectionQuestion.evaluationCriteria"
                          placeholder="{{'sitnet_exam_evaluation_criteria' | translate}}">
                </textarea>
                    </div>
                </div>


                <!-- New tag -->
                <div class="col-md-12 margin-20 padl0 padr0" ng-show="!question.parent">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{ 'sitnet_tag_question' | translate}}
                    </div>
                    <div class="col-md-9 padr0" ng-controller="TagTypeaheadCtrl">
                        <ul class="list-inline mart10">
                            <li ng-repeat="tag in question.tags">{{tag.name}}</li>
                        </ul>
                    </div>
                </div>

                <!-- Categories -->
                <div class="col-md-12 margin-20 padl0 padr0" ng-show="!question.parent">
                    <div class="col-md-3 exam-basic-title padl0">
                        {{ 'sitnet_added_to_sections' | translate}}
                    </div>
                    <div class="col-md-9 padr0" ng-controller="TagTypeaheadCtrl">
                        <ul class="list-inline mart10">
                            <li ng-repeat="name in sectionNames">{{name}}
                            </li>
                        </ul>
                    </div>
                </div>

            </form>

            <div class="mart20">
                <div class="question-cancel">
                    <button ng-disabled="!questionForm.$valid" ng-click="clearListeners(); submit(question, sectionQuestion)"
                            type="submit" class="btn btn-success bigbutton">{{'sitnet_save' | translate}}
                    </button>
                </div>
                <div class="question-cancel marr20">
                    <button ng-click="clearListeners(); cancelEdit();" type="submit" class="btn btn-cancel pull-right bigbutton">
                        {{'sitnet_button_cancel' | translate}}
                    </button>
                </div>
            </div>


        </div>
    </div>

</div>
