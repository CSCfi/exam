/*! exam  v4.0.0 27-12-2017 */

"use strict";angular.module("app.administrative",["app.administrative.reports","app.administrative.statistics","app.administrative.settings","app.administrative.users"]),angular.module("app.administrative.reports",["ui.select"]),angular.module("app.administrative.settings",[]),angular.module("app.administrative.statistics",[]),angular.module("app.administrative.users",[]),angular.module("app",["ngResource","ngRoute","ngStorage","tmh.dynamicLocale","app.session","app.navigation","app.enrolment","app.dashboard","app.administrative","app.software"]),angular.module("app.calendar",["ui.calendar"]),angular.module("app.common",[]),angular.module("app.dashboard",["app.dashboard.teacher","app.dashboard.student","app.maturity","ui.bootstrap"]),angular.module("app.dashboard.student",["ngAnimate","app.calendar"]),angular.module("app.dashboard.teacher",["app.exam","app.question","app.reservation","app.iop"]),angular.module("app.enrolment",[]),angular.module("app.exam.editor",["ui.bootstrap"]),angular.module("app.exam",["app.exam.editor","app.facility","app.review","app.examination","ngAnimate"]),angular.module("app.examination",[]),angular.module("app.facility.accessibility",[]),angular.module("app.facility.address",[]),angular.module("app.facility",["app.facility.accessibility","app.facility.machines","app.facility.rooms","app.facility.address","app.facility.schedule"]),angular.module("app.facility.machines",[]),angular.module("app.facility.rooms",["app.facility.accessibility"]),angular.module("app.facility.schedule",[]),angular.module("app.iop",[]),angular.module("app.maturity",["app.utility","dialogs.main"]),angular.module("app.navigation",[]),angular.module("app.question",[]),angular.module("app.reservation",["ui.select2"]),angular.module("app.review",[]),angular.module("app.session",["app.common"]),angular.module("app.software",[]),angular.module("app.utility",[]),angular.module("app.administrative.reports").component("reports",{templateUrl:"/assets/app/administrative/reports/reports.template.html",controller:["$translate","EXAM_CONF","Reports","Room","DateTime","$filter","UserRes","Files","toast",function(e,t,n,a,i,o,r,s,c){var u=this;u.$onInit=function(){u.csvExport={},u.templates={examRoomReservations:t.TEMPLATES_PATH+"administrative/reports/templates/exam-room-reservations.html",teacherExamsReport:t.TEMPLATES_PATH+"administrative/reports/templates/teacher-exams.html",reviewedExams:t.TEMPLATES_PATH+"administrative/reports/templates/reviewed-exams.html",examReport:t.TEMPLATES_PATH+"administrative/reports/templates/exam-report.html",examReportJson:t.TEMPLATES_PATH+"administrative/reports/templates/exam-report-json.html",examAnswers:t.TEMPLATES_PATH+"administrative/reports/templates/exam-answers.html",examEnrollmentsReport:t.TEMPLATES_PATH+"administrative/reports/templates/exam-enrollments.html",studentReport:t.TEMPLATES_PATH+"administrative/reports/templates/student.html",examRecordsCsv:t.TEMPLATES_PATH+"administrative/reports/templates/exam-records-csv.html"},u.selectedFields={room:{name:e.instant("sitnet_choose")}},u.rooms=a.rooms.query(),u.examNames=n.examNames.query(),u.teachers=r.usersByRole.query({role:"TEACHER"}),u.students=r.usersByRole.query({role:"STUDENT"})},u.setRoom=function(e){u.selectedFields.room=e},u.getExamEnrollments=function(t){t?s.download("/app/statistics/examenrollments/"+t.id,"exam_enrolments.xlsx"):c.error(e.instant("sitnet_choose_exam"))},u.getStudentReport=function(t){if(t){var n=o("date")(u.studentStartDate||new Date,"dd.MM.yyyy"),a=o("date")(u.studentEndDate||new Date,"dd.MM.yyyy");s.download("/app/statistics/student/"+t.id+"/"+n+"/"+a,"student_activity.xlsx")}else c.error(e.instant("sitnet_choose_student"))},u.getExamAnswerReport=function(){var e=o("date")(u.answerStartDate||new Date,"dd.MM.yyyy"),t=o("date")(u.answerEndDate||new Date,"dd.MM.yyyy");s.download("/app/statistics/allexams/"+e+"/"+t,"exam_answers_"+e+"_"+t+".xlsx")},u.getExamsXlsx=function(t){t?s.download("/app/statistics/examnames/"+t.id+"/xlsx","exams.xlsx"):c.error(e.instant("sitnet_choose_exam"))},u.getExamsJson=function(t){t?s.download("/app/statistics/examnames/"+t.id+"/json","exams.json"):c.error(e.instant("sitnet_choose_exam"))},u.getReviewsByDate=function(){var e=o("date")(u.reviewStartDate||new Date,"dd.MM.yyyy"),t=o("date")(u.reviewEndDate||new Date,"dd.MM.yyyy");s.download("/app/statistics/reviewsbydate/"+e+"/"+t,"reviews_"+e+"_"+t+".xlsx")},u.getTeacherExamsByDate=function(t){var n=o("date")(u.teacherStartDate||new Date,"dd.MM.yyyy"),a=o("date")(u.teacherEndDate||new Date,"dd.MM.yyyy");t?s.download("/app/statistics/teacherexamsbydate/"+t.id+"/"+n+"/"+a,"teacherexams_"+n+"_"+a+".xlsx"):c.error(e.instant("sitnet_choose_teacher"))},u.getRoomReservationsByDate=function(t){var n=o("date")(u.reservationStartDate||new Date,"dd.MM.yyyy"),a=o("date")(u.reservationEndDate||new Date,"dd.MM.yyyy");t>0?s.download("/app/statistics/resbydate/"+t+"/"+n+"/"+a,"reservations_"+n+"_"+a+".xlsx"):c.error(e.instant("sitnet_choose_room"))},u.getExamRecords=function(){var e=u.recordCsvStartDate?new Date(u.recordCsvStartDate).getTime():(new Date).getTime(),t=u.recordCsvEndDate?new Date(u.recordCsvEndDate).getTime().setHours(23,59,59,999):(new Date).getTime().setHours(23,59,59,999);s.download("/app/exam/record","examrecords.csv",{startDate:e,endDate:t})},u.answerStartDateChanged=function(e){u.answerStartDate=e},u.answerEndDateChanged=function(e){u.answerEndDate=e},u.recordCsvStartDateChanged=function(e){u.recordCsvStartDate=e},u.recordCsvEndDateChanged=function(e){u.recordCsvEndDate=e},u.reservationStartDateChanged=function(e){u.reservationStartDate=e},u.reservationEndDateChanged=function(e){u.reservationEndDate=e},u.reviewStartDateChanged=function(e){u.reviewStartDate=e},u.reviewEndDateChanged=function(e){u.reviewEndDate=e},u.studentStartDateChanged=function(e){u.studentStartDate=e},u.studentEndDateChanged=function(e){u.studentEndDate=e},u.teacherStartDateChanged=function(e){u.teacherStartDate=e},u.teacherEndDateChanged=function(e){u.teacherEndDate=e}}]}),angular.module("app.administrative.reports").factory("Reports",["$resource",function(e){return{examNames:e("/app/statistics/examnames")}}]),angular.module("app.administrative.settings").component("settings",{templateUrl:"/assets/app/administrative/settings/settings.template.html",controller:["$translate","$http","Settings","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.settings={},i.settings.eula=n.agreement.get(),n.deadline.get(function(e){e.value=parseInt(e.value),i.settings.deadline=e}),n.reservationWindow.get(function(e){e.value=parseInt(e.value),i.settings.reservationWindow=e})},i.updateAgreement=function(){n.agreement.update(i.settings.eula,function(){a.info(e.instant("sitnet_user_agreement")+" "+e.instant("sitnet_updated"))},function(e){a.error(e.data)})},i.updateDeadline=function(){n.deadline.update(i.settings.deadline,function(){a.info(e.instant("sitnet_settings")+" "+e.instant("sitnet_updated"))},function(e){a.error(e.data)})},i.updateReservationWindow=function(){n.reservationWindow.update(i.settings.reservationWindow,function(){a.info(e.instant("sitnet_settings")+" "+e.instant("sitnet_updated"))},function(e){a.error(e.data)})},i.showAttributes=function(){t.get("/attributes").success(function(e){i.attributes=e})}}]}),angular.module("app.administrative.settings").factory("Settings",["$resource",function(e){return{agreement:e("/app/settings/agreement",{},{update:{method:"PUT"}}),deadline:e("/app/settings/deadline",{},{update:{method:"PUT"}}),reservationWindow:e("/app/settings/reservationWindow",{},{update:{method:"PUT"}})}}]),angular.module("app.administrative.statistics").component("statistics",{templateUrl:"/assets/app/administrative/statistics/statistics.template.html",controller:["$translate","EXAM_CONF","Statistics",function(e,t,n){var a=this;a.$onInit=function(){a.templates={rooms:t.TEMPLATES_PATH+"administrative/statistics/templates/rooms.html",exams:t.TEMPLATES_PATH+"administrative/statistics/templates/exams.html",reservations:t.TEMPLATES_PATH+"administrative/statistics/templates/reservations.html",responses:t.TEMPLATES_PATH+"administrative/statistics/templates/responses.html"},a.departments=[],a.limitations={},a.exams=[],a.participations={},n.departments.get(function(e){e.departments.forEach(function(e){a.departments.push({name:e})})})};var i=function(){var e={};a.startDate&&(e.start=a.startDate),a.endDate&&(e.end=a.endDate);var t=a.departments.filter(function(e){return e.filtered});return t.length>0&&(e.dept=t.map(function(e){return e.name}).join()),e};a.startDateChanged=function(e){a.startDate=e},a.endDateChanged=function(e){a.endDate=e},a.totalParticipations=function(e,t){var n=0,i=function(t){var n=new Date(t.exam.created),a=new Date(e),i=new Date(a.getFullYear(),a.getMonth(),1),o=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59);return n>i&&n<o};for(var o in a.participations)if(a.participations.hasOwnProperty(o)){if(t&&o!==t)continue;n+=e?a.participations[o].filter(i).length:a.participations[o].length}return n};a.listParticipations=function(){n.participations.find(i()).$promise.then(function(e){a.participations=e,function(){var e=[];for(var t in a.participations)a.participations.hasOwnProperty(t)&&(e=e.concat(a.participations[t].map(function(e){return e.exam.created})));a.minDate=Math.min.apply(null,e),a.endDate?e.push(Date.parse(a.endDate)):e.push((new Date).getTime()),a.maxDate=Math.max.apply(null,e)}(),a.rooms=Object.keys(e),function(){if(0===a.participations.length)return[];var e=[];e.push(a.minDate);for(var t=new Date(a.minDate),n=new Date(new Date(t).setMonth(t.getMonth()+1)),i=new Date(a.maxDate);o=n,r=i,o.getYear()<r.getYear()||o.getYear()===r.getYear()&&o.getMonth()<r.getMonth();)e.push(n.getTime()),t=n,n=new Date(new Date(t).setMonth(t.getMonth()+1));var o,r;e.push(a.maxDate),a.months=e}()})},a.totalExams=function(){return a.exams.reduce(function(e,t){return e+t.participations},0)},a.listExams=function(){n.exams.query(i(),function(e){a.exams=e})},a.getRank=function(e,t){var n=Math.max(0,e-1);return t[n].participations===t[e].participations?(t[e].rank=t[n].rank||0,(t[n].rank||0)+1):(t[e].rank=e,e+1)},a.listReservations=function(){n.reservations.query(i(),function(e){a.reservations=e.filter(function(e){return!e.noShow}),a.noShows=e.filter(function(e){return e.noShow})})},a.listResponses=function(){n.responses.query(i(),function(e){a.assessedExams=e.filter(function(e){return["GRADED","GRADED_LOGGED","ARCHIVED","REJECTED","DELETED"].indexOf(e.state)>-1}),a.unassessedExams=e.filter(function(e){return["STUDENT_STARTED","REVIEW","REVIEW_STARTED"].indexOf(e.state)>-1}),a.abortedExams=e.filter(function(e){return"ABORTED"===e.state})})}}]}),angular.module("app.administrative.statistics").factory("Statistics",["$resource",function(e){return{departments:e("/app/reports/departments"),exams:e("/app/reports/exams"),reservations:e("/app/reports/reservations"),responses:e("/app/reports/responses"),participations:e("/app/reports/participations",{},{find:{method:"GET",isArray:!1,interceptor:{response:function(e){return e.data}}}})}}]),angular.module("app.administrative.users").component("users",{templateUrl:"/assets/app/administrative/users/users.template.html",controller:["$timeout","$translate","UserManagement","EXAM_CONF","Session","toast",function(e,t,n,a,i,o){var r=function(e){e.availableRoles=[],e.removableRoles=[],s.roles.forEach(function(t){-1===e.roles.map(function(e){return e.name}).indexOf(t.type)?e.availableRoles.push(angular.copy(t)):e.removableRoles.push(angular.copy(t))}),e.availablePermissions=[],e.removablePermissions=[],s.permissions.forEach(function(t){-1===e.permissions.map(function(e){return e.type}).indexOf(t.type)?e.availablePermissions.push(angular.copy(t)):e.removablePermissions.push(angular.copy(t))})},s=this;s.$onInit=function(){s.filter={},s.roles=[{type:"ADMIN",name:"sitnet_admin",icon:"fa-cog"},{type:"TEACHER",name:"sitnet_teacher",icon:"fa-university"},{type:"STUDENT",name:"sitnet_student",icon:"fa-graduation-cap"}],n.permissions.query(function(e){e.forEach(function(e){"CAN_INSPECT_LANGUAGE"===e.type&&(e.name="sitnet_can_inspect_language",e.icon="fa-pencil")}),s.permissions=e}),s.loader={loading:!1}},s.search=function(){s.loader.loading=!0,n.users.query({filter:s.filter.text},function(e){s.users=e,s.users.forEach(function(e){r(e)}),s.loader.loading=!1},function(e){s.loader.loading=!1,o.error(t.instant(e.data))})},s.hasRole=function(e,t){return e.roles.some(function(e){return e.name===t})},s.hasPermission=function(e,t){return e.permissions.some(function(e){return e.type===t})},s.applyRoleFilter=function(e){s.roles.forEach(function(t){t.filtered=t.type===e.type&&!t.filtered})},s.applyPermissionFilter=function(e){s.permissions.forEach(function(t){t.filtered=t.type===e.type&&!t.filtered})},s.isUnfiltered=function(e){if(e.id===i.getUser().id)return!1;var t=!0;return s.roles.filter(function(e){return e.filtered}).forEach(function(n){s.hasRole(e,n.type)||(t=!1)}),t?(s.permissions.filter(function(e){return e.filtered}).forEach(function(n){s.hasPermission(e,n.type)||(t=!1)}),t):t},s.addRole=function(e,t){n.roles.add({id:e.id,role:t.type},function(){e.roles.push({name:t.type}),r(e)})},s.addPermission=function(e,t){n.permissions.add({id:e.id,permission:t.type},function(){e.permissions.push({type:t.type}),r(e)})},s.removeRole=function(e,t){n.roles.remove({id:e.id,role:t.type},function(){var n=e.roles.map(function(e){return e.name}).indexOf(t.type);e.roles.splice(n,1),r(e)})},s.removePermission=function(e,t){n.permissions.remove({id:e.id,permission:t.type},function(){var n=e.permissions.map(function(e){return e.type}).indexOf(t.type);e.permissions.splice(n,1),r(e)})}}]}),angular.module("app.administrative.users").factory("UserManagement",["$resource",function(e){return{users:e("/app/users"),permissions:e("/app/permissions",{},{add:{method:"POST"},remove:{method:"DELETE"}}),roles:e("/app/users/:id/roles/:role",{id:"@id",role:"@role"},{add:{method:"POST",params:{id:"@id",role:"@role"}},update:{method:"PUT",params:{id:"@id",role:"@role"}},remove:{method:"DELETE",params:{id:"@id",role:"@role"}}})}}]),angular.module("app").config(["$translateProvider","$routeProvider","$httpProvider","$locationProvider","$compileProvider","tmhDynamicLocaleProvider","EXAM_CONF",function(e,t,n,a,i,o,r){i.debugInfoEnabled(!1),n.useApplyAsync(!0),n.defaults.headers.get||(n.defaults.headers.get={}),n.defaults.headers.get["Cache-Control"]="no-cache",n.defaults.headers.get.Pragma="no-cache";var s=r.LANGUAGES_PATH;e.useStaticFilesLoader({prefix:s+"locale-",suffix:".json"}),e.useSanitizeValueStrategy(null),e.preferredLanguage("en"),o.localeLocationPattern("/webjars/angular-i18n/"+r.NG_VERSION+"/angular-locale_{{locale}}.js"),a.html5Mode({enabled:!0,requireBase:!1}),t.when("/",{template:"<dashboard></dashboard>",reloadOnSearch:!1}),t.when("/questions",{template:"<library></library>"}),t.when("/questions/:id",{template:'<question new-question="false"></question>'}),t.when("/questions/newQuestion/:create",{template:'<question new-question="true"></question>'}),t.when("/exams/new",{template:"<new-exam></new-exam>"}),t.when("/exams/:id/:tab",{template:"<exam-tabs></exam-tabs>"}),t.when("/exams/:id/select/course",{template:"<course-selection></course-selection>"}),t.when("/exams/:id/view/preview/:tab?",{template:'<examination is-preview="true"><examination>'}),t.when("/exams/:id/view/printout/:tab?",{template:"<printout></printout>"}),t.when("/printouts",{template:"<printout-listing></printout-listing>"}),t.when("/calendar/:id",{template:'<calendar is-external="false"></calendar>'}),t.when("/iop/calendar/:id",{template:'<calendar is-external="true"></calendar>'}),t.when("/logout",{template:"<logout></logout>"}),t.when("/student/exam/:hash",{template:'<examination is-preview="false"><examination>'}),t.when("/student/waiting-room/:id?",{template:"<waiting-room></waiting-room>"}),t.when("/student/wrong-room/:eid/:mid",{template:'<wrong-location cause="room"></wrong-location>'}),t.when("/student/wrong-machine/:eid/:mid",{template:'<wrong-location cause="machine"></wrong-location>'}),t.when("/student/exams",{template:"<exam-search></exam-search>"}),t.when("/student/participations",{template:"<exam-participations></exam-participations>"}),t.when("/student/logout/:reason?",{template:"<examination-logout></examination-logout>"}),t.when("/enroll/:code/exam/:id",{template:"<exam-enrolments></exam-enrolments>"}),t.when("/assessments/:id",{template:"<assessment></assessment>"}),t.when("/speedreview/:id",{template:"<speed-review></speed-review>"}),t.when("/print/exam/:id",{template:"<printed-assessment></printed-assessment>"}),t.when("/assessments/:id/questions",{template:"<question-assessment></question-assessment>"}),t.when("/reservations",{template:'<reservations user-role="teacher"></reservations>'}),t.when("/reservations/:eid",{template:'<reservations user-role="teacher"></reservations>'}),t.when("/exams",{template:"<exam-list></exam-list>"}),t.when("/rooms",{template:"<room-list></room-list>"}),t.when("/rooms/:id",{template:"<room></room>"}),t.when("/rooms_edit/edit_multiple",{template:"<multi-room></multi-room>"}),t.when("/softwares",{template:"<software></software>"}),t.when("/accessibility",{template:"<accessibility></accessibility>"}),t.when("/machines/:id",{template:"<machine></machine>"}),t.when("/reports",{template:"<reports></reports>"}),t.when("/statistics",{template:"<statistics></statistics>"}),t.when("/settings",{template:"<settings></settings>"}),t.when("/users",{template:"<users></users>"}),t.when("/inspections",{template:"<language-inspections></language-inspections>"}),t.when("/inspections/reports",{template:"<maturity-reporting></maturity-reporting>"}),t.otherwise({redirectTo:"/"}),n.interceptors.push(["$q","$rootScope","$location","$translate","WrongLocation","toast",function(e,t,n,a,i,o){return{response:function(e){var a,o=function(e){return decodeURIComponent(escape(atob(e)))},r=e.headers()["x-exam-unknown-machine"],s=e.headers()["x-exam-wrong-room"],c=e.headers()["x-exam-wrong-machine"],u=e.headers()["x-exam-start-exam"],l=e.headers()["x-exam-upcoming-exam"];if(r){var m=o(r).split(":::");i.display(m)}else if(s)a=o(s).split(":::"),n.path("/student/wrong-room/"+a[0]+"/"+a[1]),t.$broadcast("wrongLocation");else if(c)a=o(c).split(":::"),n.path("/student/wrong-machine/"+a[0]+"/"+a[1]),t.$broadcast("wrongLocation");else if(l){var d="none"===l?"":l;n.path("none"===l?"/student/waiting-room":"/student/waiting-room/"+d),t.$broadcast("upcomingExam")}else u&&(n.path("/student/exam/"+u),t.$broadcast("examStarted"));return e},responseError:function(t){if(-1===t.status)o.error(a.instant("sitnet_connection_refused"));else if("string"==typeof t.data||t.data instanceof String){var n=e.defer();t.data.match(/^".*"$/g)&&(t.data=t.data.slice(1,t.data.length-1));var i=t.data.split(" ");return a(i).then(function(e){for(var a=0;a<i.length;a++)"sitnet_"===i[a].substring(0,7)&&(i[a]=e[i[a]]);return t.data=i.join(" "),n.reject(t)}),n.promise}return e.reject(t)}}}])}]),angular.module("app").constant("EXAM_CONF",{AUTH_STORAGE_KEY:"EXAM_USER",AUTH_HEADER:"x-exam-authentication",CONTEXT_PATH:"/",LANGUAGES_PATH:"/assets/assets/languages/",TEMPLATES_PATH:"/assets/app/",NG_VERSION:"1.5.3"}),angular.module("app").directive("dateValidator",function(){return{require:"ngModel",link:function(e,t,n,a){e.$watch(function(){return a.$viewValue},function(e){if(e)if(a.$setValidity("badDate",!0),a.$setValidity("date",!0),a.$setValidity("required",!0),e instanceof Date){var t=Date.parse(e);isNaN(t)&&a.$setValidity("badDate",!1)}else moment(e,"DD.MM.YYYY").isValid()||a.$setValidity("badDate",!1)})}}}).directive("draggableModal",function(){return{restrict:"A",link:function(e,t,n){t.draggable({revert:!1,drag:function(){t.css("height","auto")}})}}}).directive("uniqueValue",function(){return{require:"ngModel",scope:{items:"=",property:"@property"},link:function(e,t,n,a){e.$watch("items",function(t){!function(t){var n=e.items?e.items.map(function(t){return t[e.property]}).filter(function(e){return e==t}):[];a.$setValidity("uniqueness",n.length<2)}(a.$viewValue)},!0)}}}).directive("datetimepicker",[function(){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",datepickerOptions:"=",dateFormat:"=dateFormat",hourStep:"=",minuteStep:"=",showMeridian:"=",meredians:"=",mousewheel:"=",readonlyTime:"@"},template:function(e,t){function n(e,t){return e.replace(/[A-Z]/g,function(e,t){return(t?"-":"")+e.toLowerCase()})}return'<div id="datetimepicker" class="datetimepicker-wrapper"><input type="text" class="form-control" uib-datepicker-popup="{{dateFormat}}" ng-click="open($event)" is-open="opened" ng-model="ngModel" datepicker-options="datepickerOptions" close-text="{{\'sitnet_close\' | translate}}" current-text="{{\'sitnet_today\' | translate}}" date-validator />\n</div>\n<div id="datetimepicker" class="datetimepicker-wrapper" ng-model="time" ng-change="timeChange()" style="display:inline-block">\n<div uib-timepicker '+[["hourStep"],["minuteStep"],["showMeridian"],["meredians"],["mousewheel"]].reduce(function(e,a){return e+function(e,a){var i=angular.isDefined(a)?a:e;return t[i]?n(e)+'="'+i+'" ':""}.apply(null,a)},"")+function(e,a){var i=angular.isDefined(a)?a:e;return t[i]?n(e)+'="'+t[i]+'" ':n(e)}("readonlyInput","readonlyTime")+"></div>\n</div>"},controller:["$scope",function(e){e.timeChange=function(){e.ngModel&&e.time&&("string"==typeof e.ngModel&&(e.ngModel=new Date(e.ngModel)),e.ngModel.setHours(e.time.getHours(),e.time.getMinutes()))},e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0}}],link:function(e,t){e.$watch(function(){return e.ngModel},function(n){t[0].contains(document.activeElement)||(e.time=new Date(n))},!0)}}}]).directive("ckEditor",["$rootScope","lodash",function(e,t){return{require:"ngModel",scope:{enableClozeTest:"=?"},link:function(e,n,a,i){var o,r=CKEDITOR.replace(n[0]);i&&(r.on("instanceReady",function(){r.setData(o),e.enableClozeTest||r.getCommand("insertCloze").disable()}),e.$watch("enableClozeTest",function(e){var t=r.getCommand("insertCloze");t&&(e?t.enable():t.disable())}),r.on("change",t.debounce(s,100)),r.on("dataReady",s),r.on("key",t.debounce(s,100)),r.on("mode",s),i.$render=function(e){o=i.$modelValue,r.setData(i.$viewValue)});function s(){t.defer(function(){e.$apply(function(){i.$setViewValue(r.getData())})})}}}}]).directive("fixedPrecision",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){e||(e=0);if(!e.toString().match(/^-?[0-9]+(\.[0-9]{1,2})?$/i)){var t=parseFloat(e.toFixed(2));return a.$setViewValue(t),a.$render(),t}return e})}}}).directive("clozeTest",["$compile",function(e){return{restrict:"E",scope:{results:"=",content:"=",editable:"=?"},link:function(t,n,a){for(var i=angular.isUndefined(t.editable)||t.editable,o=angular.element(t.content),r=o.find("input"),s=0;s<r.length;++s){var c=r[s],u=c.attributes.id.value,l=t.results?t.results[c.id]:null;l&&c.setAttribute("size",l.length),c.setAttribute("ng-model","results."+u),i||c.setAttribute("ng-disabled","true")}n.replaceWith(o),e(o)(t)}}}]).directive("uiBlur",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var i=e(a.uiBlur);n.bind("blur",function(){i(t)})}}}]).directive("uiChange",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var i=e(a.uiChange);n.bind("change",function(){i(t)})}}}]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var i=e(a.fileModel).assign;n.bind("change",function(){t.$apply(function(){i(t.$parent,n[0].files[0])})})}}}]).directive("fileSelector",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){t.bind("change",function(){a.$setViewValue(t[0].files[0])})}}}]).directive("mathjax",function(){return{restrict:"EA",link:function(e,t,n){e.$watch(n.ngModel,function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,t.get(0)])})}}}).directive("focusOn",function(){return function(e,t,n){e.$on("focusOn",function(e,a){a===n.focusOn&&t[0].focus()})}}).directive("lowercase",[function(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){void 0===e&&(e="");var t=e.toLowerCase();return t!==e&&(a.$setViewValue(t),a.$render()),t})}}}]).directive("sort",["$timeout",function(e){return{restrict:"A",template:'<span class="pointer"ng-click="sort()"">{{ text | translate }}&nbsp;<i class="fa" ng-class="getSortClass()"></i></span>',scope:{predicate:"=",by:"@by",text:"@text",reverse:"=",onSort:"&?"},link:function(t,n,a){t.sort=function(){t.predicate=t.by,t.reverse=!t.reverse,t.onSort&&e(t.onSort)},t.getSortClass=function(){return t.predicate===t.by?t.reverse?"fa-caret-down":"fa-caret-up":"fa-sort"}}}}]).directive("teacherList",[function(){return{restrict:"E",replace:!1,transclude:!1,template:'<div><span ng-repeat="owner in exam.examOwners"><strong>{{owner.firstName}} {{owner.lastName}}{{$last ? "" : ", ";}}</strong></span><span ng-repeat="inspection in exam.examInspections">{{$first ? ", " : "";}}{{inspection.user.firstName}} {{inspection.user.lastName}}{{$last ? "" : ", ";}}</span></div>',scope:{exam:"=exam",addEnrolmentInformation:"&"}}}]).directive("assessmentTeacherList",[function(){return{restrict:"E",replace:!0,template:'<div><span ng-repeat="owner in exam.parent.examOwners"><strong>{{owner.firstName}} {{owner.lastName}}{{$last ? "" : ", ";}}</strong></span><br /><span ng-repeat="inspection in exam.examInspections">{{inspection.user.firstName}} {{inspection.user.lastName}}{{$last ? "" : ", ";}}</span></div>',scope:{exam:"=exam"}}}]).directive("paginator",function(){return{restrict:"E",replace:!0,template:'<ul class="pagination pagination-sm"><li ng-class="previousPageDisabled()"><a href="" ng-click="previousPage()">&#60;</a></li><li ng-repeat="n in range()" ng-class="{active: isCurrent(n)}" ng-click="setPage(n)"><a href="">{{ printRange(n) }}</a></li><li ng-class="nextPageDisabled()"><a target="_blank" ng-click="nextPage()">&#62;</a></li></ul>',scope:{items:"=items",pageSize:"=pageSize",currentPage:"=currentPage"},link:function(e,t,n){var a=0;e.currentPage=0,e.$watch("items",function(t){t&&(a=Math.ceil(t.length/e.pageSize)-1),e.currentPage=0}),e.printRange=function(t){if(e.items)return t+1},e.previousPage=function(){e.currentPage>0&&e.currentPage--},e.isCurrent=function(t){return t===e.currentPage},e.previousPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.nextPage=function(){e.currentPage<a&&e.currentPage++},e.nextPageDisabled=function(){return e.currentPage===a?"disabled":""},e.range=function(){for(var e=[],t=0;t<=a;++t)e.push(t);return e},e.setPage=function(t){e.currentPage=t}}}}),angular.module("app").filter("newlines",["text",function(e){return e.replace(/\n/g,"")}]).filter("utc",function(){return function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}}).filter("truncate",function(){return function(e,t){return e?truncate(e,t,{ellipsis:"..."}):""}}).filter("striphtml",function(){return function(e){if(e&&-1===e.indexOf("math-tex")){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}return void 0===e?"":e}}).filter("charcount",function(){return function(e){return e.replace(/(^"|"$|\\n)/g,"").replace(/\s+/g," ").trim().length}}).filter("wordcount",function(){return function(e){var t=e.replace(/(\S\.)(?!\s)/g,"$1 ").replace(/(^"|"$|\\n)/g,"").match(/\S+/g);return t?t.length:0}}).filter("diffInMinutesTo",function(){return function(e,t){if(t&&e){var n=(new Date(t).getTime()-new Date(e).getTime())/6e4;return Math.round(n)}}}).filter("diffInDaysToNow",function(){return function(e){if(e){var t=(new Date(e).getTime()-(new Date).getTime())/864e5;return t<0?'<span class="sitnet-text-alarm">'+Math.floor(t)+"</span>":"<span>"+Math.floor(t)+"</span>"}}}).filter("offset",function(){return function(e,t){return e?(t=parseInt(t),e.slice(t)):[]}}).filter("pagefill",function(){return function(e,t,n,a){t=parseInt(t,10),n=parseInt(n,10),a=parseInt(a,10);var i=Math.floor(t/a);if(i>0&&n===i)for(var o=(i+1)*a-t,r=0;r<o;++r)e.push(r);return e}}).filter("zeropad",function(){return function(e){return(e+="").length>1?e:"0"+e}}).filter("adjustdst",function(){return function(e){return moment(e).isDST()&&(e=moment(e).add(-1,"hour").format()),e}}),angular.module("app").factory("lodash",["$window",function(e){return e._}]).factory("toast",["$window",function(e){var t=e.toastr;return t.options.preventDuplicates=!0,t}]),angular.module("app").run(["$http","$sessionStorage","Session","EXAM_CONF",function(e,t,n,a){var i=t[a.AUTH_STORAGE_KEY];if(i){i.loginRole||n.logout();var o={};o[a.AUTH_HEADER]=i.token,e.defaults.headers.common=o,n.setUser(i),n.translate(i.lang),n.restartSessionCheck()}else n.switchLanguage("en"),n.login("","")}]),angular.module("app.calendar").component("bookingCalendar",{template:'<div id="calendarBlock" style="display:none">\n                <div class="col-md-12 calendar-no-paddings" id="calendar" config="$ctrl.calendarConfig"\n                     ng-model="$ctrl.eventSources"\n                     ui-calendar="$ctrl.calendarConfig" calendar="myCalendar">\n               </div>\n            </div>',bindings:{onRefresh:"&",onEventSelected:"&",room:"<",minDate:"<",maxDate:"<"},controller:["$translate","Calendar",function(e,t){var n=this;n.$onInit=function(){n.eventSources=[];var a;n.calendarConfig={editable:!1,selectable:!1,selectHelper:!1,defaultView:"agendaWeek",allDaySlot:!1,weekNumbers:!1,firstDay:1,timeFormat:"H:mm",columnFormat:"dd D.M",titleFormat:"D.M.YYYY",slotLabelFormat:"H:mm",slotEventOverlap:!1,buttonText:{today:e.instant("sitnet_today")},header:{left:"myCustomButton",center:"prev title next",right:"today"},customButtons:{myCustomButton:{text:moment().format("MMMM YYYY"),click:function(){}}},events:function(e,a,i,o){t.renderCalendarTitle(),n.onRefresh({start:e,callback:o})},eventClick:function(e){e.availableMachines>0&&(n.onEventSelected({start:e.start,end:e.end}),a&&$(a).css("background-color","#A6E9B2"),e.selected=!e.selected,a=$(this),$(this).css("background-color","#266B99"))},eventMouseover:function(e,t,n){!e.selected&&e.availableMachines>0&&($(this).css("cursor","pointer"),$(this).css("background-color","#3CA34F"))},eventMouseout:function(e,t,n){!e.selected&&e.availableMachines>0&&$(this).css("background-color","#A6E9B2")},eventRender:function(t,n,a){t.availableMachines>0&&n.attr("title",e.instant("sitnet_new_reservation")+" "+t.start.format("HH:mm")+" - "+t.end.format("HH:mm"))},eventAfterAllRender:function(e){var t=$(".fc-prev-button"),a=$(".fc-next-button"),i=$(".fc-today-button"),o=moment();n.minDate>=e.start&&n.minDate<=e.end?(t.prop("disabled",!0),t.addClass("fc-state-disabled")):(t.removeClass("fc-state-disabled"),t.prop("disabled",!1)),n.maxDate>=e.start&&n.maxDate<=e.end?(a.prop("disabled",!0),a.addClass("fc-state-disabled")):(a.removeClass("fc-state-disabled"),a.prop("disabled",!1)),o<n.minDate?(i.prop("disabled",!0),i.addClass("fc-state-disabled")):(i.removeClass("fc-state-disabled"),i.prop("disabled",!1))}}},n.$onChanges=function(e){if(e.room&&e.room.currentValue){var a=e.room.currentValue,i=t.getEarliestOpening(a),o=t.getLatestClosing(a),r=t.getClosedWeekdays(a);$("#calendar").fullCalendar($.extend(n.calendarConfig,{timezone:a.localTimezone,minTime:i,maxTime:o,scrollTime:i,hiddenDays:r,height:"auto"}))}}}]}),angular.module("app.calendar").component("calendar",{templateUrl:"/assets/app/calendar/calendar.template.html",bindings:{isExternal:"<"},controller:["$http","$scope","$location","$translate","$routeParams","DateTime","StudentExamRes","Calendar","SettingsResource","InteroperabilityResource","uiCalendarConfig","toast",function(e,t,n,a,i,o,r,s,c,u,l,m){var d=this;d.$onInit=function(){d.limitations={},d.openingHours=[],d.exceptionHours=[],d.loader={loading:!1},c.iop.get(function(e){d.isInteroperable=e.isInteroperable,d.isInteroperable&&d.isExternal&&u.organisations.query(function(e){d.organisations=e.filter(function(e){return!e.homeOrg})})}),r.examInfo.get({eid:i.id},function(t){d.examInfo=t,l.calendars.myCalendar.fullCalendar("gotoDate",moment.max(moment(),moment(d.examInfo.examActiveStartDate))),s.reservationWindowApi.get(function(t){d.reservationWindowEndDate=moment().add(t.value,"days"),d.minDate=moment.max(moment(),moment(d.examInfo.examActiveStartDate)),d.maxDate=moment.min(d.reservationWindowEndDate,moment(d.examInfo.examActiveEndDate)),d.showReservationWindowInfo=function(){return moment(d.examInfo.examActiveEndDate)>d.reservationWindowEndDate},d.getReservationWindowDescription=function(){return a.instant("sitnet_description_reservation_window").replace("{}",t.value)+" ("+d.reservationWindowEndDate.format("DD.MM.YYYY")+")"},e.get("/app/accessibility").success(function(e){d.accessibilities=e,d.selectedAccessibilities=function(){return d.accessibilities.filter(function(e){return e.filtered})}}),e.get("/app/rooms").then(function(e){d.rooms=e.data,d.selectedRoom=function(){var e=null;return d.rooms.some(function(t){if(t.filtered)return e=t,!0}),e},d.getRoomInstructions=function(){if(d.selectedRoom()){var e;switch(a.use()){case"fi":e=d.selectedRoom().roomInstruction;break;case"sv":e=d.selectedRoom().roomInstructionSV;break;case"en":default:e=d.selectedRoom().roomInstructionEN}return e}},d.getRoomAccessibility=function(){if(d.selectedRoom())return d.selectedRoom().accessibility.map(function(e){return e.name}).join(", ")}})})},function(e){toastr.error(e.data)})},d.makeExternalReservation=function(){n.path("/iop/calendar/"+i.id)},d.makeInternalReservation=function(){n.path("/calendar/"+i.id)};var p=function(e,t){var n=(e=moment.tz(e,t)).isDST()?-1:0;return e.add(n,"hour").format()};d.refresh=function(e,t){var n=e.format(),o=d.selectedRoom(),r=d.accessibilities.filter(function(e){return e.filtered}).map(function(e){return e.id});if(o){d.loader.loading=!0;c=function(e){var n=o.localTimezone,i=e.map(function(e){return{title:(i=e,i.availableMachines>0?a.instant("sitnet_slot_available")+" ("+i.availableMachines+")":i.availableMachines<0?i.conflictingExam||a.instant("sitnet_own_reservation"):a.instant("sitnet_reserved")),color:(t=e,t.availableMachines<0?"#266B99":t.availableMachines>0?"#A6E9B2":"#D8D8D8"),start:p(e.start,n),end:p(e.end,n),availableMachines:e.availableMachines};var t,i});t(i),d.loader.loading=!1},l=function(e){d.loader.loading=!1,e&&404===e.status?m.error(a.instant("sitnet_exam_not_active_now")):e?m.error(e.data.message):m.error(a.instant("sitnet_no_suitable_enrolment_found"))},f=n,g=o,h=r,d.isExternal?u.slots.query({examId:i.id,roomRef:g._id,org:d.selectedOrganisation._id,date:f},c,l):s.slotsApi.query({eid:i.id,rid:g.id,day:f,aids:h},c,l),d.exceptionHours=s.getExceptionHours()}var c,l,f,g,h},t.$on("$localeChangeSuccess",function(){d.calendarConfig.buttonText.today=a.instant("sitnet_today"),d.openingHours=s.processOpeningHours(d.selectedRoom())});d.createReservation=function(e,t){d.reservation={room:d.selectedRoom().name,time:e.format("DD.MM.YYYY HH:mm")+" - "+t.format("HH:mm"),start:e,end:t}},d.confirmReservation=function(){d.reservation&&s.reserve(d.reservation.start,d.reservation.end,d.selectedRoom(),d.accessibilities,d.selectedOrganisation)},d.setOrganisation=function(e){d.selectedOrganisation=e,e.filtered=!e.filtered,d.rooms.forEach(function(e){delete e.filtered}),d.selectedOrganisation&&u.facilities.query({org:d.selectedOrganisation._id},function(e){d.rooms=e})},d.selectAccessibility=function(e){e.filtered=!e.filtered,d.selectedRoom()&&l.calendars.myCalendar.fullCalendar("refetchEvents")},d.getDescription=function(e){if(e.outOfService){var t=e.statusComment?": "+e.statusComment:"";return a.instant("sitnet_room_out_of_service")+t}return e.name},d.printExamDuration=function(e){return o.printExamDuration(e)},d.selectRoom=function(e){e.outOfService||(d.rooms.forEach(function(e){delete e.filtered}),e.filtered=!0,d.openingHours=s.processOpeningHours(e))}}]}),angular.module("app.calendar").service("Calendar",["$resource","$uibModal","$http","$routeParams","$translate","$location","DateTime","Session","InteroperabilityResource","toast",function(e,t,n,a,i,o,r,s,c,u){this.slotsApi=e("/app/calendar/:eid/:rid",{eid:"@eid",rid:"@rid"}),this.reservationWindowApi=e("/app/settings/reservationWindow");var l=function(e,t){var n=(e=moment.tz(e,t)).isDST()?1:0;return moment.utc(e.add(n,"hour")).format()};this.reserve=function(e,t,i,r,s){var m=i.localTimezone,d={};d.start=l(e,m),d.end=l(t,m),d.examId=parseInt(a.id),s?(d.roomId=i._id,d.orgId=s?s._id:void 0,c.reservations.create(d,function(){o.path("/")},function(e){u.error(e.data)})):(d.roomId=i.id,d.aids=r.filter(function(e){return e.filtered}).map(function(e){return e.id}),n.post("/app/calendar/reservation",d).then(function(){o.path("/")},function(e){u.error(e.data)}))},this.renderCalendarTitle=function(){var e=$(".fc-toolbar .fc-center > h2"),t=e.text(),n="",a=t.split(" — ")[1],i=t.split(" — ")[0].split(".").filter(function(e){return e});i.length<3&&(i.forEach(function(e){n+=e,e&&"."!==e[e.length-1]&&(n+=".")}),n+=" — "+a,e.text(n))};var m=function(e,t){var n=null;return t.some(function(t){if(t.ref===e.weekday)return n=t,!0}),n};this.processOpeningHours=function(e){if(e){var t=function(){var e=s.getUser().lang,t=e.toLowerCase()+"-"+e.toUpperCase(),n={weekday:"short"},a=r.getDateForWeekday;return{SUNDAY:{ord:7,name:a(0).toLocaleDateString(t,n)},MONDAY:{ord:1,name:a(1).toLocaleDateString(t,n)},TUESDAY:{ord:2,name:a(2).toLocaleDateString(t,n)},WEDNESDAY:{ord:3,name:a(3).toLocaleDateString(t,n)},THURSDAY:{ord:4,name:a(4).toLocaleDateString(t,n)},FRIDAY:{ord:5,name:a(5).toLocaleDateString(t,n)},SATURDAY:{ord:6,name:a(6).toLocaleDateString(t,n)}}}(),n=[],a=e.localTimezone;return e.defaultWorkingHours.forEach(function(e){if(!m(e,n)){var i={name:t[e.weekday].name,ref:e.weekday,ord:t[e.weekday].ord,periods:[]};n.push(i)}m(e,n).periods.push(moment.tz(e.startTime,a).format("HH:mm")+" - "+moment.tz(e.endTime,a).format("HH:mm"))}),n.forEach(function(e){e.periods=e.periods.sort().join(", ")}),n.sort(function(e,t){return e.ord>t.ord})}};this.getExceptionHours=function(e){if(e){var t=moment.max(moment(),uiCalendarConfig.calendars.myCalendar.fullCalendar("getView").start),n=uiCalendarConfig.calendars.myCalendar.fullCalendar("getView").end,a=e.calendarExceptionEvents.filter(function(e){return moment(e.startDate)>t&&moment(e.endDate)<n});return a.forEach(function(e,t){var n=moment.tz(e.startDate,t),a=moment.tz(e.endDate,t),i=moment.tz(t).isDST()?-1:0;n.add(i,"hour"),a.add(i,"hour"),e.start=n.format("DD.MM.YYYY HH:mm"),e.end=a.format("DD.MM.YYYY HH:mm"),e.description=e.outOfService?"sitnet_closed":"sitnet_open"}.call(this,e.localTimezone)),a}},this.getEarliestOpening=function(e){var t=e.localTimezone,n=e.defaultWorkingHours.map(function(e){var n=moment.tz(e.startTime,t);return moment().hours(n.hours()).minutes(n.minutes()).seconds(n.seconds())});return moment.min(n)},this.getLatestClosing=function(e){var t=e.localTimezone,n=e.defaultWorkingHours.map(function(e){var n=moment.tz(e.endTime,t);return moment().hours(n.hours()).minutes(n.minutes()).seconds(n.seconds())});return moment.max(n)},this.getClosedWeekdays=function(e){var t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],n=e.defaultWorkingHours.map(function(e){return t.indexOf(e.weekday)});return[0,1,2,3,4,5,6].filter(function(e){return-1===n.indexOf(e)})}}]),angular.module("app.common").service("Language",["$resource",function(e){this.languageApi=e("/app/languages");var t={ab:{name:"Abkhaz",nativeName:"аҧсуа"},aa:{name:"Afar",nativeName:"Afaraf"},af:{name:"Afrikaans",nativeName:"Afrikaans"},ak:{name:"Akan",nativeName:"Akan"},sq:{name:"Albanian",nativeName:"Shqip"},am:{name:"Amharic",nativeName:"አማርኛ"},ar:{name:"Arabic",nativeName:"العربية"},an:{name:"Aragonese",nativeName:"Aragonés"},hy:{name:"Armenian",nativeName:"Հայերեն"},as:{name:"Assamese",nativeName:"অসমীয়া"},av:{name:"Avaric",nativeName:"авар мацӀ, магӀарул мацӀ"},ae:{name:"Avestan",nativeName:"avesta"},ay:{name:"Aymara",nativeName:"aymar aru"},az:{name:"Azerbaijani",nativeName:"azərbaycan dili"},bm:{name:"Bambara",nativeName:"bamanankan"},ba:{name:"Bashkir",nativeName:"башҡорт теле"},eu:{name:"Basque",nativeName:"euskara, euskera"},be:{name:"Belarusian",nativeName:"Беларуская"},bn:{name:"Bengali",nativeName:"বাংলা"},bh:{name:"Bihari",nativeName:"भोजपुरी"},bi:{name:"Bislama",nativeName:"Bislama"},bs:{name:"Bosnian",nativeName:"bosanski jezik"},br:{name:"Breton",nativeName:"brezhoneg"},bg:{name:"Bulgarian",nativeName:"български език"},my:{name:"Burmese",nativeName:"ဗမာစာ"},ca:{name:"Catalan; Valencian",nativeName:"Català"},ch:{name:"Chamorro",nativeName:"Chamoru"},ce:{name:"Chechen",nativeName:"нохчийн мотт"},ny:{name:"Chichewa; Chewa; Nyanja",nativeName:"chiCheŵa, chinyanja"},zh:{name:"Chinese",nativeName:"中文 (Zhōngwén), 汉语, 漢語"},cv:{name:"Chuvash",nativeName:"чӑваш чӗлхи"},kw:{name:"Cornish",nativeName:"Kernewek"},co:{name:"Corsican",nativeName:"corsu, lingua corsa"},cr:{name:"Cree",nativeName:"ᓀᐦᐃᔭᐍᐏᐣ"},hr:{name:"Croatian",nativeName:"hrvatski"},cs:{name:"Czech",nativeName:"česky, čeština"},da:{name:"Danish",nativeName:"dansk"},dv:{name:"Divehi; Dhivehi; Maldivian;",nativeName:"ދިވެހި"},nl:{name:"Dutch",nativeName:"Nederlands, Vlaams"},en:{name:"English",nativeName:"English"},eo:{name:"Esperanto",nativeName:"Esperanto"},et:{name:"Estonian",nativeName:"eesti, eesti keel"},ee:{name:"Ewe",nativeName:"Eʋegbe"},fo:{name:"Faroese",nativeName:"føroyskt"},fj:{name:"Fijian",nativeName:"vosa Vakaviti"},fi:{name:"Finnish",nativeName:"suomi"},fr:{name:"French",nativeName:"français, langue française"},ff:{name:"Fula; Fulah; Pulaar; Pular",nativeName:"Fulfulde, Pulaar, Pular"},gl:{name:"Galician",nativeName:"Galego"},ka:{name:"Georgian",nativeName:"ქართული"},de:{name:"German",nativeName:"Deutsch"},el:{name:"Greek, Modern",nativeName:"Ελληνικά"},gn:{name:"Guaraní",nativeName:"Avañeẽ"},gu:{name:"Gujarati",nativeName:"ગુજરાતી"},ht:{name:"Haitian; Haitian Creole",nativeName:"Kreyòl ayisyen"},ha:{name:"Hausa",nativeName:"Hausa, هَوُسَ"},he:{name:"Hebrew (modern)",nativeName:"עברית"},hz:{name:"Herero",nativeName:"Otjiherero"},hi:{name:"Hindi",nativeName:"हिन्दी, हिंदी"},ho:{name:"Hiri Motu",nativeName:"Hiri Motu"},hu:{name:"Hungarian",nativeName:"Magyar"},ia:{name:"Interlingua",nativeName:"Interlingua"},id:{name:"Indonesian",nativeName:"Bahasa Indonesia"},ie:{name:"Interlingue",nativeName:"Originally called Occidental; then Interlingue after WWII"},ga:{name:"Irish",nativeName:"Gaeilge"},ig:{name:"Igbo",nativeName:"Asụsụ Igbo"},ik:{name:"Inupiaq",nativeName:"Iñupiaq, Iñupiatun"},io:{name:"Ido",nativeName:"Ido"},is:{name:"Icelandic",nativeName:"Íslenska"},it:{name:"Italian",nativeName:"Italiano"},iu:{name:"Inuktitut",nativeName:"ᐃᓄᒃᑎᑐᑦ"},ja:{name:"Japanese",nativeName:"日本語 (にほんご／にっぽんご)"},jv:{name:"Javanese",nativeName:"basa Jawa"},kl:{name:"Kalaallisut, Greenlandic",nativeName:"kalaallisut, kalaallit oqaasii"},kn:{name:"Kannada",nativeName:"ಕನ್ನಡ"},kr:{name:"Kanuri",nativeName:"Kanuri"},ks:{name:"Kashmiri",nativeName:"कश्मीरी, كشميري‎"},kk:{name:"Kazakh",nativeName:"Қазақ тілі"},km:{name:"Khmer",nativeName:"ភាសាខ្មែរ"},ki:{name:"Kikuyu, Gikuyu",nativeName:"Gĩkũyũ"},rw:{name:"Kinyarwanda",nativeName:"Ikinyarwanda"},ky:{name:"Kirghiz, Kyrgyz",nativeName:"кыргыз тили"},kv:{name:"Komi",nativeName:"коми кыв"},kg:{name:"Kongo",nativeName:"KiKongo"},ko:{name:"Korean",nativeName:"한국어 (韓國語), 조선말 (朝鮮語)"},ku:{name:"Kurdish",nativeName:"Kurdî, كوردی‎"},kj:{name:"Kwanyama, Kuanyama",nativeName:"Kuanyama"},la:{name:"Latin",nativeName:"latine, lingua latina"},lb:{name:"Luxembourgish, Letzeburgesch",nativeName:"Lëtzebuergesch"},lg:{name:"Luganda",nativeName:"Luganda"},li:{name:"Limburgish, Limburgan, Limburger",nativeName:"Limburgs"},ln:{name:"Lingala",nativeName:"Lingála"},lo:{name:"Lao",nativeName:"ພາສາລາວ"},lt:{name:"Lithuanian",nativeName:"lietuvių kalba"},lu:{name:"Luba-Katanga",nativeName:""},lv:{name:"Latvian",nativeName:"latviešu valoda"},gv:{name:"Manx",nativeName:"Gaelg, Gailck"},mk:{name:"Macedonian",nativeName:"македонски јазик"},mg:{name:"Malagasy",nativeName:"Malagasy fiteny"},ms:{name:"Malay",nativeName:"bahasa Melayu, بهاس ملايو‎"},ml:{name:"Malayalam",nativeName:"മലയാളം"},mt:{name:"Maltese",nativeName:"Malti"},mi:{name:"Māori",nativeName:"te reo Māori"},mr:{name:"Marathi (Marāṭhī)",nativeName:"मराठी"},mh:{name:"Marshallese",nativeName:"Kajin M̧ajeļ"},mn:{name:"Mongolian",nativeName:"монгол"},na:{name:"Nauru",nativeName:"Ekakairũ Naoero"},nv:{name:"Navajo, Navaho",nativeName:"Diné bizaad, Dinékʼehǰí"},nb:{name:"Norwegian Bokmål",nativeName:"Norsk bokmål"},nd:{name:"North Ndebele",nativeName:"isiNdebele"},ne:{name:"Nepali",nativeName:"नेपाली"},ng:{name:"Ndonga",nativeName:"Owambo"},nn:{name:"Norwegian Nynorsk",nativeName:"Norsk nynorsk"},no:{name:"Norwegian",nativeName:"Norsk"},ii:{name:"Nuosu",nativeName:"ꆈꌠ꒿ Nuosuhxop"},nr:{name:"South Ndebele",nativeName:"isiNdebele"},oc:{name:"Occitan",nativeName:"Occitan"},oj:{name:"Ojibwe, Ojibwa",nativeName:"ᐊᓂᔑᓈᐯᒧᐎᓐ"},cu:{name:"Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic",nativeName:"ѩзыкъ словѣньскъ"},om:{name:"Oromo",nativeName:"Afaan Oromoo"},or:{name:"Oriya",nativeName:"ଓଡ଼ିଆ"},os:{name:"Ossetian, Ossetic",nativeName:"ирон æвзаг"},pa:{name:"Panjabi, Punjabi",nativeName:"ਪੰਜਾਬੀ, پنجابی‎"},pi:{name:"Pāli",nativeName:"पाऴि"},fa:{name:"Persian",nativeName:"فارسی"},pl:{name:"Polish",nativeName:"polski"},ps:{name:"Pashto, Pushto",nativeName:"پښتو"},pt:{name:"Portuguese",nativeName:"Português"},qu:{name:"Quechua",nativeName:"Runa Simi, Kichwa"},rm:{name:"Romansh",nativeName:"rumantsch grischun"},rn:{name:"Kirundi",nativeName:"kiRundi"},ro:{name:"Romanian, Moldavian, Moldovan",nativeName:"română"},ru:{name:"Russian",nativeName:"русский язык"},sa:{name:"Sanskrit (Saṁskṛta)",nativeName:"संस्कृतम्"},sc:{name:"Sardinian",nativeName:"sardu"},sd:{name:"Sindhi",nativeName:"सिन्धी, سنڌي، سندھی‎"},se:{name:"Northern Sami",nativeName:"Davvisámegiella"},sm:{name:"Samoan",nativeName:"gagana faa Samoa"},sg:{name:"Sango",nativeName:"yângâ tî sängö"},sr:{name:"Serbian",nativeName:"српски језик"},gd:{name:"Scottish Gaelic; Gaelic",nativeName:"Gàidhlig"},sn:{name:"Shona",nativeName:"chiShona"},si:{name:"Sinhala, Sinhalese",nativeName:"සිංහල"},sk:{name:"Slovak",nativeName:"slovenčina"},sl:{name:"Slovene",nativeName:"slovenščina"},so:{name:"Somali",nativeName:"Soomaaliga, af Soomaali"},st:{name:"Southern Sotho",nativeName:"Sesotho"},es:{name:"Spanish; Castilian",nativeName:"español, castellano"},su:{name:"Sundanese",nativeName:"Basa Sunda"},sw:{name:"Swahili",nativeName:"Kiswahili"},ss:{name:"Swati",nativeName:"SiSwati"},sv:{name:"Swedish",nativeName:"svenska"},ta:{name:"Tamil",nativeName:"தமிழ்"},te:{name:"Telugu",nativeName:"తెలుగు"},tg:{name:"Tajik",nativeName:"тоҷикӣ, toğikī, تاجیکی‎"},th:{name:"Thai",nativeName:"ไทย"},ti:{name:"Tigrinya",nativeName:"ትግርኛ"},bo:{name:"Tibetan Standard, Tibetan, Central",nativeName:"བོད་ཡིག"},tk:{name:"Turkmen",nativeName:"Türkmen, Түркмен"},tl:{name:"Tagalog",nativeName:"Wikang Tagalog, ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔"},tn:{name:"Tswana",nativeName:"Setswana"},to:{name:"Tonga (Tonga Islands)",nativeName:"faka Tonga"},tr:{name:"Turkish",nativeName:"Türkçe"},ts:{name:"Tsonga",nativeName:"Xitsonga"},tt:{name:"Tatar",nativeName:"татарча, tatarça, تاتارچا‎"},tw:{name:"Twi",nativeName:"Twi"},ty:{name:"Tahitian",nativeName:"Reo Tahiti"},ug:{name:"Uighur, Uyghur",nativeName:"Uyƣurqə, ئۇيغۇرچە‎"},uk:{name:"Ukrainian",nativeName:"українська"},ur:{name:"Urdu",nativeName:"اردو"},uz:{name:"Uzbek",nativeName:"zbek, Ўзбек, أۇزبېك‎"},ve:{name:"Venda",nativeName:"Tshivenḓa"},vi:{name:"Vietnamese",nativeName:"Tiếng Việt"},vo:{name:"Volapük",nativeName:"Volapük"},wa:{name:"Walloon",nativeName:"Walon"},cy:{name:"Welsh",nativeName:"Cymraeg"},wo:{name:"Wolof",nativeName:"Wollof"},fy:{name:"Western Frisian",nativeName:"Frysk"},xh:{name:"Xhosa",nativeName:"isiXhosa"},yi:{name:"Yiddish",nativeName:"ייִדיש"},yo:{name:"Yoruba",nativeName:"Yorùbá"},za:{name:"Zhuang, Chuang",nativeName:"Saɯ cueŋƅ, Saw cuengh"}};this.getLanguageName=function(e){e=e.slice(0,2);var n=t[e];return n?n.name:void 0},this.getLanguageNativeName=function(e){e=e.slice(0,2);var n=t[e];return n?n.nativeName:void 0},this.getLanguages=function(){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e}}]),angular.module("app.common").factory("SettingsResource",["$resource",function(e){return{hostname:e("/app/settings/hostname"),examDurations:e("/app/settings/durations"),gradeScale:e("/app/settings/gradescale"),enrolmentPermissions:e("/app/settings/enrolmentPermissionCheck"),environment:e("/app/settings/environment"),iop:e("/app/settings/iop"),maxFilesize:e("/app/settings/maxfilesize"),appVersion:e("/app/settings/appVersion"),maturityInstructions:e("/app/settings/maturityInstructions")}}]),angular.module("app.common").factory("UserRes",["$resource",function(e){return{userRoles:e("/app/users/:id/roles/:role",{id:"@id",role:"@role"},{update:{method:"PUT",params:{id:"@id",role:"@role"}}}),usersByRole:e("/app/users/byrole/:role",{role:"@role"}),filterUsers:e("/app/users/filter/:role",{role:"@role"}),filterUsersByExam:e("/app/users/filter/:role/:eid",{eid:"@eid",role:"@role"}),filterOwnersByExam:e("/app/users/exam/owners/:role/:eid",{eid:"@eid",role:"@role"}),filterOwnersByQuestion:e("/app/users/question/owners/:role",{role:"@role"}),updateAgreementAccepted:e("/app/users/agreement",{},{update:{method:"PUT"}}),unenrolledStudents:e("/app/students/:eid",{eid:"@eid"})}}]),angular.module("app.dashboard").component("dashboard",{templateUrl:"/assets/app/dashboard/dashboard.template.html",controller:["Session",function(e){var t=this;t.$onInit=function(){t.user=e.getUser(),t.user||console.log("not logged in")}}]}),angular.module("app.dashboard.student").component("studentDashboard",{templateUrl:"/assets/app/dashboard/student/studentDashboard.template.html",controller:["StudentDashboard","Reservation","Room","DateTime","Enrolment","Session",function(e,t,n,a,i,o){var r=this;r.$onInit=function(){r.showInst=0,r.showGuide=0,e.listEnrolments().then(function(e){r.userEnrolments=e.result})},r.printExamDuration=function(e){return a.printExamDuration(e)},r.removeReservation=function(e){t.removeReservation(e)},r.showInstructions=function(e){r.showInst=r.showInst===e?0:e},r.showMaturityInstructions=function(e){i.showMaturityInstructions(e)},r.addEnrolmentInformation=function(e){i.addEnrolmentInformation(e)},r.getUsername=function(){return o.getUserName()},r.enrolmentRemoved=function(e){r.userEnrolments.splice(r.userEnrolments.indexOf(e),1)},r.removeEnrolment=function(e,t){i.removeEnrolment(e,t)}}]}),angular.module("app.dashboard.student").service("StudentDashboard",["$q","$resource",function(e,t){var n=t("/app/enrolments");this.listEnrolments=function(){var t=e.defer();return n.query(function(e){e.forEach(function(e){e.reservation&&function(e){var t=e.machine,n=e.externalReservation,a=t?t.room.localTimezone:n.roomTz,i=moment.tz(e.startAt,a),o=moment.tz(e.endAt,a);i.isDST()&&i.add(-1,"hour"),o.isDST()&&o.add(-1,"hour"),e.occasion={startAt:i.format("HH:mm"),endAt:o.format("HH:mm")}}(e.reservation)}),t.resolve({result:e})},function(e){t.reject(e)}),t.promise}}]),angular.module("app.dashboard.teacher").component("teacherDashboard",{templateUrl:"/assets/app/dashboard/teacher/teacherDashboard.template.html",controller:["TeacherDashboard","Exam","DateTime","Session","EXAM_CONF","ExamRes","dialogs","$translate","$location","$filter","toast",function(e,t,n,a,i,o,r,s,c,u,l){var m=this;m.$onInit=function(){m.activeTab=c.search().tab?parseInt(c.search().tab):1,m.userId=a.getUser().id,m.templates={dashboardToolbarPath:i.TEMPLATES_PATH+"dashboard/teacher/templates/toolbar.html",dashboardActiveExamsPath:i.TEMPLATES_PATH+"dashboard/teacher/templates/active_exams.html",dashboardFinishedExamsPath:i.TEMPLATES_PATH+"dashboard/teacher/templates/finished_exams.html",dashboardArchivedExamsPath:i.TEMPLATES_PATH+"dashboard/teacher/templates/archived_exams.html",dashboardDraftExamsPath:i.TEMPLATES_PATH+"dashboard/teacher/templates/draft_exams.html"},m.pageSize=10,m.filter=c.search().filter?{text:c.search().filter}:{},m.reduceDraftCount=0,e.populate(m).then(function(){m.filteredFinished=m.finishedExams,m.filteredActive=m.activeExams,m.filteredArchived=m.archivedExams,m.filteredDraft=m.draftExams,m.filter.text&&m.search()})},m.changeTab=function(e){c.search("tab",e)},m.printExamDuration=function(e){return n.printExamDuration(e)},m.getUsername=function(){return a.getUserName()},m.getExecutionTypeTranslation=function(e){return t.getExecutionTypeTranslation(e.executionType.type)},m.checkOwner=function(e){return!!e&&(m.reduceDraftCount+=1,!0)},m.search=function(){c.search("filter",m.filter.text),m.reduceDraftCount=0,m.filteredFinished=u("filter")(m.finishedExams,m.filter.text),m.filteredActive=u("filter")(m.activeExams,m.filter.text),m.filteredArchived=u("filter")(m.archivedExams,m.filter.text),m.filteredDraft=u("filter")(m.draftExams,m.filter.text),m.filteredDraft=m.filteredDraft.filter(function(e){return e.examOwners.filter(function(e){return e.id===m.userId}).length>0&&e}),m.filteredFinished=m.filteredFinished.filter(function(e){var t=e.examOwners.filter(function(e){return e.id===m.userId});return(t.length>0||0===t.length&&e.unassessedCount>0)&&e}),m.filteredActive=m.filteredActive.filter(function(e){var t=e.examOwners.filter(function(e){return e.id===m.userId});return(t.length>0||0===t.length&&e.unassessedCount>0)&&e})},m.copyExam=function(e,t){o.exams.copy({id:e.id,type:t},function(e){l.success(s.instant("sitnet_exam_copied")),c.path("/exams/"+e.id+"/1/")},function(e){l.error(e.data)})},m.deleteExam=function(e,t){r.confirm(s.instant("sitnet_confirm"),s.instant("sitnet_remove_exam")).result.then(function(n){o.exams.remove({id:e.id},function(n){l.success(s.instant("sitnet_exam_removed")),"archived"===t&&m.archivedExams.splice(m.archivedExams.indexOf(e),1),"finished"===t&&m.finishedExams.splice(m.finishedExams.indexOf(e),1),"draft"===t&&m.draftExams.splice(m.draftExams.indexOf(e),1),"active"===t&&m.activeExams.splice(m.activeExams.indexOf(e),1)},function(e){l.error(e.data)})},function(e){})},m.isOwner=function(e){return e.examOwners.some(function(e){return e.id===m.userId})},m.filterOwners=function(e){if(!e)return!1;return e.examOwners.filter(function(e){return e.id===m.userId}).length>0}}]}),angular.module("app.dashboard.teacher").service("TeacherDashboard",["$q","Exam","Reservation","ExamRes",function(e,t,n,a){var i=function(e){return"PUBLIC"===e.executionType.type||e.examEnrolments.length>0},o=function(e){return e.examinationDates.some(function(e){return Date.now()<=new Date(e.date).setHours(23,59,59,999)})},r=function(e){var t=e.examinationDates.map(function(e){return e.date});e.examActiveStartDate=Math.min.apply(Math,t),e.examActiveEndDate=Math.max.apply(Math,t)};this.populate=function(s){var c=e.defer();return t.listExecutionTypes().then(function(e){s.executionTypes=e,a.reviewerExams.query(function(e){s.draftExams=e.filter(function(e){return("DRAFT"===e.state||"SAVED"===e.state)&&t.isOwner(e)}),s.draftExams.forEach(function(e){e.ownerAggregate=e.examOwners.map(function(e){return e.firstName+" "+e.lastName}).join()}),s.activeExams=e.filter(function(e){if("PUBLISHED"!==e.state)return!1;var t="PRINTOUT"!==e.executionType.type&&Date.now()<=new Date(e.examActiveEndDate)&&i(e),n="PRINTOUT"===e.executionType.type&&o(e);return t||n}),s.activeExams.forEach(function(e){"PRINTOUT"===e.executionType.type&&r(e),e.unassessedCount=t.getReviewablesCount(e),e.unfinishedCount=t.getGradedCount(e),e.reservationCount=n.getReservationCount(e),e.ownerAggregate=e.examOwners.map(function(e){return e.firstName+" "+e.lastName}).join()}),s.finishedExams=[],s.archivedExams=[];return e.filter(function(e){if("PUBLISHED"!==e.state)return!1;var t="PRINTOUT"!==e.executionType.type&&(Date.now()>new Date(e.examActiveEndDate)||!i(e)),n="PRINTOUT"===e.executionType.type&&!o(e);return t||n}).forEach(function(e){e.ownerAggregate=e.examOwners.map(function(e){return e.firstName+" "+e.lastName}).join();var n=t.getReviewablesCount(e),a=t.getGradedCount(e);n+a>0&&"PRINTOUT"!==e.executionType.type?(e.unassessedCount=n,e.unfinishedCount=a,s.finishedExams.push(e)):("PRINTOUT"===e.executionType.type&&r(e),e.assessedCount=t.getProcessedCount(e),s.archivedExams.push(e))}),c.resolve(s)},function(e){return c.reject(e)})}),c.promise}}]),angular.module("app.enrolment").component("activeEnrolment",{templateUrl:"/assets/app/enrolment/active/activeEnrolment.template.html",bindings:{enrolment:"<",onRemoval:"&"},controller:["$translate","dialogs","Enrolment","Reservation","toast",function(e,t,n,a,i){var o=this;o.removeReservation=function(){a.removeReservation(o.enrolment)},o.removeEnrolment=function(){o.enrolment.reservation?i.error(e.instant("sitnet_cancel_reservation_first")):t.confirm(e.instant("sitnet_confirm"),e.instant("sitnet_are_you_sure")).result.then(function(){n.removeEnrolment(o.enrolment).then(function(){o.onRemoval({data:o.enrolment})})})},o.addEnrolmentInformation=function(){n.addEnrolmentInformation(o.enrolment)},o.getRoomInstruction=function(){var t,n=o.enrolment.reservation;return n.externalReservation?t=n.externalReservation:n.machine&&(t=n.machine.room),t["roomInstruction"+e.use().toUpperCase()]||t.roomInstruction},o.showMaturityInstructions=function(){n.showMaturityInstructions(o.enrolment)}}]}),angular.module("app.enrolment").factory("EnrollRes",["$resource",function(e){return{list:e("/app/enroll/:code",{code:"@code"},{get:{method:"GET",isArray:!0,params:{code:"@code"}}}),enrolment:e("/app/enroll/:id",{id:"@id"},{remove:{method:"DELETE"}}),enroll:e("/app/enroll/:code/exam/:id",{code:"@code",id:"@id"},{get:{method:"GET",isArray:!1,params:{code:"@code",id:"@id"}},create:{method:"POST",params:{code:"@code",id:"@id"}}}),enrollStudent:e("/app/enroll/student/:eid",{eid:"@eid"},{create:{method:"POST",params:{eid:"@eid"}}}),unenrollStudent:e("/app/enroll/student/:id",{id:"@id"},{remove:{method:"DELETE"}}),reservations:e("/app/machines/:id/reservations",{id:"@id"},{get:{method:"GET",isArray:!0}}),enrolmentsByReservation:e("/app/enroll/reservation/:id",{code:"@id"},{get:{method:"GET",isArray:!0,params:{code:"@code"}}}),check:e("/app/enroll/exam/:id",{code:"@id"},{get:{method:"GET",isArray:!0,params:{id:"@id"}}})}}]),angular.module("app.enrolment").service("Enrolment",["$translate","$q","$http","$location","$uibModal","dialogs","Language","EnrollRes","SettingsResource","StudentExamRes","EXAM_CONF","toast",function(e,t,n,a,i,o,r,s,c,u,l,m){var d=this;d.enroll=function(n){var i=t.defer();return s.enroll.create({code:n.course.code,id:n.id},function(){m.success(e.instant("sitnet_you_have_enrolled_to_exam")+"<br/>"+e.instant("sitnet_remember_exam_machine_reservation")),a.path("/calendar/"+n.id),i.resolve()},function(e){m.error(e.data),i.reject(e)}),i.promise},d.checkAndEnroll=function(t){s.check.get({id:t.id},function(){m.error(e.instant("sitnet_already_enrolled"))},function(e){403===e.status&&m.error(e.data),404===e.status&&d.enroll(t)})},d.enrollStudent=function(n,a){var i=t.defer(),o={eid:n.id};return a.id?o.uid=a.id:o.email=a.email,s.enrollStudent.create(o,function(t){m.success(e.instant("sitnet_student_enrolled_to_exam")),i.resolve(t)},function(e){i.reject(e)}),i.promise},d.getExamEnrolment=function(e,n){var a=t.defer();return s.enroll.get({code:e,id:n},function(e){e.languages=e.examLanguages.map(function(e){return r.getLanguageNativeName(e.code)}),function(e){var n=t.defer();1!==e.examLanguages.length&&console.warn("Exam has no exam languages or it has several!");var a=e.examLanguages.length>0?e.examLanguages[0].code:"fi";return c.maturityInstructions.get({lang:a},function(t){return e.maturityInstructions=t.value,n.resolve(e)}),n.promise}(e).then(function(t){e=t,s.check.get({id:e.id},function(t){e.alreadyEnrolled=!0,e.reservationMade=t.some(function(e){return e.reservation}),a.resolve(e)},function(t){e.alreadyEnrolled=404!==t.status,403===t.status&&(e.noTrialsLeft=!0),e.reservationMade=!1,a.resolve(e)})})},function(e){a.reject(e)}),a.promise},d.listEnrolments=function(e,n){var a=t.defer();return s.list.get({code:e},function(e){var t=e.filter(function(e){return e.id!==parseInt(n)});t.forEach(function(e){return e.languages=e.examLanguages.map(function(e){return r.getLanguageNativeName(e.code)}),e}),p(t).then(function(e){a.resolve(e)})},function(e){m.error(e.data),a.reject()}),a.promise};var p=function(e){var n=t.defer(),a=[];return e.forEach(function(e){a.push(function(e){var n=t.defer();return s.check.get({id:e.id},function(t){t.forEach(function(t){t.reservation&&(e.reservationMade=!0)}),e.enrolled=!0,n.resolve(e)},function(t){e.enrolled=!1,e.reservationMade=!1,n.resolve(e)}),n.promise}(e).then(function(t){angular.extend(e,t)}))}),t.all(a).then(function(){n.resolve(e)}),n.promise};d.removeEnrolment=function(e){return s.enrolment.remove({id:e.id}).$promise},d.addEnrolmentInformation=function(t){var n=["$scope","$uibModalInstance",function(n,a){n.enrolment=angular.copy(t),n.ok=function(){a.close("Accepted"),t.information=n.enrolment.information,u.enrolment.update({eid:t.id,information:n.enrolment.information},function(){m.success(e.instant("sitnet_saved"))})},n.cancel=function(){a.close("Canceled")}}];i.open({templateUrl:l.TEMPLATES_PATH+"enrolment/active/dialogs/add_enrolment_information.html",backdrop:"static",keyboard:!0,controller:n,resolve:{enrolment:function(){return t}}}).result.then(function(){console.log("closed")})},d.getRoomInstructions=function(e){return n.get("/app/enroll/room/"+e)},d.showInstructions=function(e){var t=["$scope","$uibModalInstance",function(t,n){t.title="sitnet_instruction",t.instructions=e.exam.enrollInstruction,t.ok=function(){n.close("Accepted")}}];i.open({templateUrl:l.TEMPLATES_PATH+"reservation/show_instructions.html",backdrop:"static",keyboard:!0,controller:t,resolve:{instructions:function(){return e.exam.enrollInstruction}}}).result.then(function(){console.log("closed")})},d.showMaturityInstructions=function(e){var t=["$scope","$uibModalInstance","SettingsResource",function(t,n,a){1!==e.exam.examLanguages.length&&console.warn("Exam has no exam languages or it has several!");var i=e.exam.examLanguages&&e.exam.examLanguages.length>0?e.exam.examLanguages[0].code:"fi";t.title="sitnet_maturity_instructions",a.maturityInstructions.get({lang:i},function(e){t.instructions=e.value}),t.ok=function(){n.close("Accepted")}}];i.open({templateUrl:l.TEMPLATES_PATH+"reservation/show_instructions.html",backdrop:"static",keyboard:!0,controller:t,resolve:{instructions:function(){return e.exam.enrollInstruction}}}).result.then(function(){console.log("closed")})}}]),angular.module("app.enrolment").component("enrolmentCandidate",{templateUrl:"/assets/app/enrolment/exams/examEnrolmentCandidate.template.html",bindings:{exam:"<"},controller:["$location","Enrolment",function(e,t){var n=this;n.enrollForExam=function(){t.checkAndEnroll(n.exam)},n.makeReservation=function(){e.path("/calendar/"+n.exam.id)}}]}),angular.module("app.enrolment").component("enrolmentDetails",{templateUrl:"/assets/app/enrolment/exams/examEnrolmentDetails.template.html",bindings:{exam:"<"},controller:["Exam","Enrolment","DateTime",function(e,t,n){var a=this;a.enrollForExam=function(){t.checkAndEnroll(a.exam)},a.translateExamType=function(){return e.getExamTypeDisplayName(a.exam.examType.type)},a.translateGradeScale=function(){return e.getScaleDisplayName(a.exam.gradeScale||a.exam.course.gradeScale)},a.printExamDuration=function(){return n.printExamDuration(a.exam)}}]}),angular.module("app.enrolment").component("examEnrolments",{template:'<div id="dashboard">\n    <div class="main-row" ng-show="$ctrl.exam.noTrialsLeft">\n        <div class="col-md-12 alert-danger">\n            <h4>{{\'sitnet_no_trials_left\' | translate}}</h4>\n        </div>\n    </div>\n    <enrolment-details ng-if="$ctrl.exam" exam="$ctrl.exam"></enrolment-details>\n    <div ng-show="$ctrl.exams.length > 0" class="student-details-title-wrap subtitle">\n        <div class="student-exam-details-title subtitle">{{\'sitnet_student_exams\' | translate}}</div>\n    </div>\n    <div class="exams-list">\n        <enrolment-candidate ng-repeat="exam in $ctrl.exams" exam="exam"></enrolment-candidate>\n    </div>\n</div>\n',controller:["$routeParams","Enrolment","toast",function(e,t,n){var a=this;a.$onInit=function(){t.getExamEnrolment(e.code,e.id).then(function(e){a.exam=e},function(e){n.error(e.data)}),t.listEnrolments(e.code,e.id).then(function(e){a.exams=e})}}]}),angular.module("app.enrolment").component("examFeedback",{templateUrl:"/assets/app/enrolment/finished/examFeedback.template.html",bindings:{assessment:"<",scores:"<"},controller:["Attachment",function(e){var t=this;t.downloadFeedbackAttachment=function(){e.downloadFeedbackAttachment(t.assessment)},t.downloadStatementAttachment=function(){e.downloadStatementAttachment(t.assessment)}}]}),angular.module("app.enrolment").component("examParticipation",{templateUrl:"/assets/app/enrolment/finished/examParticipation.template.html",bindings:{participation:"<"},controller:["$scope","$translate","StudentExamRes","Exam",function(e,t,n,a){var i=this;i.$onInit=function(){var e=i.participation.exam.state;("GRADED_LOGGED"===e||"REJECTED"===e||"ARCHIVED"===e||"GRADED"===e&&i.participation.exam.autoEvaluationNotified)&&o()};var o=function(){n.feedback.get({eid:i.participation.exam.id},function(e){e.grade||(e.grade={name:"NONE"}),e.languageInspection?(e.grade.displayName=t.instant(e.languageInspection.approved?"sitnet_approved":"sitnet_rejected"),e.contentGrade=a.getExamGradeDisplayName(e.grade.name),e.gradedTime=e.languageInspection.finishedAt):e.grade.displayName=a.getExamGradeDisplayName(e.grade.name),a.setCredit(e),e.creditType&&(e.creditType.displayName=a.getExamTypeDisplayName(e.creditType.type)),i.participation.reviewedExam=e,n.scores.get({eid:i.participation.exam.id},function(e){i.participation.scores={maxScore:e.maxScore,totalScore:e.totalScore,approvedAnswerCount:e.approvedAnswerCount,rejectedAnswerCount:e.rejectedAnswerCount,hasApprovedRejectedAnswers:e.approvedAnswerCount+e.rejectedAnswerCount>0}})})};e.$on("$localeChangeSuccess",function(){i.participation.reviewedExam&&(i.participation.reviewedExam.grade.displayName=a.getExamGradeDisplayName(i.participation.reviewedExam.grade.name))})}]}),angular.module("app.enrolment").component("examParticipations",{templateUrl:"/assets/app/enrolment/finished/examParticipations.template.html",controller:["$scope","$translate","StudentExamRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.filter={ordering:"-ended",text:null},i.pageSize=10,i.search()},i.search=function(){n.finishedExams.query({filter:i.filter.text},function(e){e.filter(function(e){return!e.ended}).forEach(function(e){e.ended=e.reservation.endAt}),i.participations=e},function(e){a.error(e.data)})}}]}),angular.module("app.enrolment").component("examSearch",{templateUrl:"/assets/app/enrolment/search/examSearch.template.html",controller:["StudentExamRes","EnrollRes","SettingsResource","Language","toast",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.filter={},o.loader={loading:!1},n.enrolmentPermissions.get(function(e){o.permissionCheck=e,!0===e.active&&(o.loader.loading=!0,r())})},o.search=function(){!1===o.permissionCheck.active&&(o.filter.text?(o.loader.loading=!0,r()):delete o.exams)};var r=function(){e.exams.query({filter:o.filter.text},function(e){e.forEach(function(e){e.examLanguages||(console.warn("No languages for exam #"+e.id),e.examLanguages=[]),e.languages=e.examLanguages.map(function(e){return a.getLanguageNativeName(e.code)})}),o.exams=e,s(),o.loader.loading=!1},function(e){o.loader.loading=!1,i.error(e.data)})},s=function(){o.exams.forEach(function(e){t.check.get({id:e.id},function(t){t.forEach(function(t){t.reservation&&(e.reservationMade=!0)}),e.enrolled=!0},function(t){e.enrolled=!1,e.reservationMade=!1})})}}]}),angular.module("app.enrolment").component("examSearchResult",{templateUrl:"/assets/app/enrolment/search/examSearchResult.template.html",bindings:{exam:"<"},controller:["$location","Enrolment",function(e,t){var n=this;n.enrollForExam=function(){t.checkAndEnroll(n.exam)},n.makeReservation=function(){e.path("/calendar/"+n.exam.id)}}]}),angular.module("app.enrolment").component("waitingRoom",{templateUrl:"/assets/app/enrolment/waiting-room/waitingRoom.template.html",controller:["$http","$routeParams","$timeout","$translate","$location","StudentExamRes","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){t.id&&(s.upcoming=!0,o.enrolment.get({eid:t.id},function(e){u(e.reservation),s.enrolment=e;var t=c();s.timeout=n(function(){i.path("/student/exam/"+s.enrolment.exam.hash)},t);var o=s.enrolment.reservation.machine.room,r=a.use().toUpperCase();s.roomInstructions="FI"===r?o.roomInstruction:o["roomInstruction"+r]},function(e){r.error(e.data)}))},s.$onDestroy=function(){s.timeout&&n.cancel(s.timeout)};var c=function(){var e=moment(s.enrolment.reservation.startAt);return moment().isDST()&&e.add(-1,"hour"),Date.parse(e.format())-(new Date).getTime()},u=function(e){var t=e.machine.room.localTimezone,n=moment.tz(e.startAt,t),a=moment.tz(e.endAt,t);n.isDST()&&n.add(-1,"hour"),a.isDST()&&a.add(-1,"hour"),e.occasion={startAt:n.format("HH:mm"),endAt:a.format("HH:mm")}}}]}),angular.module("app.enrolment").component("wrongLocation",{templateUrl:"/assets/app/enrolment/wrong-location/wrongLocation.template.html",bindings:{cause:"@"},controller:["$http","$routeParams","$translate","Enrolment","StudentExamRes","DateTime","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){t.eid&&(s.upcoming=!0,i.enrolment.get({eid:t.eid},function(a){c(a.reservation),s.enrolment=a;var i=s.enrolment.reservation.machine.room,r=n.use().toUpperCase();s.roomInstructions="FI"===r?i.roomInstruction:i["roomInstruction"+r],e.get("/app/machines/"+t.mid).success(function(e){s.currentMachine=e}),s.printExamDuration=function(){return o.printExamDuration(s.enrolment.exam)}},function(e){r.error(e.data)}))};var c=function(e){var t=e.machine.room.localTimezone,n=moment.tz(e.startAt,t),a=moment.tz(e.endAt,t);n.isDST()&&n.add(-1,"hour"),a.isDST()&&a.add(-1,"hour"),e.occasion={startAt:n.format("HH:mm"),endAt:a.format("HH:mm")}};s.showInstructions=function(){a.showInstructions(s.enrolment)}}]}),angular.module("app.enrolment").service("WrongLocation",["$timeout","$translate","toast",function(e,t,n){this.display=function(e){var a={timeOut:1e4},i=moment(e[4]),o=moment();o.isDST()&&i.add(-1,"hour");i.isAfter(o)?t(["sitnet_your_exam_will_start_at","sitnet_at_location","sitnet_at_room","sitnet_at_machine"]).then(function(t){n.warning(t.sitnet_your_exam_will_start_at+" "+i.format("HH:mm")+" "+t.sitnet_at_location+": "+e[0]+", "+e[1]+" "+t.sitnet_at_room+" "+e[2]+" "+t.sitnet_at_machine+" "+e[3],a)}):t(["sitnet_you_have_ongoing_exam_at_location","sitnet_at_room","sitnet_at_machine"]).then(function(t){n.error(t.sitnet_you_have_ongoing_exam_at_location+": "+e[0]+", "+e[1]+" "+t.sitnet_at_room+" "+e[2]+" "+t.sitnet_at_machine+" "+e[3],a)})}}]),angular.module("app.exam.editor").component("basicExamInfo",{templateUrl:"/assets/app/exam/editor/basic/basicExamInfo.template.html",bindings:{exam:"<",onUpdate:"&",onNextTabSelected:"&"},controller:["$location","$scope","$translate","$uibModal","dialogs","Exam","ExamRes","SettingsResource","Attachment","Files","toast",function(e,t,n,a,i,o,r,s,c,u,l){var m=this;m.$onInit=function(){p(),f(),s.gradeScale.get(function(e){m.gradeScaleSetting=e}),g()},t.$on("$localeChangeSuccess",function(){p(),f()}),m.updateExam=function(e){o.updateExam(m.exam).then(function(){l.info(n.instant("sitnet_exam_saved")),e&&delete m.exam.autoEvaluationConfig,m.onUpdate({props:{name:m.exam.name,code:m.exam.course.code}})},function(e){if(e.data){var t=e.data.message||e.data;l.error(n.instant(t))}})},m.onCourseChange=function(e){m.exam.course=e,g(),m.onUpdate({props:{name:m.exam.name,code:m.exam.course.code}})},m.getExecutionTypeTranslation=function(){return!m.exam||o.getExecutionTypeTranslation(m.exam.executionType.type)},m.checkExamType=function(e){return m.exam.examType.type===e?"btn-primary":""},m.setExamType=function(e){m.exam.examType.type=e,m.updateExam()},m.getSelectableScales=function(){return m.gradeScales&&m.exam&&m.exam.course&&!angular.isUndefined(m.gradeScaleSetting)?m.gradeScales.filter(function(e){return m.gradeScaleSetting.overridable||!m.exam.course.gradeScale||m.exam.course.gradeScale.id===e.id}):[]},m.checkScale=function(e){return m.exam.gradeScale&&m.exam.gradeScale.id===e.id?"btn-primary":""},m.checkScaleDisabled=function(e){return!!(e&&m.exam.course&&m.exam.course.gradeScale)&&(!m.gradeScaleSetting.overridable&&m.exam.course.gradeScale.id===e.id)},m.setScale=function(e){m.exam.gradeScale=e,m.updateExam(!0)},m.selectAttachmentFile=function(){a.open({backdrop:"static",keyboard:!0,animation:!0,component:"attachmentSelector",resolve:{isTeacherModal:function(){return!0}}}).result.then(function(e){u.upload("/app/attachment/exam",e.attachmentFile,{examId:m.exam.id},m.exam)})},m.downloadExamAttachment=function(){c.downloadExamAttachment(m.exam)},m.removeExamAttachment=function(){c.removeExamAttachment(m.exam)},m.removeExam=function(t){if(d()){var a=function(){r.exams.remove({id:m.exam.id},function(){l.success(n.instant("sitnet_exam_removed")),e.path("/")},function(e){l.error(e.data)})};if(t)a();else{i.confirm(n.instant("sitnet_confirm"),n.instant("sitnet_remove_exam")).result.then(function(){a()})}}else l.warning(n.instant("sitnet_exam_removal_not_possible"))},m.nextTab=function(){m.onNextTabSelected()};var d=function(){return!m.exam.hasEnrolmentsInEffect&&0===m.exam.children.length},p=function(){o.refreshExamTypes().then(function(e){"MATURITY"===m.exam.executionType.type&&(e=e.filter(function(e){return"FINAL"===e.type})),m.examTypes=e})},f=function(){o.refreshGradeScales().then(function(e){m.gradeScales=e})},g=function(){!m.exam.gradeScale&&m.exam.course&&m.exam.course.gradeScale&&(m.exam.gradeScale=m.exam.course.gradeScale)}}]}),angular.module("app.exam.editor").component("examCourse",{templateUrl:"/assets/app/exam/editor/basic/examCourse.template.html",bindings:{exam:"<",onUpdate:"&"},controller:["Exam",function(e){var t=this;t.displayGradeScale=function(){return t.exam.course&&t.exam.course.gradeScale?e.getScaleDisplayName(t.exam.course.gradeScale):null},t.setCourse=function(e){angular.extend(t.exam.course,e),t.onUpdate({course:e})}}]}),angular.module("app.exam.editor").component("examInspectorSelector",{templateUrl:"/assets/app/exam/editor/basic/examInspectorSelector.template.html",bindings:{exam:"<"},controller:["$translate","limitToFilter","ExamRes","UserRes","toast",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.newInspector={id:null,name:null,sendMessage:!1,comment:""},r()},o.allInspectors=function(e,n){return a.filterUsersByExam.query({role:"TEACHER",eid:o.exam.id,q:n}).$promise.then(function(e){return t(e,15)},function(e){i.error(e.data)})},o.setInspector=function(e,t,n){o.newInspector.id=e.id},o.addInspector=function(){o.newInspector.id>0?n.inspection.insert({eid:o.exam.id,uid:o.newInspector.id,comment:o.newInspector.comment||""},function(){r(),delete o.newInspector},function(e){i.error(e.data)}):i.error(e.instant("sitnet_teacher_not_found"))},o.removeInspector=function(e){n.inspector.remove({id:e},function(){r()},function(e){i.error(e.data)})};function r(){n.inspections.get({id:o.exam.id},function(e){o.examInspections=e},function(e){i.error(e.data)})}}]}),angular.module("app.exam.editor").component("examOwnerSelector",{templateUrl:"/assets/app/exam/editor/basic/examOwnerSelector.template.html",bindings:{exam:"<"},controller:["$translate","limitToFilter","ExamRes","UserRes","toast",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.newOwner={id:null,name:null},o.examOwners=r()},o.allExamOwners=function(e,n){return a.filterOwnersByExam.query({role:"TEACHER",eid:o.exam.id,q:n}).$promise.then(function(e){return t(e,15)},function(e){i.error(e.data)})},o.setExamOwner=function(e,t,n){o.newOwner.id=e.id},o.addExamOwner=function(){o.newOwner.id>0?n.examowner.insert({eid:o.exam.id,uid:o.newOwner.id},function(){r(),delete o.newOwner.name,delete o.newOwner.id},function(e){i.error(e.data)}):i.error(e.instant("sitnet_teacher_not_found"))},o.removeOwner=function(e){n.examowner.remove({eid:o.exam.id,uid:e},function(){r()},function(e){i.error(e.data)})};function r(){n.owners.query({id:o.exam.id},function(e){o.examOwners=e},function(e){i.error(e.data)})}}]}),angular.module("app.exam.editor").component("softwareSelector",{templateUrl:"/assets/app/exam/editor/basic/softwareSelector.template.html",bindings:{exam:"<"},controller:["$translate","SoftwareRes","ExamRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.software=t.softwares.query()},i.selectedSoftware=function(){return 0===i.exam.softwares.length?e.instant("sitnet_select"):i.exam.softwares.map(function(e){return e.name}).join(", ")},i.isSelected=function(e){return i.exam.softwares.map(function(e){return e.id}).indexOf(e.id)>-1},i.updateExamSoftware=function(t){n.software.update({eid:i.exam.id,sid:t.id},function(){if(i.isSelected(t)){var n=i.exam.softwares.map(function(e){return e.id}).indexOf(t.id);i.exam.softwares.splice(n,1)}else i.exam.softwares.push(t);a.info(e.instant("sitnet_exam_software_updated"))},function(e){a.error(e.data)})}}]}),angular.module("app.exam.editor").component("coursePicker",{templateUrl:"/assets/app/exam/editor/common/coursePicker.template.html",bindings:{exam:"<",onUpdate:"&"},controller:["$http","$translate","Course","ExamRes","toast",function(e,t,n,a,i){var o=this;o.getCourses=function(e,c){r(e,!0);var u=c;if(o.exam&&o.exam.course&&o.exam.course.id){var l=o.exam.course;o.exam.course=void 0,s(e,u),a.course.delete({eid:o.exam.id,cid:l.id},function(t){o.exam=t,s(e,u)})}return n.courseApi.query({filter:e,q:c}).$promise.then(function(n){return r(e,!1),n&&n.hasOwnProperty("length")&&0!==n.length||i.error(t.instant("sitnet_course_not_found")+" ( "+u+" )"),n},function(){return r(e,!1),o.exam.course=void 0,i.error(t.instant("sitnet_course_not_found")+" ( "+u+" )"),[]})},o.onCourseSelect=function(e,n,r,s){a.course.update({eid:s.id,cid:e.id},function(e){i.success(t.instant("sitnet_exam_associated_with_course")),o.exam.course=e,o.onUpdate({course:e})},function(){i.error(t.instant("sitnet_course_not_found"))}),o.exam.course=e};function r(e,t){e&&"code"===e?o.loadingCoursesByCode=t:e&&"name"===e&&(o.loadingCoursesByName=t)}function s(e,t){e&&"code"===e?o.exam.course={code:t}:e&&"name"===e&&(o.exam.course={name:t})}}]}),angular.module("app.exam").service("Course",["$resource",function(e){this.courseApi=e("/app/courses")}]),angular.module("app.exam.editor").component("languageSelector",{templateUrl:"/assets/app/exam/editor/common/languageSelector.template.html",bindings:{exam:"<"},controller:["$q","$translate","Language","ExamRes","toast",function(e,t,n,a,i){var o=this;o.$onInit=function(){n.languageApi.query(function(e){o.examLanguages=e.map(function(e){return e.name=n.getLanguageNativeName(e.code),e})})},o.selectedLanguages=function(){return 0===o.exam.examLanguages.length?t.instant("sitnet_select"):o.exam.examLanguages.map(function(e){return n.getLanguageNativeName(e.code)}).join(", ")},o.isSelected=function(e){return o.exam.examLanguages.map(function(e){return e.code}).indexOf(e.code)>-1},o.updateExamLanguage=function(e){a.language.update({eid:o.exam.id,code:e.code},function(){if(o.isSelected(e)){var n=o.exam.examLanguages.map(function(e){return e.code}).indexOf(e.code);o.exam.examLanguages.splice(n,1)}else o.exam.examLanguages.push(e);i.info(t.instant("sitnet_exam_language_updated"))},function(e){i.error(e.data)})}}]}),angular.module("app.exam.editor").component("courseSelection",{templateUrl:"/assets/app/exam/editor/creation/courseSelection.template.html",controller:["$translate","$q","$location","$routeParams","ExamRes","Exam","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){i.exams.get({id:a.id},function(e){s.exam=e})},s.getExecutionTypeTranslation=function(){return!s.exam||o.getExecutionTypeTranslation(s.exam.executionType.type)},s.updateExamName=function(){o.updateExam(s.exam).then(function(){r.info(e.instant("sitnet_exam_saved"))},function(t){if(t.data){var n=t.data.message||t.data;r.error(e.instant(n))}})},s.cancelNewExam=function(){i.exams.remove({id:s.exam.id},function(){r.success(e.instant("sitnet_exam_removed")),n.path("/")})},s.continueToExam=function(){n.path("/exams/"+s.exam.id+"/1")}}]}),angular.module("app.exam.editor").component("newExam",{templateUrl:"/assets/app/exam/editor/creation/newExam.template.html",controller:["Exam",function(e){var t=this;t.$onInit=function(){e.listExecutionTypes().then(function(e){t.executionTypes=e})},t.createExam=function(){t.type&&e.createExam(t.type.type)}}]}),angular.module("app.exam").factory("ExamRes",["$resource",function(e){return{exams:e("/app/exams/:id",{id:"@id"},{copy:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE"}}),examsearch:e("/app/examsearch"),examowner:e("/app/exam/:eid/owner/:uid",{eid:"@eid",uid:"@uid"},{insert:{method:"PUT"},remove:{method:"DELETE"}}),questions:e("/app/exams/:eid/section/:sid/question/:qid",{eid:"@eid",sid:"@sid",qid:"@qid"},{remove:{method:"DELETE",params:{eid:"@eid",sid:"@sid",qid:"@qid"}}}),sections:e("/app/exams/:eid/section/:sid",{eid:"@eid",sid:"@sid"},{insert:{method:"POST",params:{eid:"@eid",sid:"@sid"}},remove:{method:"DELETE",params:{eid:"@eid",sid:"@sid"}},update:{method:"PUT",params:{eid:"@eid",sid:"@sid"}}}),questionDistribution:e("/app/exams/question/:id/distribution",{id:"@id"}),sectionquestions:e("/app/exams/:eid/section/:sid/:seq/question/:qid",{eid:"@eid",sid:"@sid",seq:"@seq",qid:"@qid"},{insert:{method:"POST",params:{eid:"@eid",sid:"@sid",seq:"@seq",qid:"@qid"}}}),sectionquestionsmultiple:e("/app/exams/:eid/section/:sid/:seq/questions",{eid:"@eid",sid:"@sid",seq:"@seq",questions:"@questions"},{insert:{method:"POST",params:{eid:"@eid",sid:"@sid",seq:"@seq",questions:"@questions"}}}),questionOrder:e("/app/exams/:eid/section/:sid/reorder",{eid:"@eid",sid:"@sid"},{update:{method:"PUT",params:{eid:"@eid",sid:"@sid"}}}),sectionOrder:e("/app/exams/:eid/reorder",{eid:"@eid"},{update:{method:"PUT",params:{eid:"@eid"}}}),clearsection:e("/app/exams/:eid/section/:sid/clear",{eid:"@eid",sid:"@sid"},{clear:{method:"DELETE",params:{eid:"@eid",sid:"@sid"}}}),course:e("/app/exams/:eid/course/:cid",{eid:"@eid",sid:"@cid"},{update:{method:"PUT",params:{eid:"@eid",cid:"@cid"}},delete:{method:"DELETE",params:{eid:"@eid",cid:"@cid"}}}),reviewerExams:e("/app/reviewerexams"),reviewerExam:e("/app/review/:eid",{eid:"@eid"}),draft:e("/app/exams",null,{create:{method:"POST"}}),review:e("/app/review/:id",{id:"@id"},{update:{method:"PUT"}}),inspectionComment:e("/app/review/:id/inspection",{id:"@id"},{create:{method:"POST"}}),examReviews:e("/app/reviews/:eid",{eid:"@eid"},{get:{method:"GET",params:{eid:"@eid"}}}),noShows:e("/app/noshows/:eid",{eid:"@eid"}),archive:e("/app/reviews/archive",{},{update:{method:"PUT"}}),comment:e("/app/review/:eid/comment/:cid",{id:"@eid",cid:"@cid"},{insert:{method:"POST",params:{eid:"@eid"}},update:{method:"PUT",params:{eid:"@eid",sid:"@cid"}}}),inspections:e("/app/exam/:id/inspections",{id:"@id"},{get:{method:"GET",isArray:!0,params:{id:"@id"}}}),owners:e("/app/exam/:id/owners",{id:"@id"}),inspection:e("/app/exams/:eid/inspector/:uid",{eid:"@eid",uid:"@uid"},{insert:{method:"POST",params:{eid:"@eid",uid:"@uid"}}}),inspectionReady:e("/app/exams/inspection/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),inspector:e("/app/exams/inspector/:id",{id:"@id"},{remove:{method:"DELETE",params:{id:"@id"}}}),examEnrolments:e("/app/examenrolments/:eid",{eid:"@eid"},{get:{method:"GET",params:{eid:"@eid"}}}),examParticipations:e("/app/examparticipations/:eid",{eid:"@eid"},{get:{method:"GET",params:{eid:"@eid"}}}),examParticipationsOfUser:e("/app/examparticipations/:eid/:uid",{eid:"@eid",uid:"@uid"},{get:{method:"GET",params:{eid:"@eid",uid:"@uid"}}}),studentInfo:e("/app/review/info/:id",{id:"@id"}),email:e("/app/email/inspection/:eid",{eid:"@eid"},{inspection:{method:"POST",params:{eid:"@eid"}}}),saveRecord:e("/app/exam/record",null,{add:{method:"POST"}}),register:e("/app/exam/register",null,{add:{method:"POST"}}),record:e("/app/exam/record/export/:id",{id:"@id"},{export:{method:"GET",params:{id:"@id"}}}),language:e("/app/exam/:eid/language/:code",{eid:"@eid",code:"@code"},{update:{method:"PUT"}}),languages:e("/app/exam/:eid/languages",{eid:"@eid"},{reset:{method:"DELETE"}}),examTypes:e("/app/examtypes"),executionTypes:e("/app/executiontypes"),gradeScales:e("/app/gradescales"),software:e("/app/exam/:eid/software/:sid",{eid:"@eid",sid:"@sid"},{update:{method:"PUT"}}),reservation:e("/app/reservations/:id",{id:"@id"},{update:{method:"PUT"}}),reservationInfo:e("/app/exams/:eid/reservation",{eid:"@eid"}),examinationDate:e("/app/exam/:eid/examinationdate/:edid",{eid:"@eid",edid:"@edid"},{create:{method:"POST",params:{eid:"@eid"}},delete:{method:"DELETE"}})}}]),angular.module("app.exam.editor").component("examTabs",{templateUrl:"/assets/app/exam/editor/examTabs.template.html",controller:["$routeParams","$translate","ExamRes","Session","$window",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.user=a.getUser(),o.examInfo={},n.exams.get({id:e.id},function(e){o.exam=e,o.updateTitle(e.course?e.course.code:void 0,e.name)}),o.activeTab=parseInt(e.tab)},o.reload=function(){n.exams.get({id:e.id},function(e){o.exam=e})},o.updateTitle=function(e,n){o.examInfo.title=e&&n?e+" "+n:e?e+" "+t.instant("sitnet_no_name"):n},o.isOwner=function(){return o.exam.examOwners.some(function(e){return e.id===o.user.id})},o.switchToBasicInfo=function(){o.activeTab=1},o.switchToQuestions=function(){o.activeTab=2},o.switchToPublishSettings=function(){o.activeTab=3},o.titleUpdated=function(e){o.updateTitle(e.code,e.name)},o.goBack=function(e){e.preventDefault(),i.history.back()}}]}),angular.module("app.exam.editor").component("autoEvaluation",{templateUrl:"/assets/app/exam/editor/publication/autoEvaluation.template.html",bindings:{exam:"<",onEnabled:"&",onDisabled:"&",onUpdate:"&"},controller:["Exam",function(e){var t=this;t.$onInit=function(){t.autoevaluation={releaseTypes:[{name:"IMMEDIATE",translation:"sitnet_autoevaluation_release_type_immediate",filtered:!0},{name:"GIVEN_DATE",translation:"sitnet_autoevaluation_release_type_given_date"},{name:"GIVEN_AMOUNT_DAYS",translation:"sitnet_autoevaluation_release_type_given_days"},{name:"AFTER_EXAM_PERIOD",translation:"sitnet_autoevaluation_release_type_period"},{name:"NEVER",translation:"sitnet_autoevaluation_release_type_never"}]},t.autoevaluationDisplay={visible:!1},n()};var n=function(){t.autoevaluation.enabled=!!t.exam.autoEvaluationConfig,!t.exam.autoEvaluationConfig&&t.exam.gradeScale&&(t.exam.autoEvaluationConfig={releaseType:t.selectedReleaseType().name||t.autoevaluation.releaseTypes[0].name,releaseDate:null,gradeEvaluations:t.exam.gradeScale.grades.map(function(e){return{grade:angular.copy(e),percentage:0}})}),t.exam.autoEvaluationConfig&&(t.exam.autoEvaluationConfig.gradeEvaluations.sort(function(e,t){return e.grade.id-t.grade.id}),t.applyFilter(function(e){var n=t.autoevaluation.releaseTypes.filter(function(t){return t.name===e});return n.length>0?n[0]:null}(t.exam.autoEvaluationConfig.releaseType)))};t.calculateExamMaxScore=function(){return e.getMaxScore(t.exam)},t.getGradeDisplayName=function(t){return e.getExamGradeDisplayName(t.name)},t.calculatePointLimit=function(e){var n=t.calculateExamMaxScore();if(0===e.percentage||isNaN(e.percentage))return 0;return(n*e.percentage/100).toFixed(2)},t.selectedReleaseType=function(){var e=null;return t.autoevaluation.releaseTypes.some(function(t){if(t.filtered)return e=t,!0}),e},t.applyFilter=function(e){t.autoevaluation.releaseTypes.forEach(function(e){e.filtered=!1}),e.filtered=!e.filtered,t.exam.autoEvaluationConfig.releaseType=t.selectedReleaseType(),t.onUpdate({config:t.exam.autoEvaluationConfig})},t.releaseDateChanged=function(e){t.exam.autoEvaluationConfig.releaseDate=e,t.onUpdate({config:t.exam.autoEvaluationConfig})},t.propertyChanged=function(){t.onUpdate({config:t.exam.autoEvaluationConfig})}}]}),angular.module("app.exam.editor").component("examParticipantSelector",{templateUrl:"/assets/app/exam/editor/publication/examParticipantSelector.template.html",bindings:{exam:"<"},controller:["$translate","limitToFilter","UserRes","Enrolment","EnrollRes","toast",function(e,t,n,a,i,o){var r=this;r.$onInit=function(){r.newParticipant={id:null,name:null};var e=[];r.exam.children.forEach(function(t){e=e.concat(t.examEnrolments)}),r.exam.participants=e},r.allStudents=function(e,a){return n.unenrolledStudents.query({eid:r.exam.id,q:a}).$promise.then(function(e){return t(e,15)},function(e){o.error(e.data)})},r.setExamParticipant=function(e,t,n){r.newParticipant.id=e.id},r.addParticipant=function(){a.enrollStudent(r.exam,r.newParticipant).then(function(e){r.exam.examEnrolments.push(e),delete r.newParticipant.name,delete r.newParticipant.id},function(e){o.error(e.data)})},r.removeParticipant=function(t){i.unenrollStudent.remove({id:t},function(){r.exam.examEnrolments=r.exam.examEnrolments.filter(function(e){return e.id!==t}),o.info(e.instant("sitnet_participant_removed"))},function(e){o.error(e.data)})},r.isActualEnrolment=function(e){return!e.preEnrolledUserEmail}}]}),angular.module("app.exam.editor").component("examPreParticipantSelector",{templateUrl:"/assets/app/exam/editor/publication/examPreParticipantSelector.template.html",bindings:{exam:"<"},controller:["$translate","Enrolment","EnrollRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.newPreParticipant={email:null}},i.addPreParticipant=function(){i.exam.examEnrolments.map(function(e){return e.preEnrolledUserEmail}).indexOf(i.newPreParticipant.email)>-1||t.enrollStudent(i.exam,i.newPreParticipant).then(function(e){i.exam.examEnrolments.push(e),delete i.newPreParticipant.email},function(e){a.error(e.data)})},i.removeParticipant=function(t){n.unenrollStudent.remove({id:t},function(){i.exam.examEnrolments=i.exam.examEnrolments.filter(function(e){return e.id!==t}),a.info(e.instant("sitnet_participant_removed"))},function(e){a.error(e.data)})},i.isPreEnrolment=function(e){return e.preEnrolledUserEmail}}]}),angular.module("app.exam.editor").component("examPublication",{templateUrl:"/assets/app/exam/editor/publication/examPublication.template.html",bindings:{exam:"<",onPreviousTabSelected:"&",onNextTabSelected:"&?"},controller:["$q","$translate","$location","$uibModal","Session","Exam","ExamRes","SettingsResource","EXAM_CONF","lodash","toast",function(e,t,n,a,i,o,r,s,c,u,l){var m=this;m.$onInit=function(){m.newExaminationDate={date:new Date},s.examDurations.get(function(e){m.examDurations=e.examDurations}),m.user=i.getUser(),m.hostName=window.location.origin,m.autoevaluation={enabled:!!m.exam.autoEvaluationConfig}},m.examinationDateChanged=function(e){m.newExaminationDate.date=e},m.addExaminationDate=function(e){m.exam.examinationDates.map(function(e){return moment(e.date).format("L")}).some(function(t){return t===moment(e).format("L")})||r.examinationDate.create({eid:m.exam.id,date:e},function(e){m.exam.examinationDates.push(e)})},m.removeExaminationDate=function(e){r.examinationDate.delete({eid:m.exam.id,edid:e.id},function(){var t=m.exam.examinationDates.indexOf(e);m.exam.examinationDates.splice(t,1)})},m.startDateChanged=function(e){m.exam.examActiveStartDate=e},m.endDateChanged=function(e){m.exam.examActiveEndDate=e},m.autoEvaluationConfigChanged=function(e){angular.extend(m.exam.autoEvaluationConfig,e)},m.updateExam=function(n,a){var i=e.defer(),r={evaluationConfig:m.autoevaluation.enabled&&m.canBeAutoEvaluated()?{releaseType:m.exam.autoEvaluationConfig.releaseType.name,releaseDate:new Date(m.exam.autoEvaluationConfig.releaseDate).getTime(),amountDays:m.exam.autoEvaluationConfig.amountDays,gradeEvaluations:m.exam.autoEvaluationConfig.gradeEvaluations}:null};return angular.extend(r,a),o.updateExam(m.exam,r).then(function(){n||l.info(t.instant("sitnet_exam_saved")),i.resolve()},function(e){if(e.data){var n=e.data.message||e.data;l.error(t.instant(n))}i.reject()}),i.promise},m.setExamDuration=function(e){m.exam.duration=e,m.updateExam()},m.checkDuration=function(e){return m.exam.duration===e?"btn-primary":""},m.range=function(e,t,n){n|=1;for(var a=[],i=e;i<=t;i+=n)a.push(i);return a},m.checkTrialCount=function(e){return m.exam.trialCount===e?"btn-primary":""},m.setTrialCount=function(e){m.exam.trialCount=e,m.updateExam()},m.canBeAutoEvaluated=function(){return o.hasQuestions(m.exam)&&!o.hasEssayQuestions(m.exam)&&m.exam.gradeScale&&"MATURITY"!==m.exam.executionType.type},m.previewExam=function(e){var t="PRINTOUT"===m.exam.executionType.type?"printout":"preview";n.path("/exams/"+m.exam.id+"/view/"+t+"/"+e)},m.nextTab=function(){m.onNextTabSelected()},m.previousTab=function(){m.onPreviousTabSelected()},m.saveAndPublishExam=function(){var e=p();Object.getOwnPropertyNames(e)&&Object.getOwnPropertyNames(e).length>0?a.open({templateUrl:c.TEMPLATES_PATH+"exam/editor/publication/publication_error_dialog.html",backdrop:"static",keyboard:!0,controller:["$scope","$uibModalInstance",function(t,n){t.errors=e,t.ok=function(){n.dismiss()}}],resolve:{errors:function(){return e}}}):a.open({templateUrl:c.TEMPLATES_PATH+"exam/editor/publication/publication_dialog.html",backdrop:"static",keyboard:!0,controller:["$scope","$uibModalInstance",function(e,n){e.getConfirmationText=function(){var e=t.instant("sitnet_publish_exam_confirm");return"PRINTOUT"!==m.exam.executionType.type&&(e+=" "+t.instant("sitnet_publish_exam_confirm_enroll")),e},e.ok=function(){n.close()},e.cancel=function(){n.dismiss()}}]}).result.then(function(){m.updateExam(!0,{state:"PUBLISHED"}).then(function(){l.success(t.instant("sitnet_exam_saved_and_published")),n.path("/")})})},m.unpublishExam=function(){d()?a.open({templateUrl:c.TEMPLATES_PATH+"exam/editor/publication/publication_revoke_dialog.html",backdrop:"static",keyboard:!0,controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss()}}]}).result.then(function(){m.updateExam(!0,{state:"SAVED"}).then(function(){l.success(t.instant("sitnet_exam_unpublished")),m.exam.state="SAVED"})},function(e){}):l.warning(t.instant("sitnet_unpublish_not_possible"))},m.autoEvaluationDisabled=function(){m.autoevaluation.enabled=!1},m.autoEvaluationEnabled=function(){m.autoevaluation.enabled=!0};var d=function(){return!m.exam.hasEnrolmentsInEffect&&0===m.exam.children.length},p=function(){var e={};m.exam.course||(e.course=t.instant("sitnet_course_missing")),(!m.exam.name||m.exam.name.length<2)&&(e.name=t.instant("sitnet_exam_name_missing_or_too_short")),0===m.exam.examLanguages.length&&(e.name=t.instant("sitnet_error_exam_empty_exam_language"));var n="PRINTOUT"===m.exam.executionType.type;n||m.exam.examActiveStartDate||(e.examActiveStartDate=t.instant("sitnet_exam_start_date_missing")),n||m.exam.examActiveEndDate||(e.examActiveEndDate=t.instant("sitnet_exam_end_date_missing")),n&&0===m.exam.examinationDates.length&&(e.examinationDates=t.instant("sitnet_examination_date_missing")),0===m.exam.examSections.reduce(function(e,t){return e+t.sectionQuestions.length},0)&&(e.questions=t.instant("sitnet_exam_has_no_questions")),m.exam.duration||(e.duration=t.instant("sitnet_exam_duration_missing")),m.exam.gradeScale||(e.grading=t.instant("sitnet_exam_grade_scale_missing")),m.exam.examType||(e.examType=t.instant("sitnet_exam_credit_type_missing"));return m.exam.examSections.every(function(e){return e.name})||(e.sectionNames=t.instant("sitnet_exam_contains_unnamed_sections")),["PRIVATE","MATURITY"].indexOf(m.exam.executionType.type)>-1&&m.exam.examEnrolments.length<1&&(e.participants=t.instant("sitnet_no_participants")),"MATURITY"!==m.exam.executionType.type||u.isBoolean(m.exam.subjectToLanguageInspection)||(e.languageInspection=t.instant("sitnet_language_inspection_setting_not_chosen")),m.autoevaluation.enabled&&function(){for(var e=m.exam.autoEvaluationConfig.gradeEvaluations.map(function(e){return e.percentage}).sort(),t=0;t<e.length-1;++t)if(e[t+1]===e[t])return!0;return!1}(exam)&&(e.autoevaluation=t.instant("sitnet_autoevaluation_percentages_not_unique")),e}}]}),angular.module("app.exam.editor").component("section",{templateUrl:"/assets/app/exam/editor/sections/section.template.html",bindings:{section:"<",examId:"<",onDelete:"&",onReloadRequired:"&"},controller:["$translate","$uibModal","dialogs","ExamRes","Question","toast",function(e,t,n,a,i,o){var r=this;r.clearAllQuestions=function(){n.confirm(e.instant("sitnet_confirm"),e.instant("sitnet_remove_all_questions")).result.then(function(){a.clearsection.clear({eid:r.examId,sid:r.section.id},function(){r.section.sectionQuestions.splice(0,r.section.sectionQuestions.length),r.section.lotteryOn=!1,o.info(e.instant("sitnet_all_questions_removed"))},function(e){o.error(e.data)})})},r.removeSection=function(){n.confirm(e.instant("sitnet_confirm"),e.instant("sitnet_remove_section")).result.then(function(){r.onDelete({section:r.section})})},r.renameSection=function(){a.sections.update({eid:r.examId,sid:r.section.id},c(r.section),function(t){o.info(e.instant("sitnet_section_updated"))},function(e){o.error(e.data)})},r.toggleLottery=function(){if(!r.toggleDisabled())return function(){if(!r.section.sectionQuestions)return!0;var e=r.section.sectionQuestions;if(e.length<1)return!0;var t=s(e[0]);return e.every(function(e){return t===s(e)})}()?void a.sections.update({eid:r.examId,sid:r.section.id},c(r.section),function(t){angular.isUndefined(r.section.lotteryItemCount)&&(r.section.lotteryItemCount=1),o.info(e.instant("sitnet_section_updated"))},function(e){o.error(e.data)}):(o.error(e.instant("sitnet_error_lottery_points_not_match")),void(r.section.lotteryOn=!1));r.section.lotteryOn=!1},r.toggleDisabled=function(){return!r.section.sectionQuestions||r.section.sectionQuestions.length<2},r.updateLotteryCount=function(){r.section.lotteryItemCount?a.sections.update({eid:r.examId,sid:r.section.id},c(r.section),function(t){o.info(e.instant("sitnet_section_updated"))},function(e){o.error(e.data)}):(o.warning(e.instant("sitnet_warn_lottery_count")),r.section.lotteryItemCount=1)},r.expandSection=function(){a.sections.update({eid:r.examId,sid:r.section.id},c(r.section))},r.moveQuestion=function(t,n){t>=0&&n>=0&&t!==n&&a.questionOrder.update({eid:r.examId,sid:r.section.id,from:t,to:n},function(){o.info(e.instant("sitnet_questions_reordered"))})},r.addNewQuestion=function(){r.section.lotteryOn?o.error(e.instant("sitnet_error_drop_disabled_lottery_on")):u()},r.removeQuestion=function(t){a.questions.remove({eid:r.examId,sid:r.section.id,qid:t.question.id},function(){r.section.sectionQuestions.splice(r.section.sectionQuestions.indexOf(t),1),o.info(e.instant("sitnet_question_removed")),r.section.sectionQuestions.length<2&&r.section.lotteryOn&&(r.section.lotteryOn=!1,r.section.lotteryItemCount=1,a.sections.update({eid:r.examId,sid:r.section.id},c(r.section)))},function(e){o.error(e.data)})},r.openLibrary=function(){r.section.lotteryOn?o.error(e.instant("sitnet_error_drop_disabled_lottery_on")):t.open({component:"questionSelector",backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",resolve:{examId:r.examId,sectionId:r.section.id,questionCount:r.section.sectionQuestions.length}}).result.then(function(e){r.onReloadRequired()})};function s(e){var t=e.evaluationType,n=e.question.type;return"Points"===t||"MultipleChoiceQuestion"===n||"ClozeTestQuestion"===n?e.maxScore:"WeightedMultipleChoiceQuestion"===n?i.calculateMaxPoints(e):null}var c=function(e){return{id:e.id,name:e.name,lotteryOn:e.lotteryOn,lotteryItemCount:e.lotteryItemCount,description:e.description,expanded:e.expanded}},u=function(){t.open({component:"baseQuestionEditor",backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",resolve:{newQuestion:!0}}).result.then(function(e){t=r.examId,n=r.section.id,i=e.question.id,s=r.section.sectionQuestions.length,a.sectionquestions.insert({eid:t,sid:n,seq:s,qid:i},function(){r.onReloadRequired()},function(e){o.error(e.data)});var t,n,i,s})}}]}),angular.module("app.exam.editor").component("sectionQuestion",{templateUrl:"/assets/app/exam/editor/sections/sectionQuestion.template.html",bindings:{sectionQuestion:"<",lotteryOn:"<",onDelete:"&"},controller:["$sce","$q","$uibModal","$translate","dialogs","Question","ExamQuestion","ExamRes","Attachment","toast",function(e,t,n,a,i,o,r,s,c,u){var l=this;l.calculateMaxPoints=function(){return o.calculateMaxPoints(l.sectionQuestion)},l.sanitizeQuestion=function(){return e.trustAsHtml(l.sectionQuestion.question.question)},l.editQuestion=function(){m()},l.downloadQuestionAttachment=function(){c.downloadQuestionAttachment(l.sectionQuestion.question)},l.removeQuestion=function(){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_remove_question")).result.then(function(){l.onDelete({sectionQuestion:l.sectionQuestion})})};var m=function(){(function(){var e=t.defer();return s.questionDistribution.get({id:l.sectionQuestion.id},function(t){e.resolve({distributed:t.distributed})},function(t){u.error(t.data),e.reject()}),e.promise})().then(function(e){e.distributed?p():d()})},d=function(){n.open({component:"baseQuestionEditor",backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",resolve:{lotteryOn:l.lotteryOn,questionId:l.sectionQuestion.question.id}}).result.then(function(e){r.undistributionApi.update({id:l.sectionQuestion.id},function(e){angular.extend(l.sectionQuestion,e)},function(e){u.error(e.data)})})},p=function(){n.open({component:"examQuestionEditor",backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",resolve:{examQuestion:angular.copy(l.sectionQuestion),lotteryOn:l.lotteryOn}}).result.then(function(e){o.updateDistributedExamQuestion(e.question,e.examQuestion).then(function(e){u.info(a.instant("sitnet_question_saved")),angular.extend(l.sectionQuestion,e)})})}}]}),angular.module("app.exam.editor").component("sections",{templateUrl:"/assets/app/exam/editor/sections/sectionsList.template.html",bindings:{exam:"<",onNextTabSelected:"&",onPreviousTabSelected:"&",onNewLibraryQuestion:"&"},controller:["$q","$translate","$location","dialogs","ExamRes","Exam","toast",function(e,t,n,a,i,o,r){var s=this,c=function(){s.exam.examSections.sort(function(e,t){return e.sequenceNumber-t.sequenceNumber}),l()};s.$onInit=function(){c()},s.$onChanges=function(e){e.exam&&c()},s.moveSection=function(e,n,a){n>=0&&a>=0&&n!==a&&i.sectionOrder.update({eid:s.exam.id,from:n,to:a},function(){l(),r.info(t.instant("sitnet_sections_reordered"))})},s.addNewSection=function(){i.sections.insert({eid:s.exam.id},{expanded:!0,questions:[]},function(e){r.success(t.instant("sitnet_section_added")),s.exam.examSections.push(e),l()},function(e){r.error(e.data)})},s.updateExam=function(n){var a=e.defer();return o.updateExam(s.exam).then(function(){n||r.info(t.instant("sitnet_exam_saved")),a.resolve()},function(e){if(e.data){var n=e.data.message||e.data;r.error(t.instant(n))}a.reject()}),a.promise},s.previewExam=function(e){var t="PRINTOUT"===s.exam.executionType.type?"printout":"preview";n.path("/exams/"+s.exam.id+"/view/"+t+"/"+e)},s.removeExam=function(){if(u()){a.confirm(t.instant("sitnet_confirm"),t.instant("sitnet_remove_exam")).result.then(function(){i.exams.remove({id:s.exam.id},function(){r.success(t.instant("sitnet_exam_removed")),n.path("/")},function(e){r.error(e.data)})})}else r.warning(t.instant("sitnet_exam_removal_not_possible"))},s.removeSection=function(e){i.sections.remove({eid:s.exam.id,sid:e.id},function(n){r.info(t.instant("sitnet_section_removed")),s.exam.examSections.splice(s.exam.examSections.indexOf(e),1),l()},function(e){r.error(e.data)})},s.calculateExamMaxScore=function(){return o.getMaxScore(s.exam)},s.nextTab=function(){s.onNextTabSelected()},s.previousTab=function(){s.onPreviousTabSelected()},s.onReloadRequired=function(){s.onNewLibraryQuestion()};var u=function(){return!s.exam.hasEnrolmentsInEffect&&0===s.exam.children.length},l=function(){angular.forEach(s.exam.examSections,function(e,t){e.index=t+1})}}]}),angular.module("app.exam").service("Exam",["$translate","$q","$location","ExamRes","Question","Session","toast",function(e,t,n,a,i,o,r){var s=this;s.getReviewablesCount=function(e){return e.children.filter(function(e){return"REVIEW"===e.state||"REVIEW_STARTED"===e.state}).length},s.getGradedCount=function(e){return e.children.filter(function(e){return"GRADED"===e.state}).length},s.getProcessedCount=function(e){return e.children.filter(function(e){return-1===["REVIEW","REVIEW_STARTED","GRADED"].indexOf(e.state)}).length},s.createExam=function(t){a.draft.create({executionType:t},function(t){r.info(e.instant("sitnet_exam_added")),n.path("/exams/"+t.id+"/select/course")},function(e){r.error(e.data)})},s.updateExam=function(e,n){var i={id:e.id,name:e.name||"",examType:e.examType,instruction:e.instruction||"",enrollInstruction:e.enrollInstruction||"",state:e.state,shared:e.shared,examActiveStartDate:e.examActiveStartDate?new Date(e.examActiveStartDate).getTime():void 0,examActiveEndDate:e.examActiveEndDate?new Date(e.examActiveEndDate).setHours(23,59,59,999):void 0,duration:e.duration,grading:e.gradeScale?e.gradeScale.id:void 0,expanded:e.expanded,trialCount:e.trialCount||void 0,subjectToLanguageInspection:e.subjectToLanguageInspection,internalRef:e.internalRef,objectVersion:e.objectVersion};for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);var r=t.defer();return a.exams.update(i,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},s.getExamTypeDisplayName=function(t){var n;switch(t){case"PARTIAL":n=e.instant("sitnet_exam_credit_type_partial");break;case"FINAL":n=e.instant("sitnet_exam_credit_type_final")}return n},s.getExamGradeDisplayName=function(t){var n;switch(t){case"NONE":n=e.instant("sitnet_no_grading");break;case"I":n="Improbatur";break;case"A":n="Approbatur";break;case"B":n="Lubenter approbatur";break;case"N":n="Non sine laude approbatur";break;case"C":n="Cum laude approbatur";break;case"M":n="Magna cum laude approbtur";break;case"E":n="Eximia cum laude approbatur";break;case"L":n="Laudatur approbatur";break;case"REJECTED":n=e.instant("sitnet_rejected");break;case"APPROVED":n=e.instant("sitnet_approved");break;default:n=t}return n},s.refreshExamTypes=function(){var e=t.defer();return a.examTypes.query(function(t){return e.resolve(t.map(function(e){return e.name=s.getExamTypeDisplayName(e.type),e}))}),e.promise},s.getScaleDisplayName=function(t){var n;switch(t.description||t){case"ZERO_TO_FIVE":n="0-5";break;case"LATIN":n="Improbatur-Laudatur";break;case"APPROVED_REJECTED":n=e.instant("sitnet_evaluation_select");break;case"OTHER":n=t.displayName||t}return n},s.refreshGradeScales=function(){var e=t.defer();return a.gradeScales.query(function(t){return e.resolve(t.map(function(e){return e.name=s.getScaleDisplayName(e),e}))}),e.promise},s.setCredit=function(e){void 0!==e.customCredit&&e.customCredit?e.credit=e.customCredit:e.credit=e.course&&e.course.credits?e.course.credits:0},s.listExecutionTypes=function(){var e=t.defer();return a.executionTypes.query(function(t){return t.forEach(function(e){"PUBLIC"===e.type&&(e.name="sitnet_public_exam"),"PRIVATE"===e.type&&(e.name="sitnet_private_exam"),"MATURITY"===e.type&&(e.name="sitnet_maturity"),"PRINTOUT"===e.type&&(e.name="sitnet_printout_exam")}),e.resolve(t)}),e.promise},s.getExecutionTypeTranslation=function(e){var t;return"PUBLIC"===e&&(t="sitnet_public_exam"),"PRIVATE"===e&&(t="sitnet_private_exam"),"MATURITY"===e&&(t="sitnet_maturity"),"PRINTOUT"===e&&(t="sitnet_printout_exam"),t},s.getSectionTotalScore=function(e){var t=0;return e.sectionQuestions.forEach(function(e){switch(e.question.type){case"MultipleChoiceQuestion":t+=i.scoreMultipleChoiceAnswer(e);break;case"WeightedMultipleChoiceQuestion":t+=i.scoreWeightedMultipleChoiceAnswer(e);break;case"ClozeTestQuestion":t+=i.scoreClozeTestAnswer(e);break;case"EssayQuestion":if(e.essayAnswer&&e.essayAnswer.evaluatedScore&&"Points"===e.evaluationType){var n=parseFloat(e.essayAnswer.evaluatedScore);angular.isNumber(n)&&(t+=n)}}}),t},s.getSectionMaxScore=function(e){var t=0;e.sectionQuestions.forEach(function(e){if(e&&e.question)switch(e.question.type){case"MultipleChoiceQuestion":case"ClozeTestQuestion":t+=e.maxScore;break;case"WeightedMultipleChoiceQuestion":t+=i.calculateMaxPoints(e);break;case"EssayQuestion":"Points"===e.evaluationType&&(t+=e.maxScore)}}),e.lotteryOn&&(t=t*e.lotteryItemCount/Math.max(1,e.sectionQuestions.length));return"number"==typeof(n=t)&&isFinite(n)&&Math.floor(n)===n?t:parseFloat(t.toFixed(2));var n},s.hasQuestions=function(e){return!(!e||!e.examSections)&&e.examSections.reduce(function(e,t){return e+t.sectionQuestions.length},0)>0},s.hasEssayQuestions=function(e){return!(!e||!e.examSections)&&e.examSections.filter(function(e){return e.sectionQuestions.some(function(e){return"EssayQuestion"===e.question.type})}).length>0},s.getMaxScore=function(e){if(!e||!e.examSections)return 0;var t=0;return e.examSections.forEach(function(e){t+=s.getSectionMaxScore(e)}),t},s.getTotalScore=function(e){if(!e||!e.examSections)return 0;var t=0;return e.examSections.forEach(function(e){t+=s.getSectionTotalScore(e)}),t.toFixed(2)},s.isOwner=function(e){var t=o.getUser(),n=e&&e.parent?e.parent:e;return n&&n.examOwners.filter(function(e){return e.id===t.id}).length>0},s.isOwnerOrAdmin=function(e){var t=o.getUser();return e&&t&&(t.isAdmin||s.isOwner(e))}}]),angular.module("app.exam").component("examList",{templateUrl:"/assets/app/exam/examList.template.html",controller:["dialogs","Session","Exam","$translate","$location","ExamRes","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){s.user=t.getUser(),s.user.isAdmin?(s.view="PUBLISHED",s.showExpired=!1,s.examsPredicate="examActiveEndDate",s.reverse=!0,s.filter={},s.loader={loading:!1},n.listExecutionTypes().then(function(e){s.executionTypes=e})):i.url("/")},s.search=function(){s.loader.loading=!0,o.exams.query({filter:s.filter.text},function(e){e.forEach(function(e){e.ownerAggregate=e.examOwners.map(function(e){return e.firstName+" "+e.lastName}).join(),"PUBLISHED"===e.state?e.expired=Date.now()>new Date(e.examActiveEndDate):e.expired=!1}),s.exams=e,s.loader.loading=!1},function(e){s.loader.loading=!1,r.error(a.instant(e.data))})},s.createExam=function(e){n.createExam(e)},s.copyExam=function(e,t){o.exams.copy({id:e.id,type:t},function(e){r.success(a.instant("sitnet_exam_copied")),i.path("/exams/"+e.id+"/1/")},function(e){r.error(e.data)})},s.deleteExam=function(t){e.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_remove_exam")).result.then(function(e){o.exams.remove({id:t.id},function(e){r.success(a.instant("sitnet_exam_removed")),s.exams.splice(s.exams.indexOf(t),1)},function(e){r.error(e.data)})},function(e){})},s.getExecutionTypeTranslation=function(e){return n.getExecutionTypeTranslation(e.executionType.type)}}]}),angular.module("app.exam").component("printout",{templateUrl:"/assets/app/exam/printout/printout.template.html",controller:["$http","$routeParams","$location","$sce","Files",function(e,t,n,a,i){var o=this;o.$onInit=function(){e.get("/app/exampreview/"+t.id).success(function(e){e.examSections.sort(function(e,t){return e.sequenceNumber-t.sequenceNumber}),e.examSections.forEach(function(e){e.sectionQuestions.filter(function(e){return"ClozeTestQuestion"===e.question.type&&e.clozeTestAnswer.answer}).forEach(function(e){e.clozeTestAnswer.answer=JSON.parse(e.clozeTestAnswer.answer)})}),e.examLanguages.forEach(function(e){e.ord=["fi","sv","en","de"].indexOf(e.code)}),angular.forEach(e.examSections,function(e,t){e.index=t+1}),o.exam=e})},o.getLanguageName=function(e){var t;switch(e.code){case"fi":t="suomeksi";break;case"sv":t="på svenska";break;case"en":t="in English";break;case"de":t="auf Deutsch"}return t},o.getQuestionTypeName=function(e){var t;switch(e.question.type){case"WeightedMultipleChoiceQuestion":t="Monivalintakysymys (voit valita monta) / Flervalsfråga (du kan välja många) / Multiple choice question (you can pick multiple)";break;case"MultipleChoiceQuestion":t="Monivalintakysymys (valitse yksi) / Flervalsfråga (välj en) / Multiple choice question (pick one)";break;case"EssayQuestion":t="Esseekysymys / Essefråga / Essay question";break;case"ClozeTestQuestion":t="Aukkotehtävä / Fyll i det som saknas / Cloze test question"}return t},o.exitPreview=function(){var e=t.tab?"/exams/"+t.id+"/"+t.tab:"/printouts";n.path(e)},o.print=function(){window.print()},o.printAttachment=function(){i.download("/app/attachment/exam/"+t.id,o.exam.attachment.fileName)},o.trustAsHtml=function(e){return a.trustAsHtml(e)}}]}),angular.module("app.exam").component("printoutListing",{template:'<div id="sitnet-header" class="header">\n    <div class="col-md-12 header-wrapper">\n        <span class="header-text">{{\'sitnet_printout_exams\' | translate}}</span>\n    </div>\n</div>\n<div id="dashboard">\n    <div class="top-row">\n        <div class="col-md-12">\n            <table class="table table-striped table-condensed exams-table">\n                <thead>\n                <tr>\n                    <th sort by="examinationDatesAggregate" text="sitnet_examination_dates" predicate="$ctrl.predicate"\n                        reverse="$ctrl.reverse"></th>\n                    <th sort by="course.code" text="sitnet_examcode" predicate="$ctrl.predicate"\n                        reverse="$ctrl.reverse"></th>\n                    <th sort by="name" text="sitnet_exam_name" predicate="$ctrl.predicate" reverse="$ctrl.reverse"></th>\n                    <th sort by="ownerAggregate" text="sitnet_teachers" predicate="$ctrl.predicate"\n                        reverse="$ctrl.reverse"></th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr ng-repeat="exam in $ctrl.printouts | orderBy:$ctrl.predicate:$ctrl.reverse">\n                    <td>{{ exam.examinationDatesAggregate }}</td>\n                    <td>{{exam.course.code}}</td>\n                    <td><a class="exams-info-title bold-button" href="/exams/{{exam.id}}/view/printout">{{exam.name}}</a>\n                    <td>\n                        <teacher-list exam="exam"/>\n                    </td>\n                </tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n</div>\n',controller:["$http",function(e){var t=this;t.$onInit=function(){t.predicate="examinationDatesAggregate",t.reverse=!0,e.get("/app/exam/printouts").success(function(e){e.forEach(function(e){var t=e.examinationDates.map(function(e){return e.date});t.sort(function(e,t){return e-t}),e.examinationDatesAggregate=t.map(function(e){return moment(e).format("DD.MM.YYYY")}).join(", ")}),t.printouts=e})}}]}),angular.module("app.exam").factory("StudentExamRes",["$resource",function(e){return{exams:e("/app/student/exams"),examInfo:e("/app/student/exam/:eid/info",{eid:"@eid"}),finishedExams:e("/app/student/finishedexams"),enrolments:e("/app/enrolments"),enrolment:e("/app/enrolments/:eid",{eid:"@eid"},{get:{method:"GET",params:{eid:"@eid"}},update:{method:"PUT",params:{eid:"@eid"}}}),feedback:e("/app/feedback/exams/:eid",{eid:"@eid"},{get:{method:"GET",params:{eid:"@eid"}}}),scores:e("/app/feedback/exams/:eid/score",{eid:"@eid"}),teachers:e("/app/student/inspectors/exam/:id",{id:"@id"},{get:{method:"GET",isArray:!0,params:{id:"@id"}}}),reservationInstructions:e("/app/student/exams/:id",{id:"@id"},{get:{method:"GET",isArray:!1,params:{id:"@id"}}})}}]),angular.module("app.examination").component("examinationClock",{template:'<div class="floating-clock">\n    <div class="header-wrapper">\n        <span ng-if="$ctrl.showRemainingTime" class="exam-clock-text">\n            <span class="sitnet-white">{{\'sitnet_exam_time_left\' | translate}}: </span>\n        </span>\n        <span class="exam-clock">\n            <span ng-if="$ctrl.showRemainingTime"\n                ng-class="$ctrl.remainingTime <= $ctrl.alarmThreshold ? \'sitnet-text-alarm\' : \'\'">\n                {{$ctrl.formatRemainingTime()}}\n            </span>\n            <span ng-if="!$ctrl.showRemainingTime" class="clock-hide"><i>{{\'sitnet_clock_hidden\' | translate}}</i></span>\n        </span>\n        <span>\n            <img ng-click="$ctrl.showRemainingTime = !$ctrl.showRemainingTime"\n                 src="/assets/assets/images/icon_clock.svg" alt="exam"\n                 onerror="this.onerror=null;this.src=\'/assets/assets/images/icon_clock.png\';"/>\n        </span>\n    </div>\n</div>\n',bindings:{examHash:"<",onTimeout:"&"},controller:["$timeout","$http",function(e,t){var n=this,a=16,i={};n.$onInit=function(){n.alarmThreshold=300,n.showRemainingTime=!0,o()},n.$onDestroy=function(){e.cancel(i)};var o=function(){++a>15?(a=0,r()):n.remainingTime&&n.remainingTime--,n.remainingTime&&n.remainingTime<0&&s(),i=e(o,1e3)},r=function(){t.get("/app/time/"+n.examHash).success(function(e){n.remainingTime=parseInt(e)})},s=function(){e.cancel(i),n.onTimeout()},c=function(e){return(e+="").length>1?e:"0"+e};n.formatRemainingTime=function(){if(!n.remainingTime)return"";var e=Math.floor(n.remainingTime/60/60),t=Math.floor(n.remainingTime/60)%60,a=n.remainingTime%60;return e+":"+c(t)+":"+c(a)}}]}),angular.module("app.examination").component("examination",{templateUrl:"/assets/app/examination/examination.template.html",bindings:{isPreview:"<"},controller:["$http","$location","$routeParams","$translate","Examination",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.isPreview||(window.onbeforeunload=function(){return a.instant("sitnet_unsaved_data_may_be_lost")}),i.startExam(n.hash,o.isPreview,n.id).then(function(e){e.examSections.sort(function(e,t){return e.sequenceNumber-t.sequenceNumber}),angular.forEach(e.examSections,function(e,t){e.index=t+1}),o.exam=e,r({type:"guide"})},function(){t.path("/")})},o.selectNewPage=function(e){r(e)},o.timedOut=function(){o.activeSection?i.saveAllTextualAnswersOfSection(o.activeSection,o.examHash,!0).then(function(){s("sitnet_exam_time_is_up")}):s("sitnet_exam_time_is_up")};var r=function(e){delete o.activeSection,"section"===e.type&&(o.activeSection=function(e){var t=o.exam.examSections.map(function(e){return e.id}).indexOf(e);if(t>=0)return o.exam.examSections[t]}(e.id)),window.scrollTo(0,0)},s=function(e){i.logout(e,o.exam.hash)}}]}),angular.module("app.examination").service("Examination",["$q","$location","$http","$translate","$window","lodash","toast",function(e,t,n,a,i,o,r){var s,c=this,u=function(e){return s?e.replace("/app/","/app/iop/"):e};c.startExam=function(a,i,o){var r=i&&o?"/app/exampreview/"+o:"/app/student/exam/"+a,c=e.defer();return n.get(r).success(function(e){e.cloned&&t.path("/student/exam/"+e.hash),s=e.external,c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},c.saveTextualAnswer=function(t,i,o){t.questionStatus=a.instant("sitnet_answer_saved");var s=e.defer(),l=t.question.type,m="EssayQuestion"===l?t.essayAnswer:t.clozeTestAnswer,d=u("EssayQuestion"===l?"/app/student/exam/"+i+"/question/"+t.id:"/app/student/exam/"+i+"/clozetest/"+t.id),p={answer:m.answer,objectVersion:m.objectVersion};return n.post(d,p).success(function(e){o?t.autosaved=new Date:(r.info(a.instant("sitnet_answer_saved")),c.setQuestionColors(t)),m.objectVersion=e.objectVersion,s.resolve()}).error(function(e){r.error(e.data),s.reject()}),s.promise};c.saveAllTextualAnswersOfSection=function(t,n,a,r){var s=e.defer(),u=t.sectionQuestions.filter(function(e){return function(e){switch(e.question.type){case"EssayQuestion":return e.essayAnswer&&e.essayAnswer.answer.length>0;case"ClozeTestQuestion":return e.clozeTestAnswer&&!o.isEmpty(e.clozeTestAnswer.answer);default:return!1}}(e)});return i.async.eachSeries(u,function(e,t){c.saveTextualAnswer(e,n,a).then(function(){t(null)},function(e){t(e)})},function(e){e&&r?s.reject():s.resolve()}),s.promise};c.isAnswered=function(e){var t;switch(e.question.type){case"EssayQuestion":var n=e.essayAnswer;t=n&&n.answer&&(i=n.answer,i&&-1===i.indexOf("math-tex")?String(i).replace(/<[^>]+>/gm,""):i).length>0;break;case"MultipleChoiceQuestion":t=angular.isDefined(e.selectedOption)||e.options.filter(function(e){return e.answered}).length>0;break;case"WeightedMultipleChoiceQuestion":t=e.options.filter(function(e){return e.answered}).length>0;break;case"ClozeTestQuestion":var a=e.clozeTestAnswer;t=a&&!o.isEmpty(a.answer);break;default:t=!1}var i;return t},c.setQuestionColors=function(e){c.isAnswered(e)?(e.answered=!0,e.questionStatus=a.instant("sitnet_question_answered"),e.selectedAnsweredState="question-answered-header"):(e.answered=!1,e.questionStatus=a.instant("sitnet_question_unanswered"),e.selectedAnsweredState="question-unanswered-header")},c.saveOption=function(e,t,i){var o;if(o="WeightedMultipleChoiceQuestion"===t.question.type?t.options.filter(function(e){return e.answered}).map(function(e){return e.id}):[t.selectedOption],i)c.setQuestionColors(t);else{var s=u("/app/student/exam/"+e+"/question/"+t.id+"/option");n.post(s,{oids:o}).success(function(){r.info(a.instant("sitnet_answer_saved")),t.options.forEach(function(e){e.answered=o.indexOf(e.id)>-1}),c.setQuestionColors(t)}).error(function(e){r.error(e.data)})}},c.abort=function(e){var t=u("/app/student/exam/abort/"+e);return n.put(t)},c.logout=function(e,i){var o=u("/app/student/exam/"+i);n.put(o).success(function(){r.info(a.instant(e),{timeOut:5e3}),window.onbeforeunload=null,t.path("/student/logout/finished")}).error(function(e){r.error(a.instant(e.data))})}}]),angular.module("app.examination").component("examinationHeader",{template:'<div class="row">\n    <div class="exam-header">\n        <div class="exam-header-img-wrap">\n            <img src="/assets/assets/images/exam-logo-mobile.svg" alt="exam"\n                 onerror="this.onerror=null;this.src=\'/assets/assets/images/exam-logo-mobile.png\'"/>\n        </div>\n        <div class="exam-header-title divider"></div>\n        <div class="exam-header-title">{{ $ctrl.exam.course.name }} <span>{{ $ctrl.exam.course.code }}</span></div>\n        <div class="language-selector">\n            <a class="exam-clock-text" ng-click="$ctrl.switchLanguage(\'fi\')">FI</a>\n            <a class="exam-clock-text" ng-click="$ctrl.switchLanguage(\'sv\')">SV</a>\n            <a class="exam-clock-text" ng-click="$ctrl.switchLanguage(\'en\')">EN</a>\n            <span class="exam-header-title divider"></span>\n        </div>\n        <examination-clock\n                ng-if="!$ctrl.isPreview" exam-hash="$ctrl.exam.hash" on-timeout="$ctrl.informTimeout()">\n        </examination-clock>\n    </div>\n</div>',bindings:{exam:"<",onTimeout:"&",isPreview:"<"},controller:["Session",function(e){var t=this;t.informTimeout=function(){t.onTimeout()},t.switchLanguage=function(t){e.switchLanguage(t)}}]}),angular.module("app.examination").component("answerInstructions",{template:'\x3c!-- ANSWER INSTRUCTIONS --\x3e<div class="studentexam-header">    <span class="exam-title">{{\'sitnet_exam_guide\' | translate}}</span></div><div class="guide-wrapper marr0 pad-15 col-md-12">    <div class="guide-column">        <span class="header col-md-4"><span>{{ \'sitnet_course_name\' | translate }}:</span></span>        <span class="text col-md-8">{{ $ctrl.exam.course.name }}&nbsp;</span>    </div>    <div class="guide-column">        <span class="header col-md-4"><span>{{ \'sitnet_course_code\' | translate }}:</span></span>        <span class="text col-md-8">{{ $ctrl.exam.course.code }}&nbsp;</span>    </div>    <div class="guide-column">        <span class="header col-md-4"><span>{{ \'sitnet_exam_name\' | translate }}:</span></span>        <span class="text col-md-8">{{ $ctrl.exam.name }}&nbsp;</span>    </div>    <div class="guide-column">        <span class="header col-md-4"><span>{{ \'sitnet_exam_duration\' | translate }}:</span></span>        <span class="text col-md-8">{{ $ctrl.printExamDuration() }}&nbsp;</span>    </div>    <div class="guide-column padtop">        <span>{{ \'sitnet_exam_guide\' | translate }}:</span>    </div>    <div class="guide-column">        <div class="list-group">            <form class="form-inline pad-15" role="form">                <div class="guide-instruction col-md-12" ng-bind-html="$ctrl.exam.instruction"></div>            </form>        </div>    </div></div>',bindings:{exam:"<"},controller:["DateTime",function(e){var t=this;t.printExamDuration=function(){return e.printExamDuration(t.exam)}}]}),angular.module("app.examination").component("examinationLogout",{template:'<div id="sitnet-header" class="header">    <div class="col-md-12 header-wrapper">        <span class="header-text">{{\'sitnet_end_of_exam\' | translate}}</span>    </div></div><div id="dashboard">    <div class="exam-logout-wrapper">        <h3 class="text-info" style="text-align: center">{{$ctrl.reasonPhrase | translate}} {{\'sitnet_log_out_will_commence\' | translate}}</h3>    </div></div>',controller:["$rootScope","$routeParams","$location","$timeout",function(e,t,n,a){var i=this;i.$onInit=function(){i.reasonPhrase="aborted"===t.reason?"sitnet_exam_aborted":"sitnet_exam_returned",a(function(){e.$broadcast("examEnded"),n.path("/logout")},8e3)}}]}),angular.module("app.examination").component("examinationNavigation",{template:'\x3c!-- SECTION NAVIGATION ARROWS AND LABELS --\x3e<div class="row exam-navigation">    <span class="col-md-12">        \x3c!-- PREVIOUS SECTION BUTTON --\x3e        <a class="green_button previous" ng-show="$ctrl.prev.valid" ng-click="$ctrl.previousPage()">            <img class="arrow_icon" src="/assets/assets/images/icon_left_white.png"> {{ $ctrl.prev.text | translate }}        </a>        \x3c!-- NEXT SECTION BUTTON --\x3e        <a class="green_button" ng-show="$ctrl.next.valid" ng-click="$ctrl.nextPage()">{{ $ctrl.next.text | translate }}            <img class="arrow_icon" src="/assets/assets/images/icon_right_white.png">        </a>    </span></div>',bindings:{exam:"<",activeSection:"<",onSelect:"&"},controller:[function(){var e=this,t=[];e.$onInit=function(){(t=e.exam.examSections.map(function(e){return{id:e.id,text:e.name,type:"section",valid:!0}})).unshift({text:"sitnet_exam_guide",type:"guide",valid:!0}),n()},e.$onChanges=function(e){e.activeSection&&n()};var n=function(){if(angular.isUndefined(e.activeSection))e.next=t[1],e.prev={valid:!1};else{var n=i();e.next=n>-1?t[n]:{valid:!1};var a=o();e.prev=a>-1?t[a]:{valid:!1}}},a=function(){var n=t.filter(function(t){return e.activeSection.id===t.id})[0];return t.indexOf(n)},i=function(){var e=a();return e+1===t.length?-1:e+1},o=function(){return a()-1};e.nextPage=function(){e.onSelect({page:e.next})},e.previousPage=function(){e.onSelect({page:e.prev})}}]}),angular.module("app.examination").component("examinationToolbar",{templateUrl:"/assets/app/examination/navigation/examinationToolbar.template.html",bindings:{exam:"<",activeSection:"<",isPreview:"<",onPageSelect:"&"},controller:["$http","$location","$routeParams","$translate","dialogs","Session","Examination","Attachment","Enrolment","toast",function(e,t,n,a,i,o,r,s,c,u){var l=this;l.$onInit=function(){l.isPreview||e.get("/app/enroll/room/"+l.exam.hash).success(function(e){l.room=e})},l.displayUser=function(){var e=o.getUser();if(e){var t=e.userIdentifier?" ("+e.userIdentifier+")":"";return e.firstName+" "+e.lastName+t}},l.turnExam=function(){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_confirm_turn_exam")).result.then(function(){l.activeSection?r.saveAllTextualAnswersOfSection(l.activeSection,l.exam.hash,!1).then(function(){r.logout("sitnet_exam_returned",l.exam.hash)}):r.logout("sitnet_exam_returned",l.exam.hash)})},l.abortExam=function(){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_confirm_abort_exam")).result.then(function(){r.abort(l.exam.hash).success(function(){u.info(a.instant("sitnet_exam_aborted"),{timeOut:5e3}),window.onbeforeunload=null,t.path("/student/logout/aborted")}).error(function(e){u.error(e.data)})})},l.downloadExamAttachment=function(){s.downloadExamAttachment(l.exam)},l.selectGuidePage=function(){l.onPageSelect({page:{type:"guide"}})},l.selectSection=function(e){l.onPageSelect({page:{id:e.id,type:"section"}})},l.getQuestionAmount=function(e,t){return"total"===t?e.sectionQuestions.length:"answered"===t?e.sectionQuestions.filter(function(e){return r.isAnswered(e)}).length:"unanswered"===t?e.sectionQuestions.length-e.sectionQuestions.filter(function(e){return r.isAnswered(e)}).length:void 0},l.displayRoomInstructions=function(){if(l.room)switch(a.use()){case"fi":return l.room.roomInstruction;case"sv":return l.room.roomInstructionSV;case"en":default:return l.room.roomInstructionEN}},l.showMaturityInstructions=function(){c.showMaturityInstructions({exam:l.exam})},l.exitPreview=function(){t.path("/exams/"+n.id+"/"+n.tab)}}]}),angular.module("app.examination").component("examinationClozeTest",{templateUrl:"/assets/app/examination/question/examinationClozeTest.template.html",bindings:{sq:"<",examHash:"<"},controller:["Examination",function(e){var t=this;t.saveAnswer=function(){e.saveTextualAnswer(t.sq,t.examHash,!1)}}]}),angular.module("app.examination").component("examinationEssayQuestion",{templateUrl:"/assets/app/examination/question/examinationEssayQuestion.template.html",bindings:{sq:"<",examHash:"<",isPreview:"<"},controller:["Examination","Attachment","Files",function(e,t,n){var a=this;a.$onInit=function(){e.setQuestionColors(a.sq)},a.saveAnswer=function(){e.saveTextualAnswer(a.sq,a.examHash,!1)},a.removeQuestionAnswerAttachment=function(){t.removeQuestionAnswerAttachment(a.sq.question,a.examHash)},a.selectFile=function(){a.isPreview||t.selectFile(!1).then(function(e){n.uploadAnswerAttachment("/app/attachment/question/answer",e.attachmentFile,{questionId:a.sq.id,answerId:a.sq.essayAnswer.id},a.sq.essayAnswer)})}}]}),angular.module("app.examination").component("examinationMultiChoiceQuestion",{template:'<div class="bottom-padding-2">    <div ng-repeat="sqo in $ctrl.sq.options | orderBy: \'id\'" class="exam-answer-options">        <input type="radio" ng-model="$ctrl.sq.selectedOption" ng-value="sqo.id"            ng-click="$ctrl.saveOption()"/>        {{sqo.option.option}}    </div></div><div class="padl0 question-type-text">    {{$ctrl.sq.derivedMaxScore}} {{\'sitnet_unit_points\' | translate}}</div>',bindings:{sq:"<",examHash:"<",isPreview:"<"},controller:["Examination",function(e){var t=this;t.$onInit=function(){var e=t.sq.options.filter(function(e){return e.answered});e.length>1&&console.warn("several answered options for mcq"),1===e.length&&(t.sq.selectedOption=e[0].id)},t.saveOption=function(){e.saveOption(t.examHash,t.sq,t.isPreview)}}]}),angular.module("app.examination").component("examinationQuestion",{templateUrl:"/assets/app/examination/question/examinationQuestion.template.html",bindings:{examHash:"<",sq:"<",isPreview:"<"},controller:["$sce","$filter","Examination","Attachment",function(e,t,n,a){var i=this;i.$onInit=function(){i.sq.expanded=!0;var e=i.sq.clozeTestAnswer;e&&"string"==typeof e.answer&&(e.answer=JSON.parse(e.answer))},i.displayQuestionText=function(t){var n=t?o(i.sq.question.question,240):i.sq.question.question;return e.trustAsHtml(n)},i.downloadQuestionAttachment=function(){a.downloadQuestionAttachment(i.sq.question)},i.isAnswered=function(){return n.isAnswered(i.sq)};var o=function(e,n){return t("truncate")(e,n)}}]}),angular.module("app.examination").component("examinationWeightedMultiChoiceQuestion",{template:'<div class="bottom-padding-2">    <div ng-repeat="sqo in $ctrl.sq.options | orderBy: \'id\'" class="exam-answer-options">        <input type="checkbox" name="selectedOption" ng-checked="sqo.answered" ng-model="sqo.answered"            ng-change="$ctrl.saveOption()"/>        {{sqo.option.option}}    </div></div><div class="padl0 question-type-text">    {{$ctrl.sq.derivedMaxScore}} {{\'sitnet_unit_points\' | translate}}</div>',bindings:{sq:"<",examHash:"<",isPreview:"<"},controller:["Examination",function(e){var t=this;t.saveOption=function(){e.saveOption(t.examHash,t.sq,t.isPreview)}}]}),angular.module("app.examination").component("examinationSection",{templateUrl:"/assets/app/examination/section/examinationSection.template.html",bindings:{examHash:"<",isPreview:"<",section:"<"},controller:["$interval","Examination",function(e,t){var n=this,a=null;n.$onInit=function(){i()},n.$onChanges=function(e){e.section&&i()},n.$onDestroy=function(){o()};var i=function(){o(),n.section&&(a=e(function(){t.saveAllTextualAnswersOfSection(n.section,n.examHash,!0)},6e4))},o=function(){a&&(e.cancel(a),a=null)}}]}),angular.module("app.facility.accessibility").component("accessibility",{templateUrl:"/assets/app/facility/accessibility/accessibility.template.html",controller:["$translate","$http","toast",function(e,t,n){var a=this;a.$onInit=function(){a.newItem={},t.get("/app/accessibility").success(function(e){a.accessibilities=e})},a.add=function(i){t.post("/app/accessibility",i).success(function(t){a.accessibilities.push(t),n.info(e.instant("sitnet_accessibility_added"))})},a.update=function(a){t.put("/app/accessibility",a).success(function(){n.info(e.instant("sitnet_accessibility_updated"))})},a.remove=function(i){t.delete("/app/accessibility/"+i.id).success(function(){a.accessibilities.splice(a.accessibilities.indexOf(i),1),n.info(e.instant("sitnet_accessibility_removed"))})}}]}),angular.module("app.facility.accessibility").component("accessibilitySelector",{templateUrl:"/assets/app/facility/accessibility/accessibilitySelector.template.html",bindings:{room:"<"},controller:["$translate","toast","$http",function(e,t,n){var a=this;a.$onInit=function(){n.get("/app/accessibility").success(function(e){a.accessibilities=e})},a.selectedAccessibilities=function(){return 0===a.room.accessibility.length?e.instant("sitnet_select"):a.room.accessibility.map(function(e){return e.name}).join(", ")},a.isSelected=function(e){return i(e)>-1},a.updateAccessibility=function(o){var r=i(o);r>-1?a.room.accessibility.splice(r,1):a.room.accessibility.push(o);var s=a.room.accessibility.map(function(e){return e.id}).join(", ");n.post("/app/room/"+a.room.id+"/accessibility",{ids:s}).success(function(){t.info(e.instant("sitnet_room_updated"))})};function i(e){return a.room.accessibility.map(function(e){return e.id}).indexOf(e.id)}}]}),angular.module("app.facility.address").component("examAddress",{templateUrl:"/assets/app/facility/address/address.template.html",bindings:{address:"<"},controller:["Room","toast","$translate",function(e,t,n){var a=this;a.updateAddress=function(){e.addresses.update(a.address,function(){t.info(n.instant("sitnet_room_address_updated"))},function(e){t.error(e.data)})}}]}),angular.module("app.facility.machines").component("machine",{templateUrl:"/assets/app/facility/machines/machine.template.html",controller:["$q","dialogs","$routeParams","$location","Machines","$translate","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){i.machine.get({id:n.id},function(e){s.machine=e,i.software.query(function(e){s.software=e,s.software.forEach(function(e){e.class=s.machine.softwareInfo.map(function(e){return e.id}).indexOf(e.id)>-1?"btn-info":"btn-default"})})},function(e){r.error(e.data)})},s.removeMachine=function(e){t.confirm(o.instant("sitnet_confirm"),o.instant("sitnet_remove_machine")).result.then(function(){i.machine.remove({id:e.id},function(){r.info(o.instant("sitnet_machine_removed")),a.path("/rooms/")},function(e){r.error(e.data)})})},s.toggleSoftware=function(e){i.machineSoftware.toggle({mid:s.machine.id,sid:e.id},function(t){e.class="true"===t.software?"btn-info":"btn-default"},function(e){r.error(e.data)})},s.updateMachine=function(){var t=e.defer();return i.machine.update(s.machine,function(){r.info(o.instant("sitnet_machine_updated")),t.resolve()},function(e){r.error(e.data),t.reject()}),t.promise},s.updateMachineAndExit=function(){s.updateMachine(s.machine).then(function(){a.path("/rooms/")})}}]}),angular.module("app.facility.machines").component("machineList",{templateUrl:"/assets/app/facility/machines/machineList.template.html",bindings:{room:"<"},controller:["Machines","$translate","toast",function(e,t,n){var a=this;a.$onInit=function(){a.showMachines=!0},a.toggleShow=function(){a.showMachines=!a.showMachines},a.countMachineAlerts=function(){return a.room?a.room.examMachines.filter(function(e){return e.outOfService}).length:0},a.countMachineNotices=function(){return a.room?a.room.examMachines.filter(function(e){return!e.outOfService&&e.statusComment}).length:0},a.addNewMachine=function(){e.machine.insert({id:a.room.id},{},function(e){n.info(t.instant("sitnet_machine_added")),a.room.examMachines.push(e)},function(e){n.error(e.data)})}}]}),angular.module("app.facility.machines").factory("Machines",["$resource",function(e){return{software:e("/app/softwares"),machineSoftware:e("/app/machine/:mid/software/:sid",{mid:"@mid",sid:"@sid"},{toggle:{method:"POST"}}),machine:e("/app/machines/:id",{id:"@id"},{get:{method:"GET"},update:{method:"PUT"},insert:{method:"POST"},remove:{method:"DELETE"}})}}]),angular.module("app.facility.rooms").component("multiRoom",{templateUrl:"/assets/app/facility/rooms/multiRoom.template.html",controller:["Room","toast",function(e,t){var n=this;n.$onInit=function(){n.week=e.getWeek(),a()},n.addException=function(t){e.addException(i(),t.exception).then(function(){a()})},n.deleteException=function(t){e.deleteException(n.rooms[0].id,t.id).then(function(){a()})},n.addMultiRoomException=function(){e.openExceptionDialog(n.addException)},n.updateWorkingHours=function(){e.updateWorkingHours(n.week,i())},n.massEditedRoomFilter=function(e){return e.calendarExceptionEvents.some(function(e){return e.massEdited})},n.massEditedExceptionFilter=function(e){return e.massEdited};function a(){e.rooms.query(function(e){n.rooms=e,n.roomIds=i()},function(e){t.error(e.data)})}function i(){return n.rooms.map(function(e){return e.id})}}]}),angular.module("app.facility.rooms").component("room",{templateUrl:"/assets/app/facility/rooms/room.template.html",controller:["$translate","$scope","$rootScope","$route","$location","$uibModal","$routeParams","$http","dialogs","Room","SettingsResource","InteroperabilityResource","DateTime","EXAM_CONF","toast",function(e,t,n,a,i,o,r,s,c,u,l,m,d,p,f){var g=this;g.$onInit=function(){g.week=u.getWeek(),g.showName=!0,l.iop.get(function(e){g.isInteroperable=e.isInteroperable}),u.rooms.get({id:r.id},function(t){t.availableForExternals=null!==t.externalRef,g.room=t,u.isAnyExamMachines(g.room)||f.warning(e.instant("sitnet_room_has_no_machines_yet")),g.room.calendarExceptionEvents.forEach(function(e){u.formatExceptionEvent(e)}),g.room.defaultWorkingHours.forEach(function(e){var t=function(e){for(var t=[],n=moment(e.startTime).format("H:mm"),a=moment(e.endTime).format("H:mm"),i=u.getTimes(),o="0:00"===n?0:i.indexOf(n);o<i.length&&i[o]!==a;o++)t.push(o);return t}(e);!function(e,t){for(var n=0;n<t.length;++n)g.week[e][t[n]]&&(g.week[e][t[n]].type="selected")}(e.weekday,t)})},function(e){f.error(e.data)})},g.updateWorkingHours=function(){u.updateWorkingHours(g.week,[g.room.id])},g.addException=function(e){u.addException([g.room.id],e).then(function(e){u.formatExceptionEvent(e),g.room.calendarExceptionEvents.push(e)})},g.deleteException=function(e){u.deleteException(g.room.id,e.id).then(function(){!function(e,t){var n=e.indexOf(t);e.splice(n,1)}(g.room.calendarExceptionEvents,e)})},g.disableRoom=function(){u.disableRoom(g.room)},g.enableRoom=function(){u.enableRoom(g.room)},g.updateRoom=function(){u.rooms.update(g.room,function(){f.info(e.instant("sitnet_room_updated"))},function(e){f.error(e.data)})},g.saveRoom=function(){u.isSomethingSelected(g.week)?(u.isAnyExamMachines(g.room)||f.error(e.instant("sitnet_dont_forget_to_add_machines")+" "+g.room.name),u.rooms.update(g.room,function(){f.info(e.instant("sitnet_room_saved")),i.path("/rooms/")},function(e){f.error(e.data)})):f.error(e.instant("sitnet_room_must_have_default_opening_hours"))},g.updateInteroperability=function(){m.facility.update(g.room,function(e){g.room.externalRef=e.externalRef,g.room.availableForExternals=null!==e.externalRef})}}]}),angular.module("app.facility.rooms").service("Room",["$resource","$translate","$route","dialogs","toast","$q","$uibModal",function(e,t,n,a,i,o,r){for(var s=this,c={MONDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),TUESDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),WEDNESDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),THURSDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),FRIDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),SATURDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}}),SUNDAY:Array.apply(null,new Array(48)).map(function(e,t){return{index:t,type:""}})},u=[""],l=0;l<=24;++l)l>0&&u.push(l+":00"),l<24&&u.push(l+":30");s.rooms=e("/app/rooms/:id",{id:"@id"},{update:{method:"PUT"},inactivate:{method:"DELETE"},activate:{method:"POST"}}),s.addresses=e("/app/address/:id",{id:"@id"},{update:{method:"PUT"}}),s.workingHours=e("/app/workinghours/",null,{update:{method:"PUT"}}),s.examStartingHours=e("/app/startinghours/",null,{update:{method:"PUT"}}),s.exceptions=e("/app/exception",{},{update:{method:"PUT"}}),s.exception=e("/app/rooms/:roomId/exception/:exceptionId",{roomId:"@roomId",exceptionId:"@exceptionId"},{remove:{method:"DELETE"}}),s.draft=e("/app/draft/rooms"),s.isAnyExamMachines=function(e){return e.examMachines&&e.examMachines.length>0},s.isSomethingSelected=function(e){for(var t in e)if(e.hasOwnProperty(t)&&!s.isEmpty(e,t))return!0;return!1},s.isEmpty=function(e,t){for(var n=0;n<e[t].length;++n)if(""!==e[t][n].type)return!1;return!0},s.getTimes=function(){return angular.copy(u)},s.getWeek=function(){return angular.copy(c)},s.disableRoom=function(e){a.confirm(t.instant("sitnet_confirm"),t.instant("sitnet_confirm_room_inactivation")).result.then(function(){s.rooms.inactivate({id:e.id},function(){i.info(t.instant("sitnet_room_inactivated")),n.reload()},function(e){i.error(e.data)})})},s.enableRoom=function(e){s.rooms.activate({id:e.id},function(){i.info(t.instant("sitnet_room_activated")),n.reload()},function(e){i.error(e.data)})},s.addException=function(e,n){var a=o.defer();return s.exceptions.update({roomIds:e,exception:n},function(e){i.info(t.instant("sitnet_exception_time_added")),a.resolve(e)},function(e){i.error(e.data),a.reject()}),a.promise},s.openExceptionDialog=function(e){r.open({component:"exception",backdrop:"static",keyboard:!0}).result.then(function(t){e({exception:t})})},s.deleteException=function(e,n){var a=o.defer();return s.exception.remove({roomId:e,exceptionId:n},function(){i.info(t.instant("sitnet_exception_time_removed")),a.resolve()},function(e){i.error(e.data),a.reject()}),a.promise},s.formatExceptionEvent=function(e){e.startDate=moment(e.startDate).format(),e.endDate=moment(e.endDate).format()},s.updateStartingHours=function(e,n,a){var r=o.defer(),c={hours:e.filter(function(e){return e.selected}).map(function(e){return d(e.startingHour)}),offset:n};return c.roomIds=a,s.examStartingHours.update(c,function(){i.info(t.instant("sitnet_exam_starting_hours_updated")),r.resolve()},function(e){i.error(e.data),r.reject()}),r.promise},s.updateWorkingHours=function(e,n){var a={},o=[],r=s.getTimes();for(var c in e)if(e.hasOwnProperty(c)){for(var u=m(e,c),l={weekday:c,blocks:[]},p=0;p<u.length;++p){var f=u[p],g=d(r[f[0]]||"0:00"),h=d(r[f[f.length-1]+1]);l.blocks.push({start:g,end:h})}o.push(l)}a.workingHours=o,a.roomIds=n,s.workingHours.update(a,function(){i.info(t.instant("sitnet_default_opening_hours_updated"))},function(e){i.error(e.data)})};function m(e,t){for(var n=[],a=[],i=0;i<e[t].length;++i)e[t][i].type?(a.push(i),i===e[t].length-1&&(n.push(a),a=[])):a.length>0&&(n.push(a),a=[]);return n}function d(e){var t=moment().isDST()?1:0;return moment().set("hour",parseInt(e.split(":")[0])+t).set("minute",e.split(":")[1]).format("DD.MM.YYYY HH:mmZZ")}}]),angular.module("app.facility.rooms").component("roomList",{templateUrl:"/assets/app/facility/rooms/roomList.template.html",controller:["$routeParams","Session","$location","Room","$translate","toast",function(e,t,n,a,i,o){var r=this;r.$onInit=function(){r.user=t.getUser(),r.user.isAdmin?e.id||a.rooms.query(function(e){r.times=a.getTimes(),r.rooms=e,angular.forEach(r.rooms,function(e){e.examMachines=e.examMachines.filter(function(e){return!e.archived})})}):n.path("/")},r.disableRoom=function(e){a.disableRoom(e)},r.enableRoom=function(e){a.enableRoom(e)},r.createExamRoom=function(){a.draft.get(function(e){o.info(i.instant("sitnet_room_draft_created")),n.path("/rooms/"+e.id)},function(e){o.error(e.data)})},r.editMultipleRooms=function(){n.path("/rooms_edit/edit_multiple")},r.isArchived=function(e){return!1===e.isArchived()},r.displayAddress=function(e){if(!e||!e.street&&!e.city&&!e.zip)return"N/A";var t=e.street?e.street+", ":"",n=(e.city||"").toUpperCase();return t+e.zip+" "+n}}]}),angular.module("app.facility.schedule").component("exception",{templateUrl:"/assets/app/facility/schedule/exception.template.html",bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$translate","toast",function(e,t){var n=this;n.$onInit=function(){var e=new Date;e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),n.dateOptions={"starting-day":1},n.dateFormat="dd.MM.yyyy",n.exception={startDate:e,endDate:angular.copy(e),outOfService:!0}},n.ok=function(){var a=moment(n.exception.startDate),i=moment(n.exception.endDate);i<=a?t.error(e.instant("sitnet_endtime_before_starttime")):n.close({$value:{startDate:a,endDate:i,outOfService:n.exception.outOfService}})},n.cancel=function(){n.dismiss({$value:"cancel"})}}]}),angular.module("app.facility.schedule").component("exceptionList",{templateUrl:"/assets/app/facility/schedule/exceptionList.template.html",bindings:{room:"<",hideButton:"<",hideTitle:"<",filter:"<",onCreate:"&",onDelete:"&"},controller:["Room",function(e){var t=this;t.$onInit=function(){},t.formatDate=function(e){var t="DD.MM.YYYY HH:mm",n=moment(e.startDate),a=moment(e.endDate);return n.format(t)+" - "+a.format(t)},t.addException=function(){e.openExceptionDialog(t.onCreate)},t.deleteException=function(e){t.onDelete({exception:e})}}]}),angular.module("app.facility.schedule").component("openHours",{templateUrl:"/assets/app/facility/schedule/openHours.template.html",bindings:{week:"<",onSelect:"&"},controller:["Room","DateTime","toast","$translate","$scope",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.weekdayNames=t.getWeekdayNames(),o.times=e.getTimes()},o.timeRange=function(){return Array.apply(null,new Array(o.times.length-1)).map(function(e,t){return t})},o.getWeekdays=function(){return Object.keys(o.week)},o.getType=function(e,t){return o.week[e][t].type},o.calculateTime=function(e){return(o.times[e]||"0:00")+" - "+o.times[e+1]},o.selectSlot=function(e,t){var n=0,a=o.week[e][t].type;if("accepted"!==a){if("selected"===a){for(n=0;n<o.week[e].length;++n)if(n>=t){if("selected"!==o.week[e][n].type)break;o.week[e][n].type=""}}else{var i;for(n=0;n<o.week[e].length;++n)if("accepted"===o.week[e][n].type){i=n;break}if(i>=0)if(i<t)for(n=i;n<=t;++n)o.week[e][n].type="selected";else for(n=t;n<=i;++n)o.week[e][n].type="selected";else o.week[e][t].type="accepted"}o.onSelect()}else o.week[e][t].type=""},i.$on("$localeChangeSuccess",function(){o.weekdayNames=t.getWeekdayNames()})}]}),angular.module("app.facility.schedule").component("startingTime",{templateUrl:"/assets/app/facility/schedule/startingTime.template.html",bindings:{roomIds:"<",startingHours:"<"},controller:["Room",function(e){var t=this;t.$onInit=function(){if(t.examStartingHours=Array.apply(null,new Array(24)).map(function(e,t){return{startingHour:t+":00",selected:!0}}),t.startingHours&&t.startingHours.length>0){var e=t.startingHours.map(function(e){return moment(e.startingHour)});t.examStartingHourOffset=e[0].minute(),e=e.map(function(e){return e.format("H:mm")}),t.setStartingHourOffset(),t.examStartingHours.forEach(function(t){t.selected=-1!==e.indexOf(t.startingHour)})}},t.updateStartingHours=function(){e.updateStartingHours(t.examStartingHours,t.examStartingHourOffset,t.roomIds).then(function(){t.startingHours&&(t.startingHours=t.examStartingHours)})},t.toggleAllExamStartingHours=function(){var e=t.examStartingHours.some(function(e){return e.selected});t.examStartingHours.forEach(function(t){t.selected=!e})},t.setStartingHourOffset=function(){t.examStartingHourOffset=t.examStartingHourOffset||0,t.examStartingHours.forEach(function(e){e.startingHour=e.startingHour.split(":")[0]+":"+(n=t.examStartingHourOffset,(n+="").length>1?n:"0"+n);var n})},t.anyStartingHoursSelected=function(){return t.examStartingHours.some(function(e){return e.selected})}}]}),angular.module("app.iop").factory("InteroperabilityResource",["$resource",function(e){return{facility:e("/integration/iop/facilities/:id",{id:"@id"},{update:{method:"PUT"}}),facilities:e("/integration/iop/facilities"),organisations:e("/integration/iop/organisations"),slots:e("/integration/iop/calendar/:examId/:roomRef",{examId:"@examId",roomRef:"@roomRef"}),reservations:e("/integration/iop/reservations/external",{},{create:{method:"POST"}}),reservation:e("/integration/iop/reservations/external/:ref",{ref:"@ref"},{remove:{method:"DELETE"}})}}]),angular.module("app.maturity").component("languageInspections",{templateUrl:"/assets/app/maturity/languageInspections.template.html",controller:["$translate","LanguageInspections","Session","EXAM_CONF","lodash",function(e,t,n,a,i){var o=this;o.$onInit=function(){o.user=n.getUser(),o.ongoingInspections=[],o.processedInspections=[],o.filters={},o.templates={ongoing:a.TEMPLATES_PATH+"maturity/templates/inspection_under_review.html",processed:a.TEMPLATES_PATH+"maturity/templates/inspection_reviewed.html"},o.sorting={ongoing:{predicate:"arrived",reverse:!1},processed:{predicate:"finishedAt",reverse:!1}},r()},o.startDateChanged=function(e){o.startDate=e,r()},o.endDateChanged=function(e){o.endDate=e,r()};var r=function(){var e={},n=6e4*(new Date).getTimezoneOffset();o.startDate&&(e.start=Date.parse(o.startDate)+n),o.endDate&&(e.end=Date.parse(moment(o.endDate).add(1,"days")));var a=i.isEmpty(e);t.query(a?void 0:e).then(function(e){e.forEach(function(e){e.ownerAggregate=e.exam.parent.examOwners.map(function(e){return e.firstName+" "+e.lastName}).join(", "),e.studentName=e.exam.creator?e.exam.creator.firstName+" "+e.exam.creator.lastName:"",e.studentNameAggregate=e.exam.creator?e.exam.creator.lastName+" "+e.exam.creator.firstName:"",e.inspectorName=e.modifier?e.modifier.firstName+" "+e.modifier.lastName:"",e.inspectorNameAggregate=e.modifier?e.modifier.lastName+" "+e.modifier.firstName:""}),a&&(o.ongoingInspections=e.filter(function(e){return!e.finishedAt})),o.processedInspections=e.filter(function(e){return e.finishedAt})})};o.assignInspection=function(e){t.assignInspection(e)},o.showStatement=function(e){t.showStatement(e)},o.getOngoingInspectionsDetails=function(){var t=o.ongoingInspections.length.toString();return e.instant("sitnet_ongoing_language_inspections_detail").replace("{0}",t)},o.getProcessedInspectionsDetails=function(){var t=o.processedInspections.length.toString(),n=moment().format("YYYY");return e.instant("sitnet_processed_language_inspections_detail").replace("{0}",t).replace("{1}",n)}}]}),angular.module("app.review").service("LanguageInspections",["$resource","$location","$uibModal","$translate","dialogs","EXAM_CONF","toast",function(e,t,n,a,i,o,r){var s=e("/app/inspections"),c=e("/app/inspection/:id",{id:"@id"},{update:{method:"PUT"}});this.query=function(e){return s.query(e).$promise},this.showStatement=function(e){var t=["$scope","$uibModalInstance",function(t,n){t.statement=e.comment,t.ok=function(){n.close("Accepted")}}];n.open({templateUrl:o.TEMPLATES_PATH+"maturity/dialogs/inspection_statement.html",backdrop:"static",keyboard:!0,controller:t,resolve:{statement:function(){return e.comment}}})},this.assignInspection=function(e){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_confirm_assign_inspection")).result.then(function(){c.update({id:e.id},function(){t.path("assessments/"+e.exam.id)},function(e){r.error(e)})})}}]),angular.module("app.maturity").component("maturityReporting",{templateUrl:"/assets/app/maturity/reporting/maturityReporting.template.html",controller:["$translate","LanguageInspections","Session","EXAM_CONF",function(e,t,n,a){var i=this;i.$onInit=function(){i.selection={opened:!1,month:new Date},i.query()},i.printReport=function(){setTimeout(function(){window.print()},500)},i.open=function(e){e.preventDefault(),e.stopPropagation(),i.selection.opened=!0},i.query=function(){var e={};i.selection.month&&(e.month=i.selection.month),t.query(e).then(function(e){i.processedInspections=e.filter(function(e){return e.finishedAt})})},i.showStatement=function(e){t.showStatement(e)}}]}),angular.module("app.navigation").component("navigation",{templateUrl:"/assets/app/navigation/navigation.template.html",controller:["$rootScope","$location","Session","Navigation",function(e,t,n,a){var i=this;i.isActive=function(e){return e.href===t.path()},i.canDisplayFullNavbar=function(){return window.matchMedia("(min-width: 600px)").matches},i.openMenu=function(){i.mobileMenuOpen=!i.mobileMenuOpen};var o=function(){if(i.user=n.getUser(),!i.user||i.user.isLoggedOut)return i.loggedOut=!0,delete i.appVersion,[];var e=i.user.isAdmin||!1,o=i.user.isStudent||!1,r=i.user.isTeacher||!1,s=i.user.isTeacher&&i.user.isLanguageInspector;e&&a.appVersion.get(function(e){i.appVersion=e.appVersion});var c=/\/student\/waiting-room|wrong-machine|wrong-room/.test(t.path()),u="sitnet_dashboard";return o&&(u="sitnet_user_enrolled_exams_title"),[{href:"/",visible:!c,class:"fa-home",name:u,icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/inspections",visible:s||e,class:"fa-language",name:"sitnet_language_inspections",icon_svg:"icon_language_inspection.svg",icon_png:"icon_language_inspection.png"},{href:"/exams",visible:e,class:"fa-paste",name:"sitnet_exams",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/printouts",visible:e,class:"fa-print",name:"sitnet_printout_exams"},{href:"/rooms",visible:e,class:"fa-building-o",name:"sitnet_exam_rooms",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/reports",visible:e,class:"fa-files-o",name:"sitnet_reports",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/statistics",visible:e,class:"fa-line-chart",name:"sitnet_statistics",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/settings",visible:e,class:"fa-wrench",name:"sitnet_settings",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"},{href:"/users",visible:e,class:"fa-users",name:"sitnet_users",icon_svg:"icon_reservations.svg",icon_png:"icon_reservations.png"},{href:"/questions",visible:e||r,class:"fa-list-ol",name:"sitnet_library_new",icon_svg:"icon_pencil.svg",icon_png:"icon_pencil.png"},{href:"/reservations",visible:r,class:"fa-clock-o",name:"sitnet_reservations_new",icon_svg:"icon_reservations.svg",icon_png:"icon_reservations.png"},{href:"/student/exams",visible:o&&!c,class:"fa-search",name:"sitnet_exams",sub:[],icon_svg:"icon_exams.svg",icon_png:"icon_exams.png"},{href:"/student/participations",visible:o&&!c,class:"fa-search",name:"sitnet_exam_responses",sub:[],icon_svg:"icon_finished.svg",icon_png:"icon_finished.png"},{href:"/logout",visible:o||e||r,class:"fa-sign-out",name:"sitnet_logout",icon_svg:"icon_logout.svg",icon_png:"icon_logout.png"},{href:"/login",visible:!i.user,class:"fa-sign-in",name:"sitnet_login",icon_svg:"icon_enrols.svg",icon_png:"icon_enrols.png"}]};e.$on("userUpdated",function(){i.links=o()}),e.$on("upcomingExam",function(){i.links=o()}),e.$on("wrongLocation",function(){i.links=o()}),i.switchLanguage=function(e){n.switchLanguage(e)},i.$onInit=function(){i.links=o()}}]}),angular.module("app.navigation").factory("Navigation",["$resource",function(e){return{appVersion:e("/app/settings/appVersion")}}]),angular.module("app.question").component("question",{template:'<div id="dashboard">\n    <div class="top-row">\n        <div class="col-md-12">\n            <div class="student-details-title-wrap">\n                <div class="student-enroll-title-wrap">\n                    <div ng-if="!$ctrl.newQuestion" class="student-enroll-title">{{\'sitnet_questions_edit\' | translate}}</div>\n                    <div ng-if="$ctrl.newQuestion" class="student-enroll-title">{{\'sitnet_toolbar_new_question\' | translate}}</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="marl50 marr50">\n        \x3c!-- Question body //--\x3e\n        <div class="col-md-12 question-border padl40 padr40">\n            <form role="form" class="form-horizontal" name="questionForm" novalidate>\n                <question-body ng-if="$ctrl.question" question="$ctrl.question"                        current-owners="$ctrl.currentOwners" lottery-on="$ctrl.lotteryOn"></question-body>\n            </form>\n            \x3c!-- buttons --\x3e\n            <div class="mart20">\n                <div class="question-cancel">\n                    <button ng-disabled="!questionForm.$valid" ng-click="$ctrl.saveQuestion()"\n                            type="submit" class="btn btn-success bigbutton">{{\'sitnet_save\' | translate}}\n                    </button>\n                </div>\n                <div class="question-cancel marr20">\n                    <button ng-click="$ctrl.cancel()" type="submit" class="btn btn-cancel pull-right bigbutton">\n                        {{\'sitnet_button_cancel\' | translate}}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',bindings:{newQuestion:"<",questionId:"<",lotteryOn:"<",onSave:"&?",onCancel:"&?"},controller:["$routeParams","$scope","$location","$translate","dialogs","Question","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){s.currentOwners=[],s.newQuestion?(s.question=o.getQuestionDraft(),s.currentOwners=angular.copy(s.question.questionOwners)):o.questionsApi.get({id:s.questionId||e.id},function(e){s.question=e,s.currentOwners=angular.copy(s.question.questionOwners),window.onbeforeunload=function(){return a.instant("sitnet_unsaved_data_may_be_lost")}},function(e){r.error(e.data)})},s.saveQuestion=function(){s.question.questionOwners=s.currentOwners,s.newQuestion?o.createQuestion(s.question).then(function(e){u(),s.onSave?s.onSave({question:e}):n.path("/questions")},function(e){r.error(e.data)}):o.updateQuestion(s.question,!0).then(function(){u(),s.onSave?s.onSave({question:s.question}):n.path("/questions")},function(e){r.error(e.data)})},s.cancel=function(){r.info(a.instant("sitnet_canceled")),u(),s.onCancel?s.onCancel():n.path("/questions")};var c=t.$on("$locationChangeStart",function(e,t){if(window.onbeforeunload){e.preventDefault();i.confirm(a.instant("sitnet_confirm_exit"),a.instant("sitnet_unsaved_question_data")).result.then(function(e){"yes"===e.toString()&&(u(),n.path(t.substring(n.absUrl().length-n.url().length)))})}else u()}),u=function(){window.onbeforeunload=null,c()}}]}),angular.module("app.question").component("questionBody",{templateUrl:"/assets/app/question/basequestion/questionBody.template.html",bindings:{question:"<",currentOwners:"<",lotteryOn:"<"},controller:["$scope","$translate","Session","Attachment","UserRes","limitToFilter","Question","EXAM_CONF","toast",function(e,t,n,a,i,o,r,s,c){var u=s.TEMPLATES_PATH+"question/basequestion/templates/essay_question.html",l=s.TEMPLATES_PATH+"question/basequestion/templates/multiple_choice_question.html",m=this,d=function(){"WeightedMultipleChoiceQuestion"!==m.question.type&&"Selection"!==m.question.defaultEvaluationType||delete m.question.defaultMaxScore;var e=m.question.examSectionQuestions.map(function(e){return e.examSection}),t=e.map(function(e){return"PUBLISHED"===e.exam.state&&(m.isInPublishedExam=!0),e.exam.name}),n=e.map(function(e){return e.name});m.examNames=t.filter(function(e,n){return t.indexOf(e)===n}),m.sectionNames=n.filter(function(e,t){return n.indexOf(e)===t}),m.newOwner={id:null,name:null},m.newType={},function(){switch(m.question.type){case"EssayQuestion":m.questionTemplate=u,m.question.defaultEvaluationType=m.question.defaultEvaluationType||"Points";break;case"ClozeTestQuestion":break;case"MultipleChoiceQuestion":m.questionTemplate=l,m.newOptionTemplate=s.TEMPLATES_PATH+"question/basequestion/templates/option.html";break;case"WeightedMultipleChoiceQuestion":m.questionTemplate=l,m.newOptionTemplate=s.TEMPLATES_PATH+"question/basequestion/templates/weighted_option.html"}}()};m.$onInit=function(){m.questionTypes=[{type:"essay",name:"sitnet_toolbar_essay_question"},{type:"cloze",name:"sitnet_toolbar_cloze_test_question"},{type:"multichoice",name:"sitnet_toolbar_multiplechoice_question"},{type:"weighted",name:"sitnet_toolbar_weighted_multiplechoice_question"}],d()};m.setQuestionType=function(){m.question.type=r.getQuestionType(m.newType.type),d()},m.showWarning=function(){return m.examNames.length>1},m.questionOwners=function(e,t){var n={role:"TEACHER",q:t};return i.filterOwnersByQuestion.query(n).$promise.then(function(e){return o(e.filter(function(e){return-1===m.currentOwners.map(function(e){return e.id}).indexOf(e.id)}),15)},function(e){c.error(e.data)})},m.setQuestionOwner=function(e,t,n){m.newOwnerTemplate=e},m.addQuestionOwner=function(){m.newOwnerTemplate&&m.newOwnerTemplate.id&&(m.currentOwners.push(m.newOwnerTemplate),m.newOwner.name=null,m.newOwnerTemplate=null)},m.removeOwnerDisabled=function(e){return 1===m.currentOwners.length||"NEW"===m.question.state&&n.getUser().id===e.id},m.removeOwner=function(e){if(!m.removeOwnerDisabled(e)){var t=m.currentOwners.indexOf(e);t>=0&&m.currentOwners.splice(t,1)}},m.selectFile=function(){a.selectFile(!0).then(function(e){e.attachmentFile.modified=!0,m.question.attachment=e.attachmentFile})},m.downloadQuestionAttachment=function(){a.downloadQuestionAttachment(m.question)},m.removeQuestionAttachment=function(){a.removeQuestionAttachment(m.question)},m.getFileSize=function(){return a.getFileSize(m.question.attachment)},m.updateEvaluationType=function(){"Selection"===m.question.defaultEvaluationType&&delete m.question.defaultMaxScore},m.removeTag=function(e){m.question.tags.splice(m.question.tags.indexOf(e),1)},m.isUserAllowedToModifyOwners=function(){var e=n.getUser();return m.question.questionOwners&&(e.isAdmin||m.question.questionOwners.map(function(e){return e.id}).indexOf(e.id)>-1)},m.estimateCharacters=function(){return 8*(m.question.defaultExpectedWordCount||0)},m.calculateDefaultMaxPoints=function(){return r.calculateDefaultMaxPoints(m.question)},m.addNewOption=function(){m.lotteryOn?c.error(t.instant("sitnet_action_disabled_lottery_on")):m.question.options.push({correctOption:!1})},m.selectIfDefault=function(e,n){e===t.instant("sitnet_default_option_description")&&n.target.select()},m.removeOption=function(e){m.lotteryOn?c.error(t.instant("sitnet_action_disabled_lottery_on")):p(e)},m.correctAnswerToggled=function(e){r.toggleCorrectOption(e,m.question.options)},m.optionDisabled=function(e){return!0===e.correctOption};var p=function(e){var n=m.question.options.filter(function(t){return t.id!==e.id&&(t.correctOption||t.defaultScore>0)}).length>0;!m.isInPublishedExam||n?m.question.options.splice(m.question.options.indexOf(e),1):c.error(t.instant("sitnet_action_disabled_minimum_options"))}}]}),angular.module("app.question").component("tagPicker",{template:'<div class="col-md-12 margin-20 padl0 padr0">\n        <div class="col-md-3 exam-basic-title padl0">\n            {{ \'sitnet_tag_question\' | translate}}\n            <sup><img popover-placement="right" popover-trigger="\'mouseenter\'"\n                      uib-popover="{{\'sitnet_question_tag_question_description\' | translate}}"\n                      src="/assets/assets/images/icon_tooltip.svg" alt="exam"\n                      onerror="this.onerror=null;this.src=\'../../../assets/assets/images/icon_tooltip.png\';"/></sup>\n        </div>\n        <div class="col-md-9 padr0">\n            <input id="newTag" name="newTag" maxlength="30" lowercase\n                   class="form-control"\n                   ng-model="$ctrl.question.newTag"\n                   uib-typeahead="t as t.name for t in $ctrl.getTags($viewValue)"\n                   typeahead-on-select="$ctrl.onTagSelect($item)"\n                   typeahead-min-length="2"/>\n            <ul class="list-inline mart10">\n                <li ng-repeat="tag in $ctrl.question.tags">{{tag.name}}\n                    <button class="reviewer-remove"\n                            popover-placement="top" popover-popup-delay="500"\n                            popover-trigger="\'mouseenter\'"\n                            uib-popover="{{ \'sitnet_remove\' | translate }}"\n                            ng-click="$ctrl.removeTag(tag)"\n                            title="{{\'sitnet_remove\' | translate}}">\n                        <img src="/assets/assets/images/icon_remove.svg" alt="exam"\n                             onerror="this.onerror=null;this.src=\'../../../assets/assets/images/icon_remove.png\';"/>\n                    </button>\n                </li>\n            </ul>\n        </div>\n    </div>',bindings:{question:"<"},controller:["$resource","limitToFilter","toast",function(e,t,n){var a=this;a.getTags=function(i){return e("/app/tags").query({filter:i}).$promise.then(function(e){i&&e.unshift({id:0,name:i});var n=e.filter(function(e){return-1===a.question.tags.map(function(e){return e.name}).indexOf(e.name)});return t(n,15)},function(e){n.error(e.data)})},a.onTagSelect=function(e){a.question.tags.push(e),delete a.question.newTag},a.removeTag=function(e){a.question.tags.splice(a.question.tags.indexOf(e),1)}}]}),angular.module("app.question").component("baseQuestionEditor",{template:'<div id="sitnet-dialog">\n    <div class="modal-body">\n        <question new-question="$ctrl.resolve.newQuestion" question-id="$ctrl.resolve.questionId" on-save="$ctrl.onSave(question)" on-cancel="$ctrl.cancel()"\n                  lottery-on="$ctrl.resolve.lotteryOn"></question>\n    </div>\n    <div class="modal-footer">\n    </div>\n</div>',bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$scope",function(e){var t=this;t.onSave=function(e){t.close({$value:{question:e}})},t.cancel=function(){t.dismiss({$value:"cancel"})},e.$on("$routeChangeStart",function(){window.onbeforeunload||t.cancel()})}]}),angular.module("app.question").component("examQuestion",{templateUrl:"/assets/app/question/examquestion/examQuestion.template.html",bindings:{examQuestion:"<",lotteryOn:"<",onSave:"&",onCancel:"&"},controller:["$scope","$translate","Attachment","Question","toast",function(e,t,n,a,i){var o=this;o.$onInit=function(){a.questionsApi.get({id:o.examQuestion.question.id},function(e){o.question=e;var t=o.question.examSectionQuestions.map(function(e){return e.examSection}),n=t.map(function(e){return"PUBLISHED"===e.exam.state&&(o.isInPublishedExam=!0),e.exam.name}),a=t.map(function(e){return e.name});o.examNames=n.filter(function(e,t){return n.indexOf(e)===t}),o.sectionNames=a.filter(function(e,t){return a.indexOf(e)===t})})},o.showWarning=function(){return o.examNames&&o.examNames.length>1},o.estimateCharacters=function(){return 8*(o.examQuestion.expectedWordCount||0)},o.selectIfDefault=function(e,n){e===t.instant("sitnet_default_option_description")&&n.target.select()},o.removeOption=function(e){if(o.lotteryOn)i.error(t.instant("sitnet_action_disabled_lottery_on"));else{var n=o.examQuestion.options.filter(function(t){return t.id!==e.id&&(t.option.correctOption||t.option.defaultScore>0)}).length>0;!o.isInPublishedExam||n?o.examQuestion.options.splice(o.examQuestion.options.indexOf(e),1):i.error(t.instant("sitnet_action_disabled_minimum_options"))}},o.addNewOption=function(){o.lotteryOn?i.error(t.instant("sitnet_action_disabled_lottery_on")):o.examQuestion.options.push({option:{correctOption:!1}})},o.correctAnswerToggled=function(e){a.toggleCorrectOption(e.option,o.examQuestion.options.map(function(e){return e.option}))},o.optionDisabled=function(e){return e.option.correctOption},o.updateEvaluationType=function(){o.examQuestion.evaluationType&&"Selection"===o.examQuestion.evaluationType&&delete o.examQuestion.maxScore},o.selectFile=function(){n.selectFile(!0).then(function(e){e.attachmentFile.modified=!0,o.question.attachment=e.attachmentFile})},o.downloadQuestionAttachment=function(){n.downloadQuestionAttachment(o.question)},o.removeQuestionAttachment=function(){n.removeQuestionAttachment(o.question)},o.getFileSize=function(){return o.question?n.getFileSize(o.question.attachment):0},o.save=function(){s(),o.onSave({question:o.question,examQuestion:o.examQuestion})},o.cancel=function(){s(),o.onCancel()},o.calculateMaxPoints=function(){return a.calculateMaxPoints(o.examQuestion)};var r=e.$on("$locationChangeStart",function(e,n){if(window.onbeforeunload){e.preventDefault();dialogs.confirm(t.instant("sitnet_confirm_exit"),t.instant("sitnet_unsaved_question_data")).result.then(function(e){"yes"===e.toString()&&(s(),$location.path(n.substring($location.absUrl().length-$location.url().length)))})}else s()}),s=function(){window.onbeforeunload=null,r()}}]}),angular.module("app.question").service("ExamQuestion",["$resource",function(e){this.undistributionApi=e("/app/examquestions/undistributed/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),this.distributionApi=e("/app/examquestions/distributed/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]),angular.module("app.question").component("examQuestionEditor",{template:'<div id="sitnet-dialog">\n    <div class="modal-body">\n        <exam-question exam-question="$ctrl.resolve.examQuestion" on-save="$ctrl.onSave(question, examQuestion)" on-cancel="$ctrl.cancel()"\n                  lottery-on="$ctrl.resolve.lotteryOn"></exam-question>\n    </div>\n    <div class="modal-footer">\n    </div>\n</div>',bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$scope",function(e){var t=this;t.onSave=function(e,n){t.close({$value:{question:e,examQuestion:n}})},t.cancel=function(){t.dismiss({$value:"cancel"})},e.$on("$routeChangeStart",function(){window.onbeforeunload||t.cancel()})}]}),angular.module("app.question").component("library",{templateUrl:"/assets/app/question/library/library.template.html",controller:["$location","$translate","toast",function(e,t,n){var a=this;a.$onInit=function(){a.questions=[]},a.resultsUpdated=function(e){a.questions=e},a.questionSelected=function(e){a.selections=e},a.questionCopied=function(a){n.info(t.instant("sitnet_question_copied")),e.path("/questions/"+a.id)}}]}),angular.module("app.question").service("Library",["$resource","$sessionStorage","$q","Question",function(e,t,n,a){var i=this;i.examApi=e("/app/examsearch"),i.courseApi=e("/app/courses/user"),i.tagApi=e("/app/tags"),i.questionApi=e("/app/questions"),i.loadFilters=function(e){return t.questionFilters&&t.questionFilters[e]?JSON.parse(t.questionFilters[e]):{}},i.storeFilters=function(e,n){var a={filters:e};t.questionFilters||(t.questionFilters={}),t.questionFilters[n]=JSON.stringify(a)},i.applyFreeSearchFilter=function(e,t){return e?t.filter(function(t){var n=new RegExp(e,"i");return!(!t.question||!o(t.question).match(n))||t.examSectionQuestions.filter(function(e){return e.examSection.exam.course&&e.examSection.exam.course.code.match(n)}).length>0}):t},i.applyOwnerSearchFilter=function(e,t){return e?t.filter(function(t){var n=new RegExp(e,"i");return(t.creator.firstName+" "+t.creator.lastName).match(n)}):t},i.search=function(e,t,o,r){var s=n.defer();return i.questionApi.query({exam:e,course:t,tag:o,section:r},function(e){e.map(function(e){switch(e.type){case"MultipleChoiceQuestion":e.icon="fa-list-ul";break;case"WeightedMultipleChoiceQuestion":e.icon="fa-balance-scale";break;case"EssayQuestion":e.icon="fa-edit";break;case"ClozeTestQuestion":e.icon="fa-commenting-o"}return e});var t=a.applyFilter(e);t.forEach(function(e){"Points"===e.defaultEvaluationType||"ClozeTestQuestion"===e.type||"MultipleChoiceQuestion"===e.type?e.displayedMaxScore=e.defaultMaxScore:"Selection"===e.defaultEvaluationType?e.displayedMaxScore="sitnet_evaluation_select":"WeightedMultipleChoiceQuestion"===e.type&&(e.displayedMaxScore=a.calculateDefaultMaxPoints(e)),e.typeOrd=["EssayQuestion","ClozeTestQuestion","MultipleChoiceQuestion","WeightedMultipleChoiceQuestion"].indexOf(e.type),e.ownerAggregate="",e.questionOwners&&(e.ownerAggregate=e.questionOwners.reduce(function(e,t){return e+t.lastName+t.firstName},"")),e.allowedToRemove=0===e.examSectionQuestions.filter(function(e){var t=e.examSection.exam;return"PUBLISHED"===t.state&&t.examActiveEndDate>(new Date).getTime()}).length}),s.resolve(t)}),s.promise};var o=function(e){return $("<div/>").html(e).text()}}]),angular.module("app.question").component("libraryOwnerSelection",{templateUrl:"/assets/app/question/library/owners/libraryOwners.template.html",bindings:{selections:"<",ownerUpdated:"&"},controller:["$translate","Question","UserRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.teachers=n.usersByRole.query({role:"TEACHER"})},i.onTeacherSelect=function(e,t,n){i.newTeacher=e},i.addOwnerForSelected=function(){if(0!==i.selections.length)if(i.newTeacher){var n={uid:i.newTeacher.id,questionIds:i.selections.join()};t.questionOwnerApi.update(n,function(){a.info(e.instant("sitnet_question_owner_added")),i.ownerUpdated()},function(){a.info(e.instant("sitnet_update_failed"))})}else a.warning(e.instant("sitnet_add_question_owner"));else a.warning(e.instant("sitnet_choose_atleast_one"))}}]}),angular.module("app.question").component("libraryResults",{templateUrl:"/assets/app/question/library/results/libraryResults.template.html",bindings:{onSelection:"&",onCopy:"&",questions:"<",disableLinks:"<",tableClass:"@?"},controller:["$translate","dialogs","Question","Library","Attachment","Session","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){s.user=o.getUser(),s.allSelected=!1,s.pageSize=25,s.currentPage=0,s.tableClass=s.tableClass||"exams-table";var e=a.loadFilters("sorting");e.filters&&(s.questionsPredicate=e.filters.predicate,s.reverse=e.filters.reverse)},s.$onChanges=function(e){e.questions&&(s.currentPage=0,u())},s.onSort=function(){c()};var c=function(){var e={predicate:s.questionsPredicate,reverse:s.reverse};a.storeFilters(e,"sorting")};s.selectAll=function(){s.questions.forEach(function(e){e.selected=s.allSelected}),s.questionSelected()};var u=function(){s.questions.forEach(function(e){e.selected=!1}),s.questionSelected()};s.questionSelected=function(){var e=s.questions.filter(function(e){return e.selected}).map(function(e){return e.id});s.onSelection({selections:e})},s.deleteQuestion=function(a){t.confirm(e.instant("sitnet_confirm"),e.instant("sitnet_remove_question_from_library_only")).result.then(function(t){n.questionsApi.delete({id:a.id},function(){s.questions.splice(s.questions.indexOf(a),1),r.info(e.instant("sitnet_question_removed"))})})},s.copyQuestion=function(a){t.confirm(e.instant("sitnet_confirm"),e.instant("sitnet_copy_question")).result.then(function(e){n.questionCopyApi.copy({id:a.id},function(e){s.questions.splice(s.questions.indexOf(a),0,e),s.onCopy({copy:e})})})},s.downloadQuestionAttachment=function(e){i.downloadQuestionAttachment(e)},s.printOwners=function(e){return e.questionOwners.map(function(e){return s.printOwner(e,!1)}).join(", ")},s.printOwner=function(e,t){var n=e.firstName+" "+e.lastName;return t&&e.userIdentifier&&(n+=" ("+e.userIdentifier+")"),n},s.printTags=function(e){return e.tags.map(function(e){return e.name.toUpperCase()}).join(", ")},s.getQuestionTypeIcon=function(e){switch(e.type){case"EssayQuestion":return"fa-edit";case"MultipleChoiceQuestion":return"fa-list-ul";case"WeightedMultipleChoiceQuestion":return"fa-balance-scale";case"ClozeTestQuestion":return"fa-terminal"}return""},s.getQuestionTypeText=function(e){switch(e.type){case"EssayQuestion":return"sitnet_essay";case"MultipleChoiceQuestion":return"sitnet_question_mc";case"WeightedMultipleChoiceQuestion":return"sitnet_question_weighted_mc";case"ClozeTestQuestion":return"sitnet_toolbar_cloze_test_question"}return""}}]}),angular.module("app.question").component("librarySearch",{templateUrl:"/assets/app/question/library/search/librarySearch.template.html",bindings:{onUpdate:"&"},controller:["$q","Library","Session",function(e,t,n){var a=this;a.$onInit=function(){a.limitations={},a.filter={},a.user=n.getUser();var e=t.loadFilters("search");e.filters?(a.exams=e.filters.exams||[],a.courses=e.filters.courses||[],a.tags=e.filters.tags||[],a.filter.text=e.filters.text,u().then(function(){a.filter.text?a.applyFreeSearchFilter():a.onUpdate({results:a.questions})})):(a.courses=[],a.exams=[],a.tags=[],u().then(function(){a.onUpdate({results:a.questions})}))},a.applyFreeSearchFilter=function(){var e=t.applyFreeSearchFilter(a.filter.text,a.questions);a.onUpdate({results:e}),i()},a.applyOwnerSearchFilter=function(){var e=t.applyOwnerSearchFilter(a.filter.owner,a.questions);a.onUpdate({results:e}),i()};var i=function(){var e={exams:a.exams,courses:a.courses,tags:a.tags,text:a.filter.text};t.storeFilters(e,"search")},o=function(){return a.courses.filter(function(e){return e&&e.filtered}).map(function(e){return e.id})},r=function(){return a.exams.filter(function(e){return e.filtered}).map(function(e){return e.id})},s=function(){return a.tags.filter(function(e){return!e.isSectionTag&&e.filtered}).map(function(e){return e.id})},c=function(){return a.tags.filter(function(e){return e.isSectionTag&&e.filtered}).map(function(e){return e.id})},u=function(){var n=e.defer();return t.search(r(),o(),s(),c()).then(function(e){a.questions=e,i(),n.resolve()}),n.promise},l=function(e,t){var n=e.map(function(e){return e.id});return e.concat(t.filter(function(e){return-1===n.indexOf(e.id)}))};a.listCourses=function(){a.courses=a.courses.filter(function(e){return e.filtered});var n=e.defer();return t.courseApi.query({examIds:r(),tagIds:s(),sectionIds:c()},function(e){a.courses=l(a.courses,e),n.resolve()}),n.promise},a.listExams=function(){a.exams=a.exams.filter(function(e){return e.filtered});var n=e.defer();return t.examApi.query({courseIds:o(),sectionIds:c(),tagIds:s()},function(e){a.exams=l(a.exams,e),n.resolve()}),n.promise};var m=function(e){var n=r(),i=o();t.tagApi.query({examIds:n,courseIds:i,sectionIds:c()},function(t){a.tags=l(a.tags,t);var o=[];a.exams.filter(function(e){var t=0===n.length||n.indexOf(e.id)>-1,a=0===i.length||i.indexOf(e.course.id)>-1;return t&&a}).forEach(function(e){o=o.concat(e.examSections.filter(function(e){return e.name}).map(function(e){return e.isSectionTag=!0,e}))}),a.tags=a.tags.concat(l(e,o))})};a.listTags=function(){a.tags=a.tags.filter(function(e){return e.filtered&&!e.isSectionTag});var e=a.tags.filter(function(e){return e.filtered&&e.isSectionTag});if(0!==r().length)return m(e);a.listExams().then(function(){return m(e)})},a.getTags=function(){var e=a.courses.filter(function(e){return e&&e.filtered}),t=a.exams.filter(function(e){return e.filtered}),n=a.tags.filter(function(e){return e.filtered});return e.concat(t).concat(n)},a.applyFilter=function(e){e.filtered=!e.filtered,u().then(function(){a.applyFreeSearchFilter()})}}]}),angular.module("app.question").service("Question",["$q","$resource","$translate","$location","$sessionStorage","ExamQuestion","Session","Files","Attachment","toast",function(e,t,n,a,i,o,r,s,c,u){var l=this;l.questionsApi=t("/app/questions/:id",{id:"@id"},{update:{method:"PUT"},delete:{method:"DELETE",params:{id:"@id"}},create:{method:"POST"}}),l.questionOwnerApi=t("/app/questions/owner/:uid",{uid:"@uid"},{update:{method:"POST"}}),l.essayScoreApi=t("/app/review/examquestion/:id/score",{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),l.questionCopyApi=t("/app/question/:id",{id:"@id"},{copy:{method:"POST"}}),l.getQuestionType=function(e){var t;switch(e){case"essay":t="EssayQuestion";break;case"multichoice":t="MultipleChoiceQuestion";break;case"weighted":t="WeightedMultipleChoiceQuestion";break;case"cloze":t="ClozeTestQuestion"}return t},l.getQuestionDraft=function(){return{examSectionQuestions:[],options:[],questionOwners:[r.getUser()],state:"NEW",tags:[]}},l.getQuestionAmounts=function(e){var t={accepted:0,rejected:0,hasEssays:!1};return angular.forEach(e.examSections,function(e){angular.forEach(e.sectionQuestions,function(e){"EssayQuestion"===e.question.type&&("Selection"===e.evaluationType&&e.essayAnswer&&(1===parseInt(e.essayAnswer.evaluatedScore)?t.accepted++:0===parseInt(e.essayAnswer.evaluatedScore)&&t.rejected++),t.hasEssays=!0)})}),t},l.calculateDefaultMaxPoints=function(e){return e.options.filter(function(e){return e.defaultScore>0}).reduce(function(e,t){return e+t.defaultScore},0)},l.calculateMaxPoints=function(e){if(!e.options)return 0;var t=e.options.filter(function(e){return e.score>0}).reduce(function(e,t){return e+parseFloat(t.score)},0);return parseFloat(t.toFixed(2))},l.scoreClozeTestAnswer=function(e){var t=e.clozeTestAnswer.score;return parseFloat(t.correctAnswers*e.maxScore/(t.correctAnswers+t.incorrectAnswers).toFixed(2))},l.scoreWeightedMultipleChoiceAnswer=function(e){var t=e.options.filter(function(e){return e.answered}).reduce(function(e,t){return e+t.score},0);return Math.max(0,t)},l.scoreMultipleChoiceAnswer=function(e){var t=e.options.filter(function(e){return e.answered});return 0===t.length?0:(1!==t.length&&console.error("multiple options selected for a MultiChoice answer!"),!0===t[0].option.correctOption?e.maxScore:0)},l.decodeHtml=function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},l.longTextIfNotMath=function(e){if(e&&e.length>0&&-1===e.indexOf("math-tex")){var t=String(e).replace(/<[^>]+>/gm,"");return l.decodeHtml(t)}return""},l.shortText=function(e,t){if(e&&e.length>0&&-1===e.indexOf("math-tex")){var n=String(e).replace(/<[^>]+>/gm,"");return(n=l.decodeHtml(n)).length+3>t?n.substr(0,t)+"...":n}return e?l.decodeHtml(e):""};var m;l.setFilter=function(e){switch(e){case"MultipleChoiceQuestion":case"WeightedMultipleChoiceQuestion":case"EssayQuestion":case"ClozeTestQuestion":m=e;break;default:m=void 0}},l.applyFilter=function(e){return m?e.filter(function(e){return e.type===m}):e},l.loadFilters=function(e){return i.questionFilters&&i.questionFilters[e]?JSON.parse(i.questionFilters[e]):{}},l.storeFilters=function(e,t){var n={filters:e};i.questionFilters||(i.questionFilters={}),i.questionFilters[t]=JSON.stringify(n)},l.range=function(e,t,n){n|=1;for(var a=[],i=e;i<=t;i+=n)a.push(i);return a};var d=function(e){var t={type:e.type,defaultMaxScore:e.defaultMaxScore,question:e.question,shared:e.shared,defaultAnswerInstructions:e.defaultAnswerInstructions,defaultEvaluationCriteria:e.defaultEvaluationCriteria,questionOwners:e.questionOwners,tags:e.tags,options:e.options};switch(e.id&&(t.id=e.id),t.type){case"EssayQuestion":t.defaultExpectedWordCount=e.defaultExpectedWordCount,t.defaultEvaluationType=e.defaultEvaluationType;break;case"MultipleChoiceQuestion":case"WeightedMultipleChoiceQuestion":t.options=e.options}return t};l.createQuestion=function(t){var a=d(t),i=e.defer();return l.questionsApi.create(a,function(e){u.info(n.instant("sitnet_question_added")),t.attachment&&t.attachment.modified?s.upload("/app/attachment/question",t.attachment,{questionId:e.id},t,null,function(){i.resolve(e)}):i.resolve(e)},function(e){i.reject(e)}),i.promise},l.updateQuestion=function(t,a){var i=d(t),o=e.defer();return l.questionsApi.update(i,function(e){u.info(n.instant("sitnet_question_saved")),t.attachment&&t.attachment.modified?s.upload("/app/attachment/question",t.attachment,{questionId:t.id},t,null,function(){o.resolve()}):t.attachment&&t.attachment.removed?c.eraseQuestionAttachment(t).then(function(){o.resolve(e)}):o.resolve(e)},function(e){a&&u.error(e.data),o.reject()}),o.promise},l.updateDistributedExamQuestion=function(t,n){var a={id:n.id,maxScore:n.maxScore,answerInstructions:n.answerInstructions,evaluationCriteria:n.evaluationCriteria,options:n.options,question:t};switch(t.type){case"EssayQuestion":a.expectedWordCount=n.expectedWordCount,a.evaluationType=n.evaluationType}var i=e.defer();return o.distributionApi.update({id:n.id},a,function(e){angular.extend(e.question,t),t.attachment&&t.attachment.modified?s.upload("/app/attachment/question",t.attachment,{questionId:t.id},t,null,function(){e.question.attachment=t.attachment,i.resolve(e)}):t.attachment&&t.attachment.removed?c.eraseQuestionAttachment(t).then(function(){e.question.attachment=null,i.resolve(e)}):i.resolve(e)},function(e){u.error(e.data),i.reject()}),i.promise},l.toggleCorrectOption=function(e,t){e.correctOption=!0,angular.forEach(t,function(t){t.correctOption=t===e})}}]),angular.module("app.question").factory("QuestionRes",["$resource",function(e){return{}}]),angular.module("app.question").component("questionSelector",{templateUrl:"/assets/app/question/selector/questionSelector.template.html",bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$translate","ExamRes","toast",function(e,t,n){var a=this;a.$onInit=function(){a.questions=[]},a.resultsUpdated=function(e){a.questions=e},a.questionSelected=function(e){a.selections=e},a.questionCopied=function(t){toastr.info(e.instant("sitnet_question_copied"))},a.addQuestions=function(){if(0!==a.selections.length){var i=parseInt(a.resolve.questionCount)+1;o=a.resolve.sectionId,r=i,s=a.resolve.examId,t.sectionquestionsmultiple.insert({eid:s,sid:o,seq:r,questions:a.selections.join()},function(t){n.info(e.instant("sitnet_question_added")),a.close()},function(e){n.error(e.data),a.close({error:e})});var o,r,s}else n.warning(e.instant("sitnet_choose_atleast_one"))},a.cancel=function(){a.dismiss({$value:"cancel"})}}]}),angular.module("app.reservation").factory("ReservationResource",["$resource",function(e){return{reservations:e("/app/reservations"),reservation:e("/app/reservations/:id",{id:"@id"},{remove:{method:"DELETE",params:{id:"id"}}}),students:e("/app/reservations/students"),teachers:e("/app/reservations/teachers"),exams:e("/app/reservations/exams"),examrooms:e("/app/reservations/examrooms"),machines:e("/app/machines"),availableMachines:e("/app/reservations/:id/machines",{id:"@id"}),machine:e("/app/reservations/:id/machine",{id:"@id"},{update:{method:"PUT"}})}}]),angular.module("app.reservation").component("reservations",{template:'<div ng-include="$ctrl.templateUrl"></div>',bindings:{userRole:"@"},controller:["ExamRes","$location","$http","EXAM_CONF","ReservationResource","Reservation","Exam","$timeout","$routeParams","$translate","$filter","toast",function(e,t,n,a,i,o,r,s,c,u,l,m){var d={placeholder:"-",data:[],allowClear:!0,dropdownAutoWidth:!0},p=this,f=c.eid?parseInt(c.eid):void 0;p.$onInit=function(){p.startDate=p.endDate=new Date,"admin"===p.userRole?p.templateUrl=a.TEMPLATES_PATH+"reservation/admin/adminReservations.template.html":"teacher"===p.userRole&&(p.templateUrl=a.TEMPLATES_PATH+"reservation/teacher/teacherReservations.template.html"),p.examStates=["REVIEW","REVIEW_STARTED","GRADED","GRADED_LOGGED","REJECTED","ARCHIVED","STUDENT_STARTED","PUBLISHED","ABORTED","NO_SHOW"],"admin"===p.userRole&&(p.examStates.push("EXTERNAL_UNFINISHED"),p.examStates.push("EXTERNAL_FINISHED")),p.selection={examId:f},p.machineOptions=angular.copy(d),p.roomOptions=angular.copy(d),p.examOptions=angular.copy(d),p.examOptions.initSelection=function(e,t){if(f){var n=p.examOptions.data.filter(function(e){return e.id===f});n.length>0&&(t(n[0]),f=null)}},p.studentOptions=angular.copy(d),p.stateOptions=angular.copy(d),p.teacherOptions=angular.copy(d),p.reservationDetails=a.TEMPLATES_PATH+"reservation/reservation_details.html",p.examStates.forEach(function(e){p.stateOptions.data.push({id:e,text:u.instant("sitnet_exam_status_"+e.toLowerCase())})})},p.isAdminView=function(){return"/"===t.path()},i.students.query(function(e){p.students=l("orderBy")(e,["lastName","firstName"]),p.students.forEach(function(e){p.studentOptions.data.push({id:e.id,text:e.name})})},function(e){m.error(e.data)}),i.exams.query(function(e){p.examnames=l("orderBy")(e,"name"),p.examnames.forEach(function(e){p.examOptions.data.push({id:e.id,text:e.name})})},function(e){m.error(e.data)}),p.isAdminView()&&(i.teachers.query(function(e){p.examOwners=l("orderBy")(e,["lastName","firstName"]),p.examOwners.forEach(function(e){p.teacherOptions.data.push({id:e.id,text:e.firstName+" "+e.lastName})})},function(e){m.error(e.data)}),i.examrooms.query(function(e){p.examrooms=e,e.forEach(function(e){p.roomOptions.data.push({id:e.id,text:e.name})}),i.machines.query(function(t){p.machines=t,h(e,t)},function(e){m.error(e.data)})},function(e){m.error(e.data)})),p.printExamState=function(e){return e.noShow?"NO_SHOW":e.enrolment.exam.state},p.getStateclass=function(e){return e.noShow?"no_show":e.enrolment.exam.state.toLowerCase()},p.roomChanged=function(){"object"==typeof p.selection.roomId&&(p.machineOptions.data.length=0,null===p.selection.roomId?h(p.examrooms,p.machines):g(function(e){var t=p.examrooms.map(function(e){return e.id}).indexOf(e);if(t>=0)return p.examrooms[t];return}(p.selection.roomId.id),p.machines),p.query())},p.startDateChanged=function(e){p.startDate=e,p.query()},p.endDateChanged=function(e){p.endDate=e,p.query()};p.query=function(){var e=angular.copy(p.selection);if(function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return p.startDate||p.endDate}(e)){for(var t in e)e.hasOwnProperty(t)&&(""!==e[t]&&null!==e[t]?"object"==typeof e[t]&&(e[t]=e[t].id):delete e[t]);p.startDate&&(e.start=p.startDate),p.endDate&&(e.end=p.endDate),i.reservations.query(e,function(e){e.forEach(function(e){if(e.userAggregate=e.user?e.user.lastName+e.user.firstName:e.externalUserRef,!e.enrolment||e.enrolment.externalExam){e.enrolment=e.enrolment||{};var t=e.enrolment.finished?"EXTERNAL_FINISHED":"EXTERNAL_UNFINISHED";e.enrolment.exam={external:!0,examOwners:[],state:t}}var n=e.enrolment.exam.parent||e.enrolment.exam;e.enrolment.teacherAggregate=n.examOwners.map(function(e){return e.lastName+e.firstName}).join();var a=p.printExamState(e);e.stateOrd=["PUBLISHED","NO_SHOW","STUDENT_STARTED","ABORTED","REVIEW","REVIEW_STARTED","GRADED","GRADED_LOGGED","REJECTED","ARCHIVED","EXTERNAL_UNFINISHED","EXTERNAL_FINISHED"].indexOf(a)}),p.reservations=e},function(e){m.error(e.data)})}},p.removeReservation=function(e){o.cancelReservation(e).then(function(){p.reservations.splice(p.reservations.indexOf(e),1),m.info(u.instant("sitnet_reservation_removed"))})},p.changeReservationMachine=function(e){o.changeMachine(e)},p.permitRetrial=function(t){e.reservation.update({id:t.id},function(){t.retrialPermitted=!0,m.info(u.instant("sitnet_retrial_permitted"))})};function g(e,t){if(!(e.examMachines.length<1)){var n={text:e.name,children:[]};t.forEach(function(t){if(i=t,(a=e)&&a.examMachines&&a.examMachines.some(function(e){return i.id===e.id})){var a,i;n.children.push({id:t.id,text:null===t.name?"":t.name})}}),p.machineOptions.data.push(n)}}function h(e,t){e&&t&&e.forEach(function(e){g(e,t)})}}]}),angular.module("app.reservation").service("Reservation",["$q","$uibModal","$http","$translate","dialogs","ReservationResource","EXAM_CONF","InteroperabilityResource","toast",function(e,t,n,a,i,o,r,s,c){this.removeReservation=function(e){var t=e.reservation.externalRef,o=function(){delete e.reservation,e.reservationCanceled=!0},r=function(e){c.error(e)};i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_are_you_sure")).result.then(function(a){t?s.reservation.remove({ref:t},o,r):n.delete("/app/calendar/reservation/"+e.reservation.id).success(o).error(r)})},this.getReservationCount=function(e){return e.examEnrolments.filter(function(e){return e.reservation&&e.reservation.endAt>(new Date).getTime()}).length},this.changeMachine=function(e){var n=["$scope","$uibModalInstance",function(t,n){t.selection={},t.availableMachines=o.availableMachines.query({id:e.id}),t.ok=function(){o.machine.update({id:e.id,machineId:t.selection.machineId},function(t){c.info(a.instant("sitnet_updated")),e.machine=t,n.close("Accepted")},function(e){c.error(e)})},t.cancel=function(){n.close("Dismissed")}}];t.open({templateUrl:r.TEMPLATES_PATH+"reservation/admin/change_machine_dialog.html",backdrop:"static",keyboard:!0,controller:n}).result.then(function(){console.log("closed")})},this.cancelReservation=function(n){var a=e.defer(),i=["$scope","$uibModalInstance",function(e,t){e.message={},e.ok=function(){o.reservation.remove({id:n.id,msg:e.message.text},function(){t.close("Accepted"),a.resolve("ok")},function(e){c.error(e.data)})},e.cancel=function(){t.close("Dismissed"),a.reject()}}];return t.open({templateUrl:r.TEMPLATES_PATH+"reservation/admin/remove_reservation_dialog.html",backdrop:"static",keyboard:!0,controller:i}).result.then(function(){console.log("closed"),a.reject()}),a.promise}}]),angular.module("app.review").component("assessment",{templateUrl:"/assets/app/review/assessment/assessment.template.html",controller:["$routeParams","Assessment","ExamRes","Question","Session","Exam","toast",function(e,t,n,a,i,o,r){var s=this;s.$onInit=function(){n.reviewerExam.get({eid:e.id},function(e){e.examSections.forEach(function(e){e.sectionQuestions.filter(function(e){return"ClozeTestQuestion"===e.question.type&&e.clozeTestAnswer.answer}).forEach(function(e){e.clozeTestAnswer.answer=JSON.parse(e.clozeTestAnswer.answer)})}),s.questionSummary=a.getQuestionAmounts(e),s.exam=e,s.user=i.getUser(),s.backUrl=s.user.isAdmin?"/":"/exams/"+s.exam.parent.id+"/4"},function(e){r.error(e.data)})},s.isUnderLanguageInspection=function(){return!!s.user&&(s.user.isLanguageInspector&&s.exam.languageInspection&&!s.exam.languageInspection.finishedAt)},s.print=function(){window.open("/print/exam/"+s.exam.id,"_blank")},s.scoreSet=function(){angular.extend(s.questionSummary,a.getQuestionAmounts(s.exam)),c()},s.gradingUpdated=function(){c()},s.isOwnerOrAdmin=function(){return o.isOwnerOrAdmin(s.exam)},s.isReadOnly=function(){return t.isReadOnly(s.exam)},s.isGraded=function(){return t.isGraded(s.exam)};var c=function(){if("REVIEW"===s.exam.state){var e=t.getPayload(s.exam,"REVIEW_STARTED");n.review.update({id:e.id},e)}}}]}),angular.module("app.review").service("Assessment",["$q","$resource","$translate","$location","$timeout","dialogs","ExamRes","Session","Question","toast",function(e,t,n,a,i,o,r,s,c,u){var l=this;l.noShowApi=t("/app/noshows/:eid/:uid",{eid:"@eid",uid:"@uid"}),l.participationsApi=t("/app/examparticipations/:eid/:uid",{eid:"@eid",uid:"@uid"}),l.examAssessmentApi=t("/app/review/:id/info",{id:"@id"},{update:{method:"PUT"}}),l.saveFeedback=function(t,a){var i=e.defer(),o={comment:t.examFeedback.comment};return t.examFeedback.id?r.comment.update({eid:t.id,cid:t.examFeedback.id},o,function(e){a||u.info(n.instant("sitnet_comment_updated")),i.resolve()},function(e){u.error(e.data),i.reject()}):r.comment.insert({eid:t.id,cid:0},o,function(e){a||u.info(n.instant("sitnet_comment_added")),t.examFeedback=e,i.resolve()},function(e){u.error(e.data),i.reject()}),i.promise},l.isReadOnly=function(e){return e&&["GRADED_LOGGED","ARCHIVED","ABORTED","REJECTED"].indexOf(e.state)>-1},l.isGraded=function(e){return e&&"GRADED"===e.state},l.pickExamLanguage=function(e){var t=e.answerLanguage;return t?{code:t}:(1===e.examLanguages.length&&(t=e.examLanguages[0]),t)},l.checkCredit=function(e,t){var a=e.customCredit,i=!isNaN(a)&&a>=0;return i||(t||u.error(n.instant("sitnet_not_a_valid_custom_credit")),e.customCredit=e.course.credits),i},l.getRecordReviewConfirmationDialogContent=function(e){return"<h4>"+n.instant("sitnet_teachers_comment")+"</h4>"+e+"<br/><strong>"+n.instant("sitnet_confirm_record_review")+"</strong>"},l.countCharacters=function(e){if(!e)return 0;var t=e.replace(/\s/g,"").replace(/&nbsp;/g,"").replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," ");return(t=m(t).replace(/^([\t\r\n]*)$/,"")).length},l.countWords=function(e){if(!e)return 0;for(var t=e.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," "),n=(t=m(t)).split(/\s+/),a=n.length-1;a>=0;a--)n[a].match(/^([\s\t\r\n]*)$/)&&n.splice(a,1);return n.length},l.getExitUrl=function(e){return(s.getUser||{isAdmin:!1}).isAdmin?"/":"/exams/"+e.parent.id+"/4"},l.createExamRecord=function(e,t,a){if(l.checkCredit(e)){var i=p(e);if(i.length>0)i.forEach(function(e){u.error(n.instant(e))});else{var s,c;e.gradeless?(s=n.instant("sitnet_confirm_archiving_without_grade"),c=r.register.add):(s=l.getRecordReviewConfirmationDialogContent(e.examFeedback.comment),c=r.saveRecord.add);var m=h(e,"GRADED");if(t){o.confirm(n.instant("sitnet_confirm"),s).result.then(function(){v(e,c,m,a)})}else g(m,c,e,a)}}},l.saveEssayScore=function(t){return!t.essayAnswer||isNaN(t.essayAnswer.evaluatedScore)?e.reject():c.essayScoreApi.update({id:t.id,evaluatedScore:t.essayAnswer.evaluatedScore}).$promise},l.saveAssessmentInfo=function(e){"GRADED_LOGGED"===e.state&&l.examAssessmentApi.update({id:e.id,assessmentInfo:e.assessmentInfo},function(){u.info(n.instant("sitnet_saved"))})},l.saveAssessment=function(e,t){if(t){if(!l.checkCredit(e))return;var i=p(e);if("MATURITY"===e.executionType.type)d(e.state,h(e),i,e);else{var r=e.state,s=i.length>0?"REVIEW_STARTED":"GRADED",c=h(e,s);if("GRADED"!==s||"GRADED"===r)d(s,c,i,e);else{o.confirm(n.instant("sitnet_confirm"),n.instant("sitnet_confirm_grade_review")).result.then(function(){d(s,c,i,e)})}}}else"GRADED"!==e.state&&f(e).then(function(){u.info(n.instant("sitnet_saved")),a.path("exams/"+e.parent.id+"/4")})},l.rejectMaturity=function(e,t,i){var s=function(){f(e).then(function(){var t=h(e,"REJECTED");r.review.update(t,function(){u.info(n.instant("sitnet_maturity_rejected")),a.path(i||l.getExitUrl(e))},function(e){u.error(e.data)})})};if(t){o.confirm(n.instant("sitnet_confirm"),n.instant("sitnet_confirm_maturity_disapproval")).result.then(function(){s()})}else s()},l.getPayload=function(e,t){return h(e,t)};var m=function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||void 0!==t.innerText?t.textContent||t.innerText:""},d=function(e,t,o,s){r.review.update(t,function(){f(s).then(function(){"REVIEW_STARTED"===e?(o.forEach(function(e){u.warning(n.instant(e))}),i(function(){u.info(n.instant("sitnet_review_saved"))},1e3)):(u.info(n.instant("sitnet_review_graded")),a.path(l.getExitUrl(s)))})},function(e){u.error(e.data)})},p=function(e){var t=[];return e.grade.id||t.push("sitnet_participation_unreviewed"),e.creditType.type||t.push("sitnet_exam_choose_credit_type"),e.answerLanguage||t.push("sitnet_exam_choose_response_language"),t},f=function(e){return l.saveFeedback(e,!0)},g=function(e,t,i,o){e.state="GRADED_LOGGED",t(e,function(){u.info(n.instant("sitnet_review_recorded")),a.path(o||l.getExitUrl(i))},function(e){u.error(e.data)})},h=function(e,t){return{id:e.id,state:t||e.state,grade:e.grade&&e.grade.id?e.grade.id:void 0,gradeless:e.gradeless,customCredit:e.customCredit,creditType:e.creditType?e.creditType.type:void 0,answerLanguage:e.answerLanguage?e.answerLanguage.code:void 0,additionalInfo:e.additionalInfo}},v=function(e,t,a,i){f(e).then(function(){r.review.update(a,function(){"GRADED"!==e.state&&u.info(n.instant("sitnet_review_graded")),g(a,t,e,i)},function(e){u.error(e.data)})})}}]),angular.module("app.review").component("rFeedback",{templateUrl:"/assets/app/review/assessment/feedback/feedback.template.html",bindings:{exam:"<"},controller:["$uibModal","Assessment","Attachment","Files",function(e,t,n,a){var i=this;i.toggleFeedbackVisibility=function(){var e=$(".body");i.hideEditor?e.show():e.hide(),i.hideEditor=!i.hideEditor},i.saveFeedback=function(){t.saveFeedback(i.exam)},i.downloadFeedbackAttachment=function(){n.downloadFeedbackAttachment(i.exam)},i.removeFeedbackAttachment=function(){n.removeFeedbackAttachment(i.exam)},i.selectFile=function(){e.open({backdrop:"static",keyboard:!0,animation:!0,component:"attachmentSelector",resolve:{isTeacherModal:function(){return!0}}}).result.then(function(e){t.saveFeedback(i.exam).then(function(){a.upload("/app/attachment/exam/"+i.exam.id+"/feedback",e.attachmentFile,{examId:i.exam.id},i.exam.examFeedback)})})}}]}),angular.module("app.review").component("rStatement",{templateUrl:"/assets/app/review/assessment/feedback/statement.template.html",bindings:{exam:"<"},controller:["$uibModal","Maturity","Attachment","Files",function(e,t,n,a){var i=this;i.hasGoneThroughLanguageInspection=function(){return i.exam.languageInspection&&i.exam.languageInspection.finishedAt},i.toggleEditorVisibility=function(){var e=$(".body");i.hideEditor?e.show():e.hide(),i.hideEditor=!i.hideEditor},i.saveInspectionStatement=function(){t.saveInspectionStatement(i.exam).then(function(e){angular.extend(i.exam.languageInspection.statement,e)})},i.downloadStatementAttachment=function(){n.downloadStatementAttachment(i.exam)},i.removeStatementAttachment=function(){n.removeStatementAttachment(i.exam)},i.selectFile=function(){e.open({backdrop:"static",keyboard:!0,animation:!0,component:"attachmentSelector",resolve:{isTeacherModal:function(){return!0}}}).result.then(function(e){t.saveInspectionStatement(i.exam).then(function(t){angular.extend(i.exam.languageInspection.statement,t),a.upload("/app/attachment/exam/"+i.exam.id+"/statement",e.attachmentFile,{examId:i.exam.id},i.exam.languageInspection.statement)})})}}]}),angular.module("app.review").component("rGeneralInfo",{templateUrl:"/assets/app/review/assessment/general/generalInfo.template.html",bindings:{exam:"<"},controller:["ExamRes","Attachment","Assessment",function(e,t,n){var a=this;a.$onInit=function(){a.participation=a.exam.examParticipations[0];var e=moment.utc(new Date(a.participation.duration));e.second()>29&&e.add(1,"minutes"),a.participation.duration=e.format("HH:mm"),a.student=a.participation.user,a.enrolment=a.exam.examEnrolments[0],a.reservation=a.enrolment.reservation,n.participationsApi.query({eid:a.exam.parent.id,uid:a.student.id},function(e){var t=e.filter(function(e){return e.id!==a.participation.id});n.noShowApi.query({eid:a.exam.parent.id,uid:a.student.id},function(e){var n=e.map(function(e){return{noShow:!0,started:e.reservation.startAt,exam:{state:"no_show"}}});a.previousParticipations=t.concat(n)})})},a.downloadExamAttachment=function(){t.downloadExamAttachment(a.exam)}}]}),angular.module("app.review").component("rParticipation",{templateUrl:"/assets/app/review/assessment/general/participation.template.html",bindings:{participation:"<"},controller:["Exam",function(e){var t=this;t.viewAnswers=function(){window.open("/assessments/"+t.participation.exam.id,"_blank")},t.translateGrade=function(){if(!t.participation.noShow&&t.participation.exam.grade)return e.getExamGradeDisplayName(t.participation.exam.grade.name)}}]}),angular.module("app.review").component("rGrading",{templateUrl:"/assets/app/review/assessment/grading/grading.template.html",bindings:{exam:"<",user:"<",questionSummary:"<",onUpdate:"&"},controller:["$translate","$scope","Assessment","Exam","ExamRes","Attachment","Language","toast",function(e,t,n,a,i,o,r,s){var c=this;c.$onInit=function(){c.message={},c.selections={},u(),l(),m()},c.getExamMaxPossibleScore=function(){return a.getMaxScore(c.exam)},c.getExamTotalScore=function(){return a.getTotalScore(c.exam)},c.inspectionDone=function(){c.onUpdate()},c.isOwnerOrAdmin=function(){return a.isOwnerOrAdmin(c.exam)},c.isReadOnly=function(){return n.isReadOnly(c.exam)},c.isGraded=function(){return n.isGraded(c.exam)},c.getTeacherCount=function(){var e=c.exam.parent.examOwners.filter(function(e){return-1===c.exam.examInspections.map(function(e){return e.user.id}).indexOf(e.id)});return c.exam.examInspections.length+e.length},c.sendEmailMessage=function(){c.message.text?i.email.inspection({eid:c.exam.id,msg:c.message.text},function(){s.info(e.instant("sitnet_email_sent")),delete c.message.text},function(e){s.error(e.data)}):s.error(e.instant("sitnet_email_empty"))},c.saveAssessmentInfo=function(){n.saveAssessmentInfo(c.exam)},c.downloadFeedbackAttachment=function(){o.downloadFeedbackAttachment(c.exam)},c.setGrade=function(){c.selections.grade&&(c.selections.grade.id||"NONE"===c.selections.grade.type)?(c.exam.grade=c.selections.grade,c.exam.gradeless="NONE"===c.selections.grade.type):(delete c.exam.grade,c.exam.gradeless=!1)},c.setCreditType=function(){c.selections.type&&c.selections.type.type?c.exam.creditType={type:c.selections.type.type}:delete c.exam.creditType},c.setLanguage=function(){c.exam.answerLanguage=c.selections.language?{code:c.selections.language.code}:void 0};var u=function(){c.exam.grade&&c.exam.grade.id||(c.exam.grade={});var e=c.exam.gradeScale||c.exam.parent.gradeScale||c.exam.course.gradeScale;e.grades=e.grades||[],c.grades=e.grades.map(function(e){return e.type=e.name,e.name=a.getExamGradeDisplayName(e.name),c.exam.grade&&c.exam.grade.id===e.id&&(c.exam.grade.type=e.type,c.selections.grade=e),e});var t={type:"NONE",name:a.getExamGradeDisplayName("NONE")};c.exam.gradeless&&!c.selections.grade&&(c.selections.grade=t),c.grades.push(t)},l=function(){a.refreshExamTypes().then(function(e){var t=c.exam.creditType||c.exam.examType;c.creditTypes=e,e.forEach(function(e){t.id===e.id&&(c.exam.creditType=c.selections.type=e)})}),c.exam.course&&!c.exam.customCredit&&(c.exam.customCredit=c.exam.course.credits)},m=function(){var e=n.pickExamLanguage(c.exam);c.exam.answerLanguage?c.exam.answerLanguage={code:c.exam.answerLanguage}:c.exam.answerLanguage=e,r.languageApi.query(function(t){c.languages=t.map(function(t){return e&&e.code===t.code&&(c.selections.language=t),t.name=r.getLanguageNativeName(t.code),t})})};t.$on("$localeChangeSuccess",function(){l(),c.grades.forEach(function(e){e.name=a.getExamGradeDisplayName(e.type)})})}]}),angular.module("app.review").component("rInspection",{templateUrl:"/assets/app/review/assessment/grading/inspection.template.html",bindings:{inspection:"<",user:"<",disabled:"<",onInspection:"&"},controller:["$translate","ExamRes","toast",function(e,t,n){var a=this;a.$onInit=function(){a.reviewStatuses=[{key:!0,value:e.instant("sitnet_ready")},{key:!1,value:e.instant("sitnet_in_progress")}]},a.setInspectionStatus=function(){a.inspection.user.id===a.user.id&&t.inspectionReady.update({id:a.inspection.id,ready:a.inspection.ready},function(t){n.info(e.instant("sitnet_exam_updated")),a.inspection.ready=t.ready,a.onInspection()},function(e){n.error(e.data)})}}]}),angular.module("app.review").component("rToolbar",{templateUrl:"/assets/app/review/assessment/grading/toolbar.template.html",bindings:{exam:"<",valid:"<"},controller:["$translate","Assessment","Exam",function(e,t,n){var a=this;a.isOwnerOrAdmin=function(){return n.isOwnerOrAdmin(a.exam)},a.isReadOnly=function(){return t.isReadOnly(a.exam)},a.isGraded=function(){return t.isGraded(a.exam)},a.isMaturityRejection=function(){return"MATURITY"===a.exam.executionType.type&&!a.exam.subjectToLanguageInspection&&a.exam.grade&&a.exam.grade.marksRejection},a.saveAssessment=function(){t.saveAssessment(a.exam,a.isOwnerOrAdmin())},a.createExamRecord=function(){t.createExamRecord(a.exam,!0)},a.rejectMaturity=function(){t.rejectMaturity(a.exam)},a.getExitUrl=function(){return t.getExitUrl(a.exam)}}]}),angular.module("app.review").component("rInspectionComment",{templateUrl:"/assets/app/review/assessment/maturity/dialogs/inspectionComment.template.html",bindings:{close:"&",dismiss:"&"},controller:["$scope","Files",function(e,t){var n=this;n.$onInit=function(){n.data={comment:null}},n.ok=function(){n.close({$value:{comment:n.data.comment}})},n.cancel=function(){n.dismiss({$value:"cancel"})},e.$on("$routeChangeStart",function(){window.onbeforeunload||n.cancel()})}]}),angular.module("app.review").component("rMaturityGrading",{templateUrl:"/assets/app/review/assessment/maturity/grading.template.html",bindings:{exam:"<",user:"<",questionSummary:"<",onUpdate:"&"},controller:["$translate","$scope","Assessment","Exam","ExamRes","Attachment","Language","toast",function(e,t,n,a,i,o,r,s){var c=this;c.$onInit=function(){c.message={},c.selections={},u(),l(),m()},c.isUnderLanguageInspection=function(){return c.user.isLanguageInspector&&c.exam.languageInspection&&!c.exam.languageInspection.finishedAt},c.hasGoneThroughLanguageInspection=function(){return c.exam.languageInspection&&c.exam.languageInspection.finishedAt},c.isAwaitingInspection=function(){return c.exam.languageInspection&&!c.exam.languageInspection.finishedAt},c.canFinalizeInspection=function(){return c.exam.languageInspection.statement&&c.exam.languageInspection.statement.comment},c.isReadOnly=function(){return n.isReadOnly(c.exam)},c.isOwnerOrAdmin=function(){return a.isOwnerOrAdmin(c.exam)},c.downloadStatementAttachment=function(){o.downloadStatementAttachment(c.exam)},c.getExamMaxPossibleScore=function(){return a.getMaxScore(c.exam)},c.getExamTotalScore=function(){return a.getTotalScore(c.exam)},c.inspectionDone=function(){c.onUpdate()},c.isOwnerOrAdmin=function(){return a.isOwnerOrAdmin(c.exam)},c.isReadOnly=function(){return n.isReadOnly(c.exam)},c.isGraded=function(){return n.isGraded(c.exam)},c.sendEmailMessage=function(){c.message.text?i.email.inspection({eid:c.exam.id,msg:c.message.text},function(){s.info(e.instant("sitnet_email_sent")),delete c.message.text},function(e){s.error(e.data)}):s.error(e.instant("sitnet_email_empty"))},c.downloadFeedbackAttachment=function(){o.downloadFeedbackAttachment(c.exam)},c.setGrade=function(){c.selections.grade&&(c.selections.grade.id||"NONE"===c.selections.grade.type)?(c.exam.grade=c.selections.grade,c.exam.gradeless="NONE"===c.selections.grade.type):(delete c.exam.grade,c.exam.gradeless=!1)},c.setCreditType=function(){c.selections.type&&c.selections.type.type?c.exam.creditType={type:c.selections.type.type}:delete c.exam.creditType},c.setLanguage=function(){c.exam.answerLanguage=c.selections.language?c.selections.language.name:void 0};var u=function(){c.exam.grade&&c.exam.grade.id||(c.exam.grade={});var e=c.exam.gradeScale||c.exam.parent.gradeScale||c.exam.course.gradeScale;e.grades=e.grades||[],c.grades=e.grades.map(function(e){return e.type=e.name,e.name=a.getExamGradeDisplayName(e.name),c.exam.grade&&c.exam.grade.id===e.id&&(c.exam.grade.type=e.type,c.selections.grade=e),e});var t={type:"NONE",name:a.getExamGradeDisplayName("NONE")};c.exam.gradeless&&!c.selections.grade&&(c.selections.grade=t),c.grades.push(t)},l=function(){a.refreshExamTypes().then(function(e){var t=c.exam.creditType||c.exam.examType;c.creditTypes=e,e.forEach(function(e){t.id===e.id&&(c.exam.creditType=c.selections.type=e)})}),c.exam.course&&!c.exam.customCredit&&(c.exam.customCredit=c.exam.course.credits)},m=function(){var e=n.pickExamLanguage(c.exam);c.exam.answerLanguage||(c.exam.answerLanguage=e),r.languageApi.query(function(t){c.languages=t.map(function(t){return e&&e.code===t.code&&(c.selections.language=t),t.name=r.getLanguageNativeName(t.code),t})})};t.$on("$localeChangeSuccess",function(){l(),c.grades.forEach(function(e){e.name=a.getExamGradeDisplayName(e.type)})})}]}),angular.module("app.review").component("rInspectionComments",{templateUrl:"/assets/app/review/assessment/maturity/inspectionComments.template.html",bindings:{exam:"<",addingDisabled:"<",addingVisible:"<"},controller:["$uibModal","ExamRes",function(e,t){var n=this;n.addInspectionComment=function(){e.open({backdrop:"static",keyboard:!0,animation:!0,component:"rInspectionComment"}).result.then(function(e){t.inspectionComment.create({id:n.exam.id,comment:e.comment},function(e){n.exam.inspectionComments.unshift(e)})})}}]}),angular.module("app.review").service("Maturity",["$q","$resource","$location","$translate","dialogs","Assessment","Session","ExamRes","toast",function(e,t,n,a,i,o,r,s,c){var u=this,l=t("/app/inspection",null,{add:{method:"POST"}}),m=t("/app/inspection/:id/approval",{id:"@id"},{update:{method:"PUT"}}),d=t("/app/inspection/:id/statement",{id:"@id"},{update:{method:"PUT"}}),p=function(e){return e.languageInspection.statement&&e.languageInspection.statement.comment},f=function(e){return r.getUser().isLanguageInspector&&e.languageInspection&&!e.languageInspection.finishedAt},g=function(e){return!!f(e)&&(!e.languageInspection.statement||!e.languageInspection.statement.comment)},h={NOT_REVIEWED:{id:1,text:"sitnet_not_reviewed"},REJECT_STRAIGHTAWAY:{id:2,text:"sitnet_reject_maturity",canProceed:!0,warn:!0},LANGUAGE_INSPECT:{id:3,text:"sitnet_send_for_language_inspection",canProceed:!0},AWAIT_INSPECTION:{id:4,text:"sitnet_await_inspection"},REJECT_LANGUAGE:{id:5,text:"sitnet_reject_maturity",canProceed:!0,warn:!0,validate:p,showHint:g,hint:"sitnet_missing_statement"},APPROVE_LANGUAGE:{id:6,text:"sitnet_approve_maturity",canProceed:!0,validate:p,showHint:g,hint:"sitnet_missing_statement"},MISSING_STATEMENT:{id:9,text:"sitnet_missing_statement"}};h.APPROVE_LANGUAGE.alternateState=h.REJECT_LANGUAGE;u.isMissingStatement=function(e){return g(e)},u.saveInspectionStatement=function(t){var n=e.defer(),i={id:t.languageInspection.id,comment:t.languageInspection.statement.comment};return d.update(i,function(e){c.info(a.instant("sitnet_statement_updated")),n.resolve(e)},function(e){c.error(e.data),n.reject(e.data)}),n.promise},u.getNextState=function(e){if(!e.grade)return h.NOT_REVIEWED;if(!(t=e).examFeedback||!t.examFeedback.comment)return h.MISSING_STATEMENT;var t;if(f(e))return h.APPROVE_LANGUAGE;if((n=e).languageInspection&&!n.languageInspection.finishedAt)return h.AWAIT_INSPECTION;var n,a=e.grade;return!a||a.marksRejection?h.REJECT_STRAIGHTAWAY:h.LANGUAGE_INSPECT},u.proceed=function(e,t){var n=u.getNextState(e);switch(n.alternateState&&t&&(n=n.alternateState),n.id){case h.REJECT_STRAIGHTAWAY.id:o.rejectMaturity(e);break;case h.LANGUAGE_INSPECT.id:v(e);break;case h.REJECT_LANGUAGE.id:x(e,!0);break;case h.APPROVE_LANGUAGE.id:x(e);break;case h.AWAIT_INSPECTION.id:}};var v=function(e){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_confirm_maturity_approval")).result.then(function(){o.saveFeedback(e).then(function(){var t=o.getPayload(e,"GRADED");s.review.update({id:e.id},t,function(){l.add({examId:e.id},function(){c.info(a.instant("sitnet_sent_for_language_inspection")),n.path(o.getExitUrl(e))})},function(e){c.error(e.data)})})})},x=function(e,t){i.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_confirm_language_inspection_approval")).result.then(function(){var n=!t;u.saveInspectionStatement(e).then(function(){m.update({id:e.languageInspection.id,approved:n},function(){c.info(a.instant("sitnet_language_inspection_finished")),n?o.createExamRecord(e,!1,"inspections"):o.rejectMaturity(e,!1,"inspections")})})})}}]),angular.module("app.review").component("rMaturityToolbar",{templateUrl:"/assets/app/review/assessment/maturity/toolbar.template.html",bindings:{exam:"<",valid:"<"},controller:["$translate","Maturity","Assessment","Session","Exam",function(e,t,n,a,i){var o=this;o.isOwnerOrAdmin=function(){return i.isOwnerOrAdmin(o.exam)},o.isReadOnly=function(){return n.isReadOnly(o.exam)},o.isUnderLanguageInspection=function(){return a.getUser().isLanguageInspector&&o.exam.languageInspection&&!o.exam.languageInspection.finishedAt},o.saveAssessment=function(){n.saveAssessment(o.exam,o.isOwnerOrAdmin())},o.getNextState=function(){return t.getNextState(o.exam)},o.proceed=function(e){t.proceed(o.exam,e)},o.isMissingStatement=function(){return t.isMissingStatement(o.exam)}}]}),angular.module("app.review").component("printedAssessment",{templateUrl:"/assets/app/review/assessment/print/printedAssessment.template.html",bindings:{exam:"<"},controller:["$routeParams","$document","$sce","ExamRes","Question","Exam","Assessment","EXAM_CONF","Session","Language",function(e,t,n,a,i,o,r,s,c,u){var l=this;l.$onInit=function(){var n=s.TEMPLATES_PATH+"review/assessment/print/templates/";l.templates={section:n+"section.html",multiChoice:n+"multiChoice.html",essay:n+"essay.html",clozeTest:n+"clozeTest.html"},a.reviewerExam.get({eid:e.id},function(e){e.examSections.forEach(function(e){e.sectionQuestions.filter(function(e){return"ClozeTestQuestion"===e.question.type&&e.clozeTestAnswer.answer}).forEach(function(e){e.clozeTestAnswer.answer=JSON.parse(e.clozeTestAnswer.answer)})}),l.questionSummary=i.getQuestionAmounts(e),l.exam=e,l.user=c.getUser(),l.participation=l.exam.examParticipations[0];var n=moment.utc(new Date(l.participation.duration));n.second()>29&&n.add(1,"minutes"),l.participation.duration=n.format("HH:mm"),l.student=l.participation.user,l.enrolment=l.exam.examEnrolments[0],l.reservation=l.enrolment.reservation,r.participationsApi.query({eid:l.exam.parent.id,uid:l.student.id},function(e){var n=e.filter(function(e){return e.id!==l.participation.id});r.noShowApi.query({eid:l.exam.parent.id,uid:l.student.id},function(e){var a=e.map(function(e){return{noShow:!0,started:e.reservation.startAt,exam:{state:"no_show"}}});l.previousParticipations=n.concat(a),t.ready(function(){$("#vmenu").hide();var e=$("#mainView");e.css("margin","0 15px"),e.css("max-width","1000px"),MathJax.Hub.Queue(["Typeset",MathJax.Hub]),setTimeout(function(){window.print()},2e3)})})})})},l.translateGrade=function(e){return e.exam.grade?o.getExamGradeDisplayName(e.exam.grade.name):"N/A"},l.getGrade=function(){return l.exam.grade?o.getExamGradeDisplayName(l.exam.grade.name):"N/A"},l.getCreditType=function(){return l.exam?o.getExamTypeDisplayName(l.exam.examType.type):"N/A"},l.getLanguage=function(){return l.exam?u.getLanguageNativeName(r.pickExamLanguage(l.exam).code):"N/A"},l.getExamMaxPossibleScore=function(){return o.getMaxScore(l.exam)},l.getExamTotalScore=function(){return o.getTotalScore(l.exam)},l.getTeacherCount=function(){var e=l.exam.parent.examOwners.filter(function(e){return-1===l.exam.examInspections.map(function(e){return e.user.id}).indexOf(e.id)});return l.exam.examInspections.length+e.length},l.displayQuestionText=function(e){return n.trustAsHtml(e.question.question)},l.getWordCount=function(e){return e.essayAnswer?r.countWords(e.essayAnswer.answer):0},l.getCharacterCount=function(e){return e.essayAnswer?r.countCharacters(e.essayAnswer.answer):0},l.scoreWeightedMultipleChoiceAnswer=function(e){return"WeightedMultipleChoiceQuestion"!==e.question.type?0:i.scoreWeightedMultipleChoiceAnswer(e)},l.scoreMultipleChoiceAnswer=function(e){return"MultipleChoiceQuestion"!==e.question.type?0:i.scoreMultipleChoiceAnswer(e)},l.calculateMaxPoints=function(e){return i.calculateMaxPoints(e)}}]}),angular.module("app.review").component("rClozeTest",{templateUrl:"/assets/app/review/assessment/questions/clozeTest.template.html",bindings:{sectionQuestion:"<"},controller:["$sce","Attachment",function(e,t){var n=this;n.displayQuestionText=function(){return e.trustAsHtml(n.sectionQuestion.question.question)},n.downloadQuestionAttachment=function(){return t.downloadQuestionAttachment(n.sectionQuestion.question)},n.displayClozeTestScore=function(){var e=n.sectionQuestion.maxScore,t=n.sectionQuestion.clozeTestAnswer.score;return t.correctAnswers*e/(t.correctAnswers+t.incorrectAnswers).toFixed(2)+" / "+e}}]}),angular.module("app.review").component("rEssayQuestion",{templateUrl:"/assets/app/review/assessment/questions/essayQuestion.template.html",bindings:{exam:"<",sectionQuestion:"<",isScorable:"<",onScore:"&"},controller:["$sce","$translate","Assessment","Attachment","toast",function(e,t,n,a,i){var o=this;o.displayQuestionText=function(){return e.trustAsHtml(o.sectionQuestion.question.question)},o.downloadQuestionAttachment=function(){return a.downloadQuestionAttachment(o.sectionQuestion.question)},o.downloadQuestionAnswerAttachment=function(){return a.downloadQuestionAnswerAttachment(o.sectionQuestion,o.exam.hash)},o.insertEssayScore=function(){n.saveEssayScore(o.sectionQuestion).then(function(){i.info(t.instant("sitnet_graded")),o.onScore()},function(e){i.error(e.data)})},o.getWordCount=function(){return o.sectionQuestion.essayAnswer?n.countWords(o.sectionQuestion.essayAnswer.answer):0},o.getCharacterCount=function(){return o.sectionQuestion.essayAnswer?n.countCharacters(o.sectionQuestion.essayAnswer.answer):0}}]}),angular.module("app.review").component("rMultiChoiceQuestion",{templateUrl:"/assets/app/review/assessment/questions/multiChoiceQuestion.template.html",bindings:{sectionQuestion:"<"},controller:["$sce","Attachment","Question","EXAM_CONF",function(e,t,n,a){var i=this;i.$onInit=function(){var e=a.TEMPLATES_PATH+"review/assessment/questions/";i.templates={multiChoiceAnswer:e+"multiChoiceAnswer.template.html",weightedMultiChoiceAnswer:e+"weightedMultiChoiceAnswer.template.html"}},i.scoreWeightedMultipleChoiceAnswer=function(){return"WeightedMultipleChoiceQuestion"!==i.sectionQuestion.question.type?0:n.scoreWeightedMultipleChoiceAnswer(i.sectionQuestion)},i.scoreMultipleChoiceAnswer=function(){return"MultipleChoiceQuestion"!==i.sectionQuestion.question.type?0:n.scoreMultipleChoiceAnswer(i.sectionQuestion)},i.calculateMaxPoints=function(){return n.calculateMaxPoints(i.sectionQuestion)},i.displayQuestionText=function(){return e.trustAsHtml(i.sectionQuestion.question.question)},i.downloadQuestionAttachment=function(){return t.downloadQuestionAttachment(i.sectionQuestion.question)}}]}),angular.module("app.review").component("rExamSection",{templateUrl:"/assets/app/review/assessment/sections/examSection.template.html",bindings:{exam:"<",section:"<",isScorable:"<",index:"<",onScore:"&"},controller:["$sce","Attachment",function(e,t){var n=this;n.scoreSet=function(){n.onScore()},n.displayQuestionText=function(){return e.trustAsHtml(n.sectionQuestion.question.question)},n.downloadQuestionAttachment=function(){return t.downloadQuestionAttachment(n.sectionQuestion.question)},n.displayClozeTestScore=function(){var e=n.sectionQuestion.maxScore,t=n.sectionQuestion.clozeTestAnswer.score;return t.correctAnswers*e/(t.correctAnswers+t.incorrectAnswers).toFixed(2)+" / "+e}}]}),angular.module("app.review").component("abortedExams",{templateUrl:"/assets/app/review/listing/dialogs/abortedExams.template.html",bindings:{dismiss:"&",resolve:"<"},controller:["$translate","$scope","ExamRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.abortedExams=i.resolve.abortedExams},i.permitRetrial=function(t){n.reservation.update({id:t.id},function(){t.retrialPermitted=!0,a.info(e.instant("sitnet_retrial_permitted"))})},i.cancel=function(){i.dismiss({$value:"cancel"})},t.$on("$routeChangeStart",function(){window.onbeforeunload||i.cancel()})}]}),angular.module("app.review").component("archiveDownload",{templateUrl:"/assets/app/review/listing/dialogs/archiveDownload.template.html",bindings:{close:"&",dismiss:"&"},controller:["$translate","toast",function(e,t){var n=this;n.$onInit=function(){n.params={startDate:new Date,endDate:new Date}},n.startDateChanged=function(e){n.params.startDate=e},n.endDateChanged=function(e){n.params.endDate=e},n.ok=function(){var a,i;n.params.startDate&&(a=moment(n.params.startDate)),n.params.endDate&&(i=moment(n.params.endDate)),a&&i&&i<a?t.error(e.instant("sitnet_endtime_before_starttime")):n.close({$value:{start:a.format("DD.MM.YYYY"),end:i.format("DD.MM.YYYY")}})},n.cancel=function(){n.dismiss({$value:"cancel"})}}]}),angular.module("app.review").component("reviewFeedback",{templateUrl:"/assets/app/review/listing/dialogs/feedback.template.html",bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$scope","Assessment",function(e,t){var n=this;n.$onInit=function(){n.exam=n.resolve.exam},n.ok=function(){n.exam.examFeedback||(n.exam.examFeedback={}),t.saveFeedback(n.exam),n.close()},n.cancel=function(){n.dismiss({$value:"cancel"})},e.$on("$routeChangeStart",function(){window.onbeforeunload||n.cancel()})}]}),angular.module("app.review").component("noShows",{templateUrl:"/assets/app/review/listing/dialogs/noShows.template.html",bindings:{dismiss:"&",resolve:"<"},controller:["$translate","$scope","ExamRes","toast",function(e,t,n,a){var i=this;i.$onInit=function(){i.noShows=i.resolve.noShows},i.permitRetrial=function(t){n.reservation.update({id:t.id},function(){t.retrialPermitted=!0,a.info(e.instant("sitnet_retrial_permitted"))})},i.cancel=function(){i.dismiss({$value:"cancel"})},t.$on("$routeChangeStart",function(){window.onbeforeunload||i.cancel()})}]}),angular.module("app.review").component("reviewList",{templateUrl:"/assets/app/review/listing/reviewList.template.html",bindings:{exam:"<"},controller:["$filter","$q","$translate","$uibModal","dialogs","ExamRes","DateTime","Exam","ReviewList","Files","EXAM_CONF","diffInMinutesToFilter","toast",function(e,t,n,a,i,o,r,s,c,u,l,m,d){var p=this;p.applyFreeSearchFilter=function(e){var t=p.data[e].filter,n=p.data[e].items;p.data[e].filtered=c.applyFilter(t,n)};var f=function(e,t,n){e.forEach(n),p.data[t].items=p.data[t].filtered=e,p.data[t].toggle=e.length>0},g=function(e,t){return e.filter(function(e){return t.indexOf(e.exam.state)>-1})};p.$onInit=function(){p.pageSize=30,p.templates={reviewStartedPath:l.TEMPLATES_PATH+"review/listing/templates/review_started.html",speedReviewPath:l.TEMPLATES_PATH+"review/listing/templates/speed_review.html",languageInspectionPath:l.TEMPLATES_PATH+"review/listing/templates/language_inspection.html",gradedPath:l.TEMPLATES_PATH+"review/listing/templates/graded.html",gradedLoggedPath:l.TEMPLATES_PATH+"review/listing/templates/graded_logged.html",rejectedPath:l.TEMPLATES_PATH+"review/listing/templates/rejected.html",archivedPath:l.TEMPLATES_PATH+"review/listing/templates/archived.html"},p.selections={graded:{all:!1,page:!1},gradedLogged:{all:!1,page:!1}},p.data={started:{predicate:"deadline"},graded:{predicate:"deadline"},finished:{predicate:"displayedGradingTime"},inspected:{predicate:"deadline"},rejected:{predicate:"displayedGradingTime"},archived:{predicate:"displayedGradingTime"}},o.examReviews.query({eid:p.exam.id},function(e){e.forEach(function(e){e.duration=m(e.started,e.ended),e.exam.languageInspection&&!e.exam.languageInspection.finishedAt&&(e.isUnderLanguageInspection=!0)}),p.abortedExams=g(e,["ABORTED"]),f(g(e,["REVIEW","REVIEW_STARTED"]),"started",w),f(g(e,["GRADED_LOGGED"]),"finished",y),f(g(e,["REJECTED"]),"rejected",y),f(g(e,["ARCHIVED"]),"archived",y);var t=e.filter(function(e){return"GRADED"===e.exam.state&&(!e.exam.languageInspection||e.exam.languageInspection.finishedAt)});f(t,"graded",y);var n=e.filter(function(e){return"GRADED"===e.exam.state&&e.exam.languageInspection&&!e.exam.languageInspection.finishedAt});f(n,"inspected",y)},function(e){d.error(e.data)}),o.noShows.query({eid:p.exam.id},function(e){p.noShows=e})},p.translateGrade=function(e){var t=e.grade?e.grade.name:"NONE";return s.getExamGradeDisplayName(t)},p.selectAll=function(e,t){var n=h(e,"all");t.forEach(function(e){e.selected=!e.selected||n})},p.selectPage=function(e,t,n){var a=h(e,"page"),i=angular.element("."+n),o=[];angular.forEach(i,function(e){o.push(parseInt(angular.element(e).val()))}),a&&t.forEach(function(e){e.selected=!1});t.filter(function(e){return o.indexOf(e.exam.id)>-1}).forEach(function(e){e.selected=!e.selected||a})},p.archiveSelected=function(){var e=v(p.data.finished.filtered);if(e){var t=e.map(function(e){return e.exam.id});o.archive.update({ids:t.join()},function(){p.data.finished.items=p.data.finished.items.filter(function(e){return!(t.indexOf(e.exam.id)>-1)||(p.data.archived.items.push(e),!1)}),p.applyFreeSearchFilter("archived"),p.applyFreeSearchFilter("finished"),d.info(n.instant("sitnet_exams_archived"))})}},p.sendSelectedToRegistry=function(){var e=v(p.data.graded.filtered);if(e){i.confirm(n.instant("sitnet_confirm"),n.instant("sitnet_confirm_record_review")).result.then(function(a){var i=[];e.forEach(function(e){i.push(x(e))}),t.all(i).then(function(){d.info(n.instant("sitnet_results_send_ok"))})})}},p.printSelected=function(t){var a=v(p.data.finished.filtered);if(a){var i="/app/exam/record/export/";t&&(i+="report/");var o=t?".xlsx":".csv",r=a.map(function(e){return e.exam.id});u.download(i+p.exam.id,n.instant("sitnet_grading_info")+"_"+e("date")(Date.now(),"dd-MM-yyyy")+o,{childIds:r},!0)}};var h=function(e,t){var n,a,i=p.selections[e];for(var o in i)i.hasOwnProperty(o)&&(o===t?(i[o]=!i[o],a=i[o]):(i[o]&&(n=!0),i[o]=!1));return n&&a},v=function(e){var t=e.filter(function(e){return e.selected});{if(0!==t.length)return t;d.warning(n.instant("sitnet_choose_atleast_one"))}},x=function(e){var a=t.defer(),i=e.exam,r=i.gradeless?o.register:o.saveRecord;if((i.grade||i.gradeless)&&i.creditType&&i.answerLanguage){var s={id:i.id,state:"GRADED_LOGGED",grade:i.grade,customCredit:i.customCredit,totalScore:i.totalScore,creditType:i.creditType,sendFeedback:!0,answerLanguage:i.answerLanguage};r.add(s,function(){e.selected=!1,e.displayedGradingTime=e.exam.languageInspection?e.exam.languageInspection.finishedAt:e.exam.gradedTime,p.data.graded.items.splice(p.data.graded.items.indexOf(e),1),p.data.finished.items.push(e),p.applyFreeSearchFilter("graded"),p.applyFreeSearchFilter("finished"),a.resolve()})}else d.error(n.instant("sitnet_failed_to_record_review")),a.reject();return a.promise},w=function(e){c.gradeExam(e.exam),o.inspections.get({id:e.exam.id},function(t){e.inspections=t})},y=function(e){e.displayedGradingTime=e.exam.languageInspection?e.exam.languageInspection.finishedAt:e.exam.gradedTime,e.displayedGrade=p.translateGrade(e.exam),e.displayedCredit=p.printExamCredit(e.exam.course.credits,e.exam.customCredit)};p.printExamCredit=function(e,t){return t||e},p.printExamDuration=function(e){return r.printExamDuration(e)},p.getAnswerAttachments=function(){a.open({backdrop:"static",keyboard:!0,animation:!0,component:"archiveDownload"}).result.then(function(e){u.download("/app/exam/"+p.exam.id+"/attachments",p.exam.id+".tar.gz",e)})},p.openAborted=function(){a.open({backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",component:"abortedExams",resolve:{abortedExams:function(){return p.abortedExams}}})},p.openNoShows=function(){a.open({backdrop:"static",keyboard:!0,windowClass:"question-editor-modal",component:"noShows",resolve:{noShows:function(){return p.noShows}}})}}]}),angular.module("app.review").service("ReviewList",["Exam","lodash",function(e,t){var n=this;n.gradeExam=function(t){t.grade&&t.grade.id||(t.grade={}),t.selectedGrade||(t.selectedGrade={});var n=t.gradeScale||t.parent.gradeScale||t.course.gradeScale;n.grades=n.grades||[],t.selectableGrades=n.grades.map(function(n){return n.type=n.name,n.name=e.getExamGradeDisplayName(n.name),t.grade&&t.grade.id===n.id&&(t.grade.type=n.type,t.selectedGrade=n),n});var a={type:"NONE",name:e.getExamGradeDisplayName("NONE")};t.gradeless&&!t.selectedGrade&&(t.selectedGrade=a),t.selectableGrades.push(a)},n.filterReview=function(e,n){if(!e)return!0;var a=e.toLowerCase();return(t.get(n,"user.firstName","")+" "+t.get(n,"user.lastName","")).toLowerCase().indexOf(a)>-1||t.get(n,"user.email","").toLowerCase().indexOf(a)>-1},n.applyFilter=function(e,t){return e?t.filter(function(t){return n.filterReview(e,t)}):t}}]),angular.module("app.review").component("speedReview",{templateUrl:"/assets/app/review/listing/speedReview.template.html",controller:["dialogs","$q","$route","$routeParams","$translate","ExamRes","Exam","ReviewList","Files","$uibModal","EXAM_CONF","toast",function(e,t,n,a,i,o,r,s,c,u,l,m){var d=this;d.$onInit=function(){d.pageSize=10,d.eid=a.id,o.exams.get({id:a.id},function(e){d.examInfo={examOwners:e.examOwners,title:e.course.code+" "+e.name},o.examReviews.query({eid:a.id},function(e){e.forEach(function(e){e.duration=moment.utc(Date.parse(e.duration)).format("HH:mm"),e.exam.languageInspection&&!e.exam.languageInspection.finishedAt&&(e.isUnderLanguageInspection=!0)}),d.examReviews=e.filter(function(e){return"REVIEW"===e.exam.state||"REVIEW_STARTED"===e.exam.state}),d.examReviews.forEach(f),d.toggleReviews=d.examReviews.length>0},function(e){m.error(e.data)})})},d.showFeedbackEditor=function(e){u.open({backdrop:"static",keyboard:!0,component:"reviewFeedback",resolve:{exam:function(){return e}}})},d.isAllowedToGrade=function(e){return r.isOwnerOrAdmin(e)};var p=function(e){var t=[];return d.isAllowedToGrade(e)||t.push("sitnet_error_unauthorized"),e.creditType||e.examType||t.push("sitnet_exam_choose_credit_type"),e.answerLanguage||1===e.examLanguages.length||t.push("sitnet_exam_choose_response_language"),t};d.isGradeable=function(e){return e&&0===p(e).length},d.hasModifications=function(){if(d.examReviews)return d.examReviews.filter(function(e){return e.exam.selectedGrade&&(e.exam.selectedGrade.id||"NONE"===e.exam.selectedGrade.type)&&d.isGradeable(e.exam)}).length>0},d.gradeExams=function(){var n=d.examReviews.filter(function(e){return e.exam.selectedGrade&&e.exam.selectedGrade.type&&d.isGradeable(e.exam)});e.confirm(i.instant("sitnet_confirm"),i.instant("sitnet_confirm_grade_review")).result.then(function(e){var a=[];n.forEach(function(e){a.push(function(e){var n=t.defer(),a=e.exam,r=p(a);if(a.selectedGrade||a.grade.id||r.push("sitnet_participation_unreviewed"),r.forEach(function(e){m.warning(i.instant(e))}),0===r.length){var s;"NONE"===a.selectedGrade.type?(s=void 0,a.gradeless=!0):(s=a.selectedGrade.id?a.selectedGrade:a.grade,a.gradeless=!1);var c={id:a.id,state:"GRADED",gradeless:a.gradeless,grade:s?s.id:void 0,customCredit:a.customCredit,creditType:a.creditType?a.creditType.type:a.examType.type,answerLanguage:a.answerLanguage?a.answerLanguage.code:a.examLanguages[0].code};o.review.update({id:a.id},c,function(){d.examReviews.splice(d.examReviews.indexOf(e),1),a.gradedTime=(new Date).getTime(),a.grade=s,n.resolve()},function(e){m.error(e.data),n.reject()})}else n.reject();return n.promise}(e))}),t.all(a).then(function(){m.info(i.instant("sitnet_saved"))})})},d.isOwner=function(e,t){var n=!1;return t&&angular.forEach(t,function(t){t.firstName+" "+t.lastName==e.firstName+" "+e.lastName&&(n=!0)}),n},d.importGrades=function(){var e=["$scope","$uibModalInstance",function(e,t){c.getMaxFilesize().then(function(t){e.maxFileSize=t.filesize}),e.title="sitnet_import_grades_from_csv",e.submit=function(){c.upload("/app/gradeimport",e.attachmentFile,{},null,t,n.reload)},e.cancel=function(){t.dismiss("Canceled")}}];u.open({templateUrl:l.TEMPLATES_PATH+"common/dialog_attachment_selection.html",backdrop:"static",keyboard:!0,controller:e}).result.then(function(){console.log("closed")})},d.createGradingTemplate=function(){var e=d.examReviews.map(function(e){return[e.exam.id,"","",e.exam.totalScore+" / "+e.exam.maxScore,e.user.firstName+" "+e.user.lastName,e.user.userIdentifier].join()+",\n"}).reduce(function(e,t){return e+t},"");e="exam id,grade,feedback,total score,student,student id\n"+e;var t=new Blob([e],{type:"text/csv;charset=utf-8"});saveAs(t,"grading.csv")};var f=function(e){s.gradeExam(e.exam),o.inspections.get({id:e.exam.id},function(t){e.inspections=t})}}]}),angular.module("app.review").component("essayAnswer",{templateUrl:"/assets/app/review/questions/assessment/essayAnswer.template.html",bindings:{answer:"<",editable:"<",action:"@",onSelection:"&"},controller:["Assessment",function(e){var t=this;t.$onInit=function(){t.answer.expanded=!0,t.answer.essayAnswer=t.answer.essayAnswer||{},t.answer.essayAnswer.score=t.answer.essayAnswer.evaluatedScore},t.getWordCount=function(){return e.countWords(t.answer.essayAnswer.answer)},t.getCharacterCount=function(){return e.countCharacters(t.answer.essayAnswer.answer)},t.saveScore=function(){t.onSelection({answer:t.answer})},t.isAssessed=function(){return t.answer.essayAnswer&&parseFloat(t.answer.essayAnswer.score)>=0},t.displayMaxScore=function(){return"Points"===t.answer.evaluationType?t.answer.maxScore:1}}]}),angular.module("app.review").component("essayAnswers",{template:'<div class="top-row">\n    <div class="col-md-12" ng-repeat="answer in $ctrl.answers">\n        <essay-answer answer="answer" editable="$ctrl.editable" action="{{$ctrl.actionText}}" on-selection="$ctrl.assessEssay(answer)"></essay-answer>\n    </div>\n    <div ng-if="$ctrl.answers.length === 0" class="col-md-12">\n        <div class="jumbotron padl20"><p class="lead">{{\'sitnet_no_answers_to_assess\' | translate }}</p></div>\n    </div>\n    <div ng-if="$ctrl.answers.length > 0" class="col-md-12 mart20 marb30">\n        <button class="btn btn-success" ng-click="$ctrl.assessSelected()">{{ $ctrl.actionText | translate }} ({{$ctrl.countSelected()}})</button>\n    </div>\n</div>',bindings:{editable:"<",answers:"<",isPremature:"<",actionText:"@",onAssessed:"&"},controller:["QuestionReview",function(e){var t=this;t.countSelected=function(){return t.answers?t.answers.filter(e.isAssessed).length:0},t.assessSelected=function(){t.onAssessed({answers:t.answers.filter(e.isAssessed)})},t.assessEssay=function(n){e.isAssessed(n)&&t.onAssessed({answers:[n]})}}]}),angular.module("app.review").component("questionAssessment",{templateUrl:"/assets/app/review/questions/assessment/questionAssessment.template.html",controller:["$routeParams","$q","$sce","$translate","QuestionReview","Assessment","Session","Attachment","toast",function(e,t,n,a,i,o,r,s,c){var u=this,l=function(e){var t=["REVIEW","REVIEW_STARTED"],n=e.examSection.exam;return n.examInspections.map(function(e){return e.user.id}).indexOf(u.user.id)>-1||t.push("GRADED"),-1===t.indexOf(n.state)},m=function(e){u.selectedReview=e,u.assessedAnswers=u.selectedReview.answers.filter(function(e){return e.essayAnswer&&parseFloat(e.essayAnswer.evaluatedScore)>=0&&!l(e)}),u.unassessedAnswers=u.selectedReview.answers.filter(function(e){return!e.essayAnswer||null===e.essayAnswer.evaluatedScore&&!l(e)}),u.lockedAnswers=u.selectedReview.answers.filter(function(e){return l(e)})};u.$onInit=function(){u.user=r.getUser(),u.examId=e.id;var t=e.q||[];i.questionsApi.query({id:u.examId,ids:t},function(e){e.forEach(function(e,t){e.selected=0===t}),u.reviews=e,u.reviews.length>0&&(m(u.reviews[0]),u.sanitizeQuestion=function(){return n.trustAsHtml(u.selectedReview.question.question)},u.getAssessedAnswerCount=function(){return u.assessedAnswers.length},u.getUnassessedAnswerCount=function(){return u.unassessedAnswers.length},u.getLockedAnswerCount=function(){return u.lockedAnswers.length})})},u.questionSelected=function(e){m(u.reviews[e])};u.saveAssessments=function(e){var n=[];e.forEach(function(e){n.push(function(e){var n=t.defer();return e.essayAnswer.evaluatedScore=e.essayAnswer.score,o.saveEssayScore(e).then(function(){c.info(a.instant("sitnet_graded")),-1===u.assessedAnswers.indexOf(e)&&(u.unassessedAnswers.splice(u.unassessedAnswers.indexOf(e),1),u.assessedAnswers.push(e)),n.resolve()},function(t){e.essayAnswer.evaluatedScore=e.essayAnswer.score,c.error(t.data),n.resolve()}),n.promise}(e))}),t.all(n).then(function(){u.reviews=angular.copy(u.reviews)})},u.isFinalized=function(e){return i.isFinalized(e)},u.downloadQuestionAttachment=function(){s.downloadQuestionAttachment(u.selectedReview.question)}}]}),angular.module("app.review").component("questionFlow",{templateUrl:"/assets/app/review/questions/flow/questionFlow.template.html",bindings:{reviews:"<",onSelection:"&"},controller:["QuestionReview",function(e){var t=this,n=function(){t.unfinished=t.reviews.filter(function(t){return!e.isFinalized(t)}),t.finished=t.reviews.filter(e.isFinalized)};t.$onInit=function(){n()},t.$onChanges=function(e){e.reviews&&n()},t.questionSelected=function(e){t.unfinished.concat(t.finished).forEach(function(t){t.selected=t.question.id===e.question.id}),t.onSelection({index:t.reviews.indexOf(e)})}}]}),angular.module("app.review").component("questionFlowCategory",{templateUrl:"/assets/app/review/questions/flow/questionFlowCategory.template.html",bindings:{categoryTitle:"@",reviews:"<",allDone:"<",onSelection:"&"},controller:["$sce","$filter","QuestionReview",function(e,t,n){var a=this;a.displayQuestionText=function(n){var a,i,o=(a=n.question.question,i=50,t("truncate")(a,i));return e.trustAsHtml(o)},a.isFinalized=function(e){return n.isFinalized(e)},a.getAssessedAnswerCount=function(e){return a.allDone?0:n.getAssessedAnswerCount(e)},a.selectQuestion=function(e){a.onSelection({review:e})}}]}),angular.module("app.review").component("questionReview",{templateUrl:"/assets/app/review/questions/listing/questionReview.template.html",bindings:{review:"<",onSelection:"&"},controller:["$sce","QuestionReview",function(e,t){var n=this;n.getAssessedAnswerCount=function(){return t.getAssessedAnswerCount(n.review)},n.sanitizeQuestion=function(){return e.trustAsHtml(n.review.question.question)},n.reviewSelected=function(){n.onSelection({id:n.review.question.id,selected:n.review.selected})}}]}),angular.module("app.review").component("questionReviews",{templateUrl:"/assets/app/review/questions/listing/questionReviews.template.html",bindings:{examId:"<"},controller:["$location","QuestionReview",function(e,t){var n=this;n.$onInit=function(){n.reviews=t.questionsApi.query({id:n.examId}),n.selectedReviews=[],n.selectionToggle=!1},n.onReviewSelection=function(e,t){var a=n.selectedReviews.indexOf(e);t&&-1===a?n.selectedReviews.push(e):a>-1&&n.selectedReviews.splice(a,1)};n.selectAll=function(){n.selectionToggle?(n.reviews.forEach(function(e){e.selected=!0}),n.selectedReviews=n.reviews.map(function(e){return e.question.id})):(n.reviews.forEach(function(e){e.selected=!1}),n.selectedReviews=[])},n.startReview=function(){e.path("/assessments/"+n.examId+"/questions").search("q",n.selectedReviews)}}]}),angular.module("app.exam.editor").service("QuestionReview",["$resource",function(e){var t=this;t.questionsApi=e("/app/exam/:id/questions",{id:"@id"}),t.isFinalized=function(e){return!!e&&e.answers.length===t.getAssessedAnswerCount(e)},t.isAssessed=function(e){return e.selected&&e.essayAnswer&&parseFloat(e.essayAnswer.score)>=0},t.isEvaluated=function(e){return e.selected&&e.essayAnswer&&parseFloat(e.essayAnswer.evaluatedScore)>=0},t.getAssessedAnswerCount=function(e){return e?e.answers.filter(function(e){return e.essayAnswer&&parseFloat(e.essayAnswer.evaluatedScore)>=0}).length:0}}]),angular.module("app.session").component("eula",{template:'<div id="sitnet-dialog">\n\n    <div class="student-message-dialog-wrapper-padding">\n        <div class="student-enroll-dialog-wrap">\n            <div class="student-enroll-title">{{\'sitnet_accept_useragreement\' | translate}}</div>\n        </div>\n        <div class="modal-body">\n            <div ng-bind-html="$ctrl.settings.eula.value">\n            </div>\n        </div>\n        <div class="student-message-dialog-footer">\n            <div class="student-message-dialog-button-save">\n                <button class="btn btn-sm btn-primary" ng-click="$ctrl.ok()">\n                    {{\'sitnet_button_accept\' | translate}}\n                </button>\n            </div>\n            <div class="student-message-dialog-button-cancel">\n                <button class="btn btn-sm btn-danger pull-left" ng-click="$ctrl.cancel()">{{\'sitnet_button_decline\' | translate}}\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n',bindings:{close:"&",dismiss:"&"},controller:["Settings",function(e){var t=this;t.$onInit=function(){t.settings={eula:e.agreement.get()}},t.cancel=function(){t.dismiss({$value:"cancel"})},t.ok=function(){t.close()}}]}),angular.module("app.session").component("logout",{controller:["Session",function(e){e.logout()}]}),angular.module("app.session").component("session",{templateUrl:"/assets/app/session/session.template.html",controller:["$location","Session","$rootScope",function(e,t,n){var a=this;a.$onInit=function(){a.user=t.getUser(),a.credentials={},t.setLoginEnv(a)},n.$on("devLogout",function(){e.url(e.path()),a.user=t.getUser(),a.credentials={},t.setLoginEnv(a)}),n.$on("examStarted",function(){a.hideNavBar=!0}),n.$on("examEnded",function(){a.hideNavBar=!1}),a.login=function(){t.login(a.credentials.username,a.credentials.password).then(function(e){a.user=e})}}]}),angular.module("app.session").service("Session",["$q","$interval","$sessionStorage","$translate","$injector","$location","$rootScope","$timeout","tmhDynamicLocale","EXAM_CONF","toast",function(e,t,n,a,i,o,r,s,c,u,l){var m,d,p,f,g,h,v,x=this,w=function(){return f=f||i.get("$http")},y=function(){return g=g||i.get("$uibModal")},E=function(){return h=h||i.get("$route")},_=function(){return v=v||i.get("UserRes")};x.getUser=function(){return m},x.getUserName=function(){if(m)return m.firstName+" "+m.lastName},x.setUser=function(e){m=e};var b=function(e,t){return!(!e||!e.loginRole)&&e.loginRole.name===t};x.setLoginEnv=function(t){(function(){var t=e.defer();return d?t.resolve():w().get("/app/settings/environment").success(function(e){d=e,t.resolve()}),t.promise})().then(function(){d.isProd||(t.loginTemplatePath=u.TEMPLATES_PATH+"session/templates/dev_login.html")})};var T=function(e,t){return!!e&&e.permissions.some(function(e){return e.type===t})};x.logout=function(){m&&w().post("/app/logout").success(function(e){delete n[u.AUTH_STORAGE_KEY],delete w().defaults.headers.common,m=void 0,function(e){r.$broadcast("userUpdated"),l.success(a.instant("sitnet_logout_success")),window.onbeforeunload=null;var t=window.location.protocol+"//"+window.location.host+"/Shibboleth.sso/Logout";e&&e.logoutUrl?window.location.href=e.logoutUrl+"?return="+t:!d||d.isProd?window.location.href=t:(o.path("/"),r.$broadcast("devLogout")),s(l.clear,300)}(e)}).error(function(e){l.error(e.data)})},x.translate=function(e){a.use(e),c.set(e)},x.openEulaModal=function(e){y().open({backdrop:"static",keyboard:!0,component:"eula"}).result.then(function(){_().updateAgreementAccepted.update(function(){e.userAgreementAccepted=!0,x.setUser(e),"/login"===o.url()||"/logout"===o.url()?o.path("/"):E().reload()},function(e){l.error(e.data)})},function(){o.path("/logout")})},x.openRoleSelectModal=function(e){var t=["$scope","$uibModalInstance",function(t,n){t.user=e,t.ok=function(t){_().userRoles.update({id:e.id,role:t.name},function(){e.loginRole=t,e.isAdmin=b(e,"ADMIN"),e.isTeacher=b(e,"TEACHER"),e.isStudent=b(e,"STUDENT"),e.isLanguageInspector=e.isTeacher&&T(e,"CAN_INSPECT_LANGUAGE"),x.setUser(e),n.dismiss(),r.$broadcast("userUpdated"),e.isStudent&&!e.userAgreementAccepted?x.openEulaModal(e):"/login"===o.url()||"/logout"===o.url()?o.path("/"):E().reload()},function(e){l.error(e.data),o.path("/logout")})},t.cancel=function(){n.dismiss("cancel"),o.path("/logout")}}];y().open({templateUrl:u.TEMPLATES_PATH+"session/templates/select_role.html",backdrop:"static",keyboard:!1,controller:t,resolve:{user:function(){return e}}}).result.then(function(){console.log("closed")})};var A=function(){x.restartSessionCheck(),r.$broadcast("userUpdated");s(function(){l.options.positionClass="toast-top-center",l.success(a.instant("sitnet_welcome")+" "+m.firstName+" "+m.lastName),s(function(){l.options.positionClass="toast-top-right"},2500)},2e3),m.loginRole?m.isStudent&&!m.userAgreementAccepted?x.openEulaModal(m):("/"===o.path()&&m.isLanguageInspector?o.path("/inspections"):d&&!d.isProd&&o.path(m.isLanguageInspector?"/inspections":"/"),E().reload()):x.openRoleSelectModal(m)};x.login=function(t,a){var i={username:t,password:a},r=e.defer();return w().post("/app/login",i,{ignoreAuthModule:!0}).then(function(e){!function(e){var t={};t[u.AUTH_HEADER]=e.token,w().defaults.headers.common=t,e.roles.forEach(function(e){switch(e.name){case"ADMIN":e.displayName="sitnet_admin",e.icon="fa-cog";break;case"TEACHER":e.displayName="sitnet_teacher",e.icon="fa-university";break;case"STUDENT":e.displayName="sitnet_student",e.icon="fa-graduation-cap"}}),(m={id:e.id,firstName:e.firstName,lastName:e.lastName,lang:e.lang,loginRole:1===e.roles.length?e.roles[0]:void 0,roles:e.roles,isLoggedOut:!1,token:e.token,userAgreementAccepted:e.userAgreementAccepted,userIdentifier:e.userIdentifier,permissions:e.permissions}).isAdmin=b(m,"ADMIN"),m.isStudent=b(m,"STUDENT"),m.isTeacher=b(m,"TEACHER"),m.isLanguageInspector=m.isTeacher&&T(e,"CAN_INSPECT_LANGUAGE"),n[u.AUTH_STORAGE_KEY]=m,x.translate(m.lang)}(e.data),A(),r.resolve(m)},function(e){t=e.data,o.path("/"),l.error(t);var t;r.reject()}),r.promise},x.switchLanguage=function(e){m?w().put("/app/user/lang",{lang:e}).success(function(){m.lang=e,x.translate(e)}).error(function(){l.error("failed to switch language")}):x.translate(e)};var S=function(){w().get("/app/checkSession").success(function(e){"alarm"===e?(l.options={timeOut:0,preventDuplicates:!0,onclick:function(){w().put("/app/extendSession",{}).success(function(){l.info(a.instant("sitnet_session_extended")),l.options.timeout=1e3})}},l.warning(a.instant("sitnet_continue_session"),a.instant("sitnet_session_will_expire_soon"))):"no_session"===e&&(p&&t.cancel(p),x.logout())})};x.restartSessionCheck=function(){p&&t.cancel(p),p=t(S,6e4)},r.$on("$destroy",function(){p&&t.cancel(p)})}]),angular.module("app.software").component("software",{templateUrl:"/assets/app/software/software.template.html",controller:["SoftwareRes","$translate","toast",function(e,t,n){var a=this;a.$onInit=function(){a.softwares=e.softwares.query()},a.updateSoftware=function(a){e.update.update({id:a.id},a,function(e){a=e,n.info(t.instant("sitnet_software_updated"))},function(e){n.error(e.data)})},a.addSoftware=function(i){e.add.insert({name:i},function(e){n.info(t.instant("sitnet_software_added")),a.softwares.push(e)},function(e){n.error(e.data)})},a.removeSoftware=function(i){e.software.remove({id:i.id},function(){n.info(t.instant("sitnet_software_removed")),a.softwares.indexOf(i)>-1&&a.softwares.splice(a.softwares.indexOf(i),1)},function(e){n.error(e.data)})}}]}),angular.module("app.software").factory("SoftwareRes",["$resource",function(e){return{machines:e("/app/software_machine/:mid",{mid:"@mid"},{reset:{method:"PUT"}}),machine:e("/app/machine/:mid/software/:sid",{mid:"@mid",sid:"@sid"},{add:{method:"PUT"},toggle:{method:"POST"}}),softwares:e("/app/softwares",{},{query:{method:"GET",isArray:!0}}),software:e("/app/softwares/:id",{id:"@id"},{query:{method:"GET"},remove:{method:"DELETE"}}),add:e("/app/softwares/add/:name",{name:"@name"},{insert:{method:"POST"}}),update:e("/app/softwares/update/:id/:name",{id:"@id",name:"@name"},{update:{method:"PUT"}})}}]),angular.module("app.utility").service("Attachment",["$resource","$uibModal","dialogs","$translate","Files","toast",function(e,t,n,a,i,o){var r=e("/app/attachment/question/:id",{id:"@id"},{remove:{method:"DELETE",params:{id:"@id"}}}),s=e("/app/attachment/question/:qid/answer/:hash",{qid:"@qid",hash:"@hash"},{remove:{method:"DELETE",params:{qid:"@qid",hash:"@hash"}}}),c=e("/app/attachment/exam/:id",{id:"@id"},{remove:{method:"DELETE",params:{id:"@id"}}}),u=e("/app/attachment/exam/:id/feedback",{id:"@id"},{remove:{method:"DELETE",params:{eid:"@id"}}}),l=e("/app/attachment/exam/:id/statement",{id:"@id"},{remove:{method:"DELETE",params:{eid:"@id"}}});this.removeQuestionAttachment=function(e){e.attachment.removed=!0},this.eraseQuestionAttachment=function(e){return r.remove({id:e.id}).$promise},this.removeQuestionAnswerAttachment=function(e,t){n.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_are_you_sure")).result.then(function(n){s.remove({qid:e.id,hash:t},function(t){o.info(a.instant("sitnet_attachment_removed")),e.essayAnswer.objectVersion=t.objectVersion,delete e.essayAnswer.attachment},function(e){o.error(e.data)})})},this.removeExamAttachment=function(e){n.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_are_you_sure")).result.then(function(t){c.remove({id:e.id},function(){o.info(a.instant("sitnet_attachment_removed")),e.attachment=null},function(e){o.error(e.data)})})},this.removeFeedbackAttachment=function(e){n.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_are_you_sure")).result.then(function(t){u.remove({id:e.id},function(){o.info(a.instant("sitnet_attachment_removed")),e.examFeedback.attachment=null},function(e){o.error(e.data)})})},this.removeStatementAttachment=function(e){n.confirm(a.instant("sitnet_confirm"),a.instant("sitnet_are_you_sure")).result.then(function(t){l.remove({id:e.id},function(){o.info(a.instant("sitnet_attachment_removed")),delete e.languageInspection.statement.attachment},function(e){o.error(e.data)})})},this.downloadQuestionAttachment=function(e){e.attachment.id&&i.download("/app/attachment/question/"+e.id,e.attachment.fileName)},this.downloadQuestionAnswerAttachment=function(e,t){i.download("/app/attachment/question/"+e.id+"/answer/"+t,e.essayAnswer.attachment.fileName)},this.downloadExamAttachment=function(e){i.download("/app/attachment/exam/"+e.id,e.attachment.fileName)},this.downloadFeedbackAttachment=function(e){i.download("/app/attachment/exam/"+e.id+"/feedback",e.examFeedback.attachment.fileName)},this.downloadStatementAttachment=function(e){i.download("/app/attachment/exam/"+e.id+"/statement",e.languageInspection.statement.attachment.fileName)},this.getFileSize=function(e){return e?Math.round(e.size/1e3)+" kB":null},this.selectFile=function(e,n){var a=angular.extend({},n);return a.isTeacherModal=e,t.open({backdrop:"static",keyboard:!0,animation:!0,component:"attachmentSelector",resolve:a}).result}}]),angular.module("app.utility").component("attachmentSelector",{templateUrl:"/assets/app/utility/attachment/dialogs/attachmentSelector.template.html",bindings:{close:"&",dismiss:"&",resolve:"<"},controller:["$scope","Files",function(e,t){var n=this;n.$onInit=function(){n.title=n.resolve.title,n.isTeacherModal=n.resolve.isTeacherModal,t.getMaxFilesize().then(function(e){n.maxFileSize=e.filesize})},n.ok=function(){n.close({$value:{attachmentFile:n.attachmentFile}})},n.cancel=function(){n.dismiss({$value:"cancel"})},e.$on("$routeChangeStart",function(){window.onbeforeunload||n.cancel()})}]}),angular.module("app.utility").factory("DateTime",["$translate",function(e){var t=function(e){var t=new Date,n=e-t.getDay();return new Date(t.setDate(t.getDate()+n))};return{printExamDuration:function(e){if(e&&e.duration){var t=Math.floor(e.duration/60),n=e.duration%60;return 0===t?n+" min":0===n?t+" h":t+" h "+n+" min"}return""},getDateForWeekday:t,getWeekdayNames:function(){var n=e.use(),a=n.toLowerCase()+"-"+n.toUpperCase(),i={weekday:"short"};return[t(1).toLocaleDateString(a,i),t(2).toLocaleDateString(a,i),t(3).toLocaleDateString(a,i),t(4).toLocaleDateString(a,i),t(5).toLocaleDateString(a,i),t(6).toLocaleDateString(a,i),t(0).toLocaleDateString(a,i)]}}}]),angular.module("app.utility").component("datePicker",{templateUrl:"/assets/app/utility/date/datePicker.template.html",bindings:{onUpdate:"&",initialDate:"<?",extra:"<?",onExtraAction:"&?",extraText:"@?",modelOptions:"<?",optional:"<?"},controller:[function(){var e=this;e.$onInit=function(){angular.isUndefined(e.modelOptions)&&(e.modelOptions={}),e.date=angular.isUndefined(e.initialDate)?new Date:e.initialDate,e.showWeeks=!0,e.dateOptions={startingDay:1},e.format="dd.MM.yyyy"},e.openPicker=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateChanged=function(){e.onUpdate({date:e.date})},e.extraClicked=function(){e.onExtraAction({date:e.date})}}]}),angular.module("app.utility").directive("sortable",[function(){return{restrict:"A",scope:{onMove:"&",objects:"=",selection:"@selection"},link:function(e,t,n){var a=-1;t.sortable({items:e.selection,accept:"section-handle",start:function(e,t){a=$(t.item).index()},stop:function(t,n){var i=$(n.item).index(),o=e.objects[a];e.objects.splice(a,1),e.objects.splice(i,0,o),e.onMove({object:o,from:a,to:i})},axis:"y"})}}}]).directive("droppable",["$translate","$parse","toast",function(e,t,n){return{scope:{objects:"=",identifier:"=",onMove:"&",onCreate:"&"},link:function(a,i,o){var r=-1;o.$observe("dropDisabled",function(){var s=t(o.dropDisabled)(a);c=a,l=s,(u=i).droppable({drop:function(t,a){a.draggable.hasClass("section-handle")?t.revert=!0:(l&&(n.error(e.instant("sitnet_error_drop_disabled_lottery_on")),t.revert=!0),a.draggable.hasClass("draggable")||a.draggable.hasClass("sortable-"+c.identifier)||(n.warning(e.instant("sitnet_move_between_sections_disabled")),t.revert=!0))}}),u.sortable({disabled:l,items:".sortable-"+c.identifier,start:function(e,t){r=$(t.item).index()},stop:function(e,t){var n=$(t.item).index(),a=c.objects[r];a?(c.objects.splice(r,1),c.objects.splice(n,0,a),c.onMove({from:r,to:n})):e.revert=!0},axis:"y"}),u.disableSelection();var c,u,l})}}}]),angular.module("app.utility").factory("Files",["$q","$http","$translate","$timeout","SettingsResource","toast",function(e,t,n,a,i,o){var r,s,c=new Blob(["<svg xmlns='http://www.w3.org/2000/svg'></svg>"],{type:"image/svg+xml;charset=utf-8"}),u=new Image;u.onload=function(){r=!0},u.onerror=function(){r=!1},u.src=URL.createObjectURL(c);var l=function(e){return e.size>s&&(o.error(n.instant("sitnet_file_too_large")),!0)},m=function(e,n,a,i,r,s){if(!l(n)){var c=new FormData;c.append("file",n);for(var u in a)a.hasOwnProperty(u)&&c.append(u,a[u]);t.post(e,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(s).error(function(e){r&&r.dismiss(),o.error(e)})}};return{download:function(e,n,a,i){(i?t.post:t.get)(e,{params:a}).success(function(e,t,a){var i=a()["content-type"].split(";")[0];!function(e,t,n){if(r){for(var a=atob(e),i=new ArrayBuffer(a.length),o=new Uint8Array(i),s=0;s<a.length;s++)o[s]=a.charCodeAt(s);var c=new Blob([o],{type:n});saveAs(c,t)}else window.open("data:"+n+";base64,"+e)}(e,n,i)}).error(function(e){o.error(e.data||e)})},downloadUrl:function(n,a,i){var r=e.defer();return t.get(n,{params:i}).success(function(e,t,n){var a=n()["content-type"].split(";")[0];return r.resolve({url:"data:"+a+";base64, "+e})}).error(function(e){return o.error(e.data||e),r.reject()}),r.promise},upload:function(e,t,n,a,i,o){m(e,t,n,0,i,function(e){i&&i.dismiss(),a&&(a.attachment=e),o&&o()})},uploadAnswerAttachment:function(e,t,n,a,i){m(e,t,n,0,i,function(e){i&&i.dismiss(),a.objectVersion=e.objectVersion,a.attachment=e.attachment})},getMaxFilesize:function(){var t=e.defer();return s&&a(function(){return t.resolve({filesize:s})},10),i.maxFilesize.get(function(e){return s=e.filesize,t.resolve(e)},function(e){return t.reject(e)}),t.promise},isFileTooBig:l,open:function(e,t){var n=new FileReader;n.onload=function(e){var t=n.result;window.open(t)},n.readAsDataURL(e)}}}]);
//# sourceMappingURL=exam.min.js.map