<div id="sitnet-header" class="header">
    <div class="col-md-12 header-wrapper">
        <span class="header-text">{{'sitnet_exams_to_be_reviewed' | translate}}</span>
    </div>
</div>

<div id="dashboard">

    <div class="main-row">
        <div class="col-md-6">
            <h4>{{ examInfo }}</h4>
        </div>
        <span class="col-md-6">
            <a target="_self" class="header-top-link pull-right" ng-click="getAnswerAttachments()"
               ng-if="examReviews.length > 0 && view.filter === 'IN_PROGRESS'">
                 <span class="fa-stack fa-lg header-top-icon">
                    <i class="fa sitnet-text-theme fa-stop fa-stack-2x"></i>
                    <i class="fa fa-file-archive-o fa-stack-1x sitnet-white"></i>
                </span>
                {{'sitnet_get_answer_attachments' | translate }}
            </a>
            <a target="_self" class="header-top-link pull-right" ng-click="view.filter = 'ABORTED'"
               ng-if="view.filter === 'IN_PROGRESS'">
                 <span class="fa-stack fa-lg header-top-icon">
                    <i class="fa sitnet-text-theme fa-stop fa-stack-2x"></i>
                    <i class="fa fa-ban fa-stack-1x sitnet-white"></i>
                </span>
                {{'sitnet_aborted_exams' | translate}} ({{abortedExams.length}})
            </a>
            <a target="_self" class="header-top-link pull-right" ng-click="view.filter = 'NO_SHOW'"
               ng-if="view.filter === 'IN_PROGRESS'">
                 <span class="fa-stack fa-lg header-top-icon">
                    <i class="fa sitnet-text-theme fa-stop fa-stack-2x"></i>
                    <i class="fa fa-undo fa-stack-1x sitnet-white"></i>
                </span>
                {{'sitnet_no_shows' | translate}} ({{noShows.length}})
            </a>
            <a class="header-top-link pull-right" ng-if="view.filter === 'ABORTED'"
               ng-click="view.filter = 'IN_PROGRESS'">
                <i class="fa fa-sign-out"><span class="italic">{{'sitnet_close' | translate}}</span></i>
            </a>
            <a class="header-top-link pull-right" ng-if="view.filter === 'ARCHIVED'"
               ng-click="view.filter = 'IN_PROGRESS'">
                <i class="fa fa-sign-out"><span class="italic">{{'sitnet_close' | translate}}</span></i>
            </a>
            <a class="header-top-link pull-right" ng-if="view.filter === 'NO_SHOW'"
               ng-click="view.filter = 'IN_PROGRESS'">
                <i class="fa fa-sign-out"><span class="italic">{{'sitnet_close' | translate}}</span></i>
            </a>
        </span>
    </div>

    <div class="detail-row" ng-if="view.filter === 'ABORTED'">
        <div class="main-row">
            <span class="col-md-12">
                <span class="exams-list-title-text pointer">
                    {{'sitnet_aborted_exams' | translate}}
                </span>
            </span>
        </div>
        <div class="indented-row" ng-show="abortedExams.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>
        <div class="col-md-12" ng-show="abortedExams.length > 0">
            <table class="table table-bordered table-striped exams-table">
                <thead>
                <tr>
                    <th colspan="2">
                        <span class="pointer" ng-click="abortedPredicate = 'user.lastName'; reverse=!reverse">
                            {{'sitnet_student' | translate }}
                        </span>
                    </th>
                    <th>
                        <span class="pointer" ng-click="abortedPredicate = 'started'; reverse=!reverse">
                            {{'sitnet_exam_duration' | translate}}
                        </span>
                    </th>
                    <th>{{'sitnet_exam_state' | translate}}</th>
                    <th>{{'sitnet_trial' | translate}}</th>
                </tr>
                </thead>

                <tbody>
                <tr ng-repeat="review in abortedExams | orderBy:abortedPredicate:reverse | offset: currentPage*pageSize | limitTo: pageSize">
                    <td class="table-column-examname">
                        <a ng-click="go(review.exam)">
                            {{review.user.firstName}}&nbsp;{{review.user.lastName}}
                            <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                        </a>
                    </td>
                    <td class="table-column-25"><a class="pointer" href="mailto:{{review.user.email}}">
                        {{review.user.email}}</a></td>
                    <td class="table-column-25">{{review.started | date: 'dd.MM.yyyy'}} {{'sitnet_clock_short' |
                        translate}} {{review.started | date: 'HH:mm'}} - {{review.ended | date: 'HH:mm'}}
                        ({{review.started | diffInMinutesTo:review.ended }}&nbsp;min)
                    </td>
                    <td class="table-column-15" class="sitnet-text-aborted">
                        {{'sitnet_exam_status_' + review.exam.state | lowercase | translate}}
                    </td>
                    <td class="table-column-10" class="sitnet-text-aborted">
                        <button ng-disabled="!review.exam.trialCount || !review.reservation || review.reservation.retrialPermitted"
                                ng-click="permitRetrial(review.reservation)"
                                class="btn btn-sm btn-primary">
                            {{'sitnet_permit_retrial' | translate}}
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="detail-row" ng-if="view.filter === 'NO_SHOW'">
        <div class="main-row">
            <span class="col-md-12">
                <span class="exams-list-title-text pointer">
                    {{'sitnet_no_shows' | translate}}
                </span>
            </span>
        </div>
        <div class="indented-row" ng-show="noShows.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>
        <div class="col-md-12" ng-show="noShows.length > 0">
            <table class="table table-bordered table-striped exams-table">
                <thead>
                <tr>
                    <th colspan="2">
                        {{'sitnet_student' | translate }}
                    </th>
                    <th>
                        {{'sitnet_reservation' | translate}}
                    </th>
                    <th>{{'sitnet_exam_state' | translate}}</th>
                    <th>{{'sitnet_trial' | translate}}</th>
                </tr>
                </thead>

                <tbody>
                <tr ng-repeat="review in noShows | offset: currentPage*pageSize | limitTo: pageSize">
                    <td class="table-column-examname">
                        {{review.user.firstName}}&nbsp;{{review.user.lastName}}
                        <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                    </td>
                    <td class="table-column-25"><a class="pointer" href="mailto:{{review.user.email}}">
                        {{review.user.email}}</a></td>
                    <td class="table-column-25">{{review.reservation.startAt | date: 'dd.MM.yyyy'}}
                        {{'sitnet_clock_short' |
                        translate}} {{review.reservation.startAt | date: 'HH:mm'}} - {{review.reservation.endAt | date:
                        'HH:mm'}}
                    </td>
                    <td class="table-column-15" class="sitnet-text-aborted">
                        {{'sitnet_exam_status_no_show' | translate}}
                    </td>
                    <td class="table-column-10" class="sitnet-text-aborted">
                        <button ng-disabled="!review.exam.trialCount || !review.reservation || review.reservation.retrialPermitted"
                                ng-click="permitRetrial(review.reservation)" class="btn btn-sm btn-primary">
                            {{'sitnet_permit_retrial' | translate}}
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>


    <div ng-if="view.filter === 'IN_PROGRESS'">
        <!-- Ready for review-->
        <div class="main-row">
            <span class="col-md-12">
                <a ng-click="toggleUnreviewed()" class="header-icon fa-stack fa-lg">
                    <i class="fa sitnet-white fa-stop fa-stack-2x"></i>
                    <i ng-show="!toggleReviews" class="fa fa-chevron-right fa-stack-1x"></i>
                    <i ng-show="toggleReviews" class="fa fa-chevron-down fa-stack-1x"></i>
                </a>
                <span class="exams-list-title-text pointer">
                    {{ 'sitnet_exam_in_review' | translate }}
                </span>
            </span>
        </div>

        <div class="indented-row" ng-show="examReviews.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>

        <div class="detail-row" ng-show="toggleReviews">
            <div class="col-md-12">
                <table class="table table-bordered table-striped exams-table">
                    <thead>
                    <tr>
                        <th colspan="2">
                            <span class="pointer" ng-click="reviewPredicate = 'user.lastName'; reverse=!reverse">
                                {{'sitnet_student' | translate }}
                            </span>
                        </th>
                        <th>
                            <span class="pointer" ng-click="reviewPredicate = 'started'; reverse=!reverse">
                                {{'sitnet_exam_duration' | translate}}
                            </span>
                        </th>
                        <th><span class="pointer" ng-click="reviewPredicate = 'deadline'; reverse=!reverse">
                            {{'sitnet_review_deadline' | translate }}</span>
                        </th>
                        <th>{{'sitnet_inspection_status' | translate}}</th>
                        <th>{{'sitnet_exam_state' | translate}}</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="review in examReviews | orderBy:reviewPredicate:reverse | offset: currentPage*pageSize | limitTo: pageSize">
                        <td class="table-column-15 table-column-bold">
                            <a class="pointer" ng-click="go(review.exam)">
                                {{review.user.firstName}} {{review.user.lastName}}
                                <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                            </a>
                        </td>
                        <td class="table-column-15"><a class="pointer" href="mailto:{{review.user.email}}">{{review.user.email}}</a>
                        </td>
                        <td class="table-column-20">{{review.started | date: 'dd.MM.yyyy'}} {{'sitnet_clock_short' |
                            translate}} {{review.started | date: 'HH:mm'}} - {{review.ended | date: 'HH:mm'}}
                            ({{review.started | diffInMinutesTo:review.ended }}&nbsp;min)
                        </td>
                        <td class="table-column-10">{{review.deadline | date:'dd.MM.yyyy'}} (<span
                                ng-bind-html="review.deadline | diffInDaysToNow"></span>)
                        </td>
                        <td class="table-column-teachers">
                            <div ng-repeat="inspection in review.inspections">
                                    <span ng-class="inspection.ready ? 'sitnet-text-ready' : 'sitnet-text-alarm'">
                                        <span ng-class="isOwner(inspection.user, review.exam.examOwners) ? 'bold' : ''">
                                            {{inspection.user.firstName}} {{inspection.user.lastName}}
                                        </span>
                                    </span>
                            </div>
                            <div ng-repeat="owner in review.exam.examOwners">
                                    <span class="bold" ng-if="isInspector(owner, review.inspections) == false">
                                        {{owner.firstName}} {{owner.lastName}}</span>
                            </div>
                        </td>
                        <td class="table-column-15"
                            ng-class="review.exam.state !== 'ABORTED' ? 'sitnet-text-ready' : 'sitnet-text-aborted'">
                            {{'sitnet_exam_status_' + review.exam.state | lowercase | translate}}
                        </td>
                    </tr>
                    <!--Fill if page not full-->
                    <tr ng-repeat="r in [] | pagefill: examReviews.length:currentPage:pageSize">
                        <td class="table-column-examname">&nbsp;</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="detail-row" ng-show="toggleReviews">
            <div col-md-12 ng-show="examReviews.length > pageSize">
                <paginator items="examReviews" page-size="pageSize" current-page="currentPage"/>
            </div>
        </div>

        <!-- Graded -->
        <div class="main-row">
            <span class="col-md-12">
                <a ng-click="toggleGraded()" class="header-icon fa-stack fa-lg">
                    <i class="fa sitnet-white fa-stop fa-stack-2x"></i>
                    <i ng-show="!toggleGradedReviews" class="fa fa-chevron-right fa-stack-1x"></i>
                    <i ng-show="toggleGradedReviews" class="fa fa-chevron-down fa-stack-1x"></i>
                </a>
                <span class="exams-list-title-text pointer">
                    {{ 'sitnet_exam_reviewed' | translate }}
                </span>
            </span>
        </div>

        <div class="indented-row" ng-show="gradedReviews.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>

        <div class="detail-row" ng-show="toggleGradedReviews">
            <div class="col-md-12">
                <table class="table table-bordered table-striped exams-table">
                    <thead>
                    <tr>
                        <th class="table-column-checkbox"><input type="checkbox" name="select_all"
                                                                 class="gradedReviewAll"
                                                                 ng-click="selectAll('gradedReviewAll', 'gradedReviewsBox')"
                                                                 popover-placement="right"
                                                                 popover-trigger="mouseenter"
                                                                 popover="{{ 'sitnet_check_uncheck_all' | translate }}"/>
                        </th>
                        <th colspan="2">{{'sitnet_student' | translate }}</th>
                        <th>{{'sitnet_exam_duration' | translate}}</th>
                        <th>{{'sitnet_review_deadline' | translate }}</th>
                        <th>{{'sitnet_grade' | translate }}</th>
                        <th>{{'sitnet_exam_credit' | translate}}</th>
                        <th>{{'sitnet_graded' | translate }}</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="review in gradedReviews | offset: currentPageGraded*pageSize | limitTo: pageSize">
                        <td class="table-column-checkbox"><input type="checkbox" class="gradedReviewsBox"
                                                                 value="{{review.exam.id}}"/></td>
                        <td class="table-column-13 table-column-bold">
                            <a class="pointer" ng-click="go(review.exam)">
                                {{review.user.firstName}} {{review.user.lastName}}
                                <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                            </a>
                        </td>
                        <td class="table-column-15"><a class="pointer" href="mailto:{{review.user.email}}">{{review.user.email}}</a>
                        </td>
                        <td class="table-column-20">{{review.started | date: 'dd.MM.yyyy'}} {{'sitnet_clock_short' |
                            translate}} {{review.started | date: 'HH:mm'}} - {{review.ended | date: 'HH:mm'}}
                            ({{review.started | diffInMinutesTo:review.ended }}&nbsp;min)
                        </td>
                        <td class="table-column-10">{{review.deadline | date:'dd.MM.yyyy'}} (<span
                                ng-bind-html="review.deadline | diffInDaysToNow"></span>)
                        </td>
                        <td class="table-column-15">{{translateGrade(review.exam)}}</td>
                        <td class="table-column-10">
                            {{ printExamCredit(review.exam.course.credits, review.exam.customCredit) }}
                        </td>
                        <td class="table-column-15">{{review.exam.gradedTime | date:'dd.MM.yyyy'}}</td>
                    </tr>
                    <!--Fill if page not full-->
                    <tr ng-repeat="r in [] | pagefill: gradedReviews.length:currentPageGraded:pageSize">
                        <td class="table-column-examname">&nbsp;</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="detail-row" ng-show="toggleGradedReviews">
            <div col-md-12 ng-show="gradedReviews.length > pageSize">
                <paginator items="gradedReviews" page-size="pageSize" current-page="currentPageGraded"/>
            </div>
        </div>

        <div class="main-row" ng-show="toggleGradedReviews">
            <div class="col-md-12">
                <button class="btn btn-primary" ng-click="sendSelectedToRegistry()">
                    {{'sitnet_send_results_to_registry' | translate}}
                </button>
            </div>
        </div>

        <!-- Graded and Logged-->
        <div class="main-row">
            <span class="col-md-12">
                <a ng-click="toggleLogged()" class="header-icon fa-stack fa-lg">
                    <i class="fa sitnet-white fa-stop fa-stack-2x"></i>
                    <i ng-show="!toggleLoggedReviews" class="fa fa-chevron-right fa-stack-1x"></i>
                    <i ng-show="toggleLoggedReviews" class="fa fa-chevron-down fa-stack-1x"></i>
                </a>
                <span class="exams-list-title-text pointer">
                    {{ 'sitnet_exam_graded_logged' | translate }}
                </span>
            </span>
        </div>

        <div class="indented-row" ng-show="gradedLoggedReviews.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>

        <div class="detail-row" ng-show="toggleLoggedReviews">
            <div class="col-md-12">
                <table class="table table-bordered table-striped exams-table">
                    <thead>
                    <tr>
                        <th class="table-column-checkbox">
                            <input type="checkbox" name="select_all" class="gradedLoggedAll"
                                   ng-click="selectAll('gradedLoggedAll', 'gradedLoggedBox')" popover-placement="right"
                                   popover-trigger="mouseenter" popover="{{ 'sitnet_check_uncheck_all' | translate }}"/>
                        </th>
                        <th colspan="2">{{'sitnet_student' | translate }}</th>
                        <th>{{'sitnet_exam_duration' | translate}}</th>
                        <th>{{'sitnet_grade' | translate }}</th>
                        <th>{{'sitnet_exam_credit' | translate}}</th>
                        <th>{{'sitnet_graded' | translate }}</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="review in gradedLoggedReviews | offset: currentPageGradedLogged*pageSize | limitTo: pageSize">
                        <td class="table-column-checkbox"><input type="checkbox" class="gradedLoggedBox"
                                                                 value="{{review.exam.id}}"/></td>
                        <td class="table-column-13 table-column-bold">
                            <a class="pointer" ng-click="go(review.exam)">
                                {{review.user.firstName}} {{review.user.lastName}}
                                <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                            </a>
                        </td>
                        <td class="table-column-15"><a class="pointer" href="mailto:{{review.user.email}}">{{review.user.email}}</a>
                        </td>
                        <td class="table-column-20">{{review.started | date: 'dd.MM.yyyy'}} {{'sitnet_clock_short' |
                            translate}} {{review.started | date: 'HH:mm'}} - {{review.ended | date: 'HH:mm'}}
                            ({{review.started | diffInMinutesTo:review.ended }}&nbsp;min)
                        </td>
                        <td class="table-column-25">{{translateGrade(review.exam)}}</td>
                        <td class="table-column-10">
                            {{ printExamCredit(review.exam.course.credits, review.exam.customCredit) }}
                        </td>
                        <td class="table-column-15">{{review.exam.gradedTime | date:'dd.MM.yyyy'}}</td>
                    </tr>
                    <!--Fill if page not full-->
                    <tr ng-repeat="r in [] | pagefill: gradedLoggedReviews.length:currentPageGradedLogged:pageSize">
                        <td class="table-column-examname">&nbsp;</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="detail-row">
            <div col-md-12 ng-show="toggleLoggedReviews && gradedLoggedReviews.length > pageSize">
                <paginator items="gradedLoggedReviews" page-size="pageSize" current-page="currentPageGradedLogged"/>
            </div>
        </div>

        <div class="main-row" ng-show="toggleLoggedReviews">
            <span class="col-md-12">
                <a class="btn btn-primary" ng-click="printSelected()">{{'sitnet_print_selected_to_file' |
                    translate}}</a>
                <a class="btn btn-primary" ng-click="archiveSelected()">{{'sitnet_archive_selected' | translate}}</a>
            </span>
        </div>

        <div class="main-row" ng-if="archivedReviews.length > 0">
            <div class="col-md-12">
                <a class="exams-list-title-text bottom-padding-2 pointer" ng-click="view.filter = 'ARCHIVED'">
                    {{'sitnet_archived_exams' | translate}} ({{archivedReviews.length}})
                </a>
            </div>
        </div>
    </div>

    <div ng-if="view.filter === 'ARCHIVED'">
        <div class="main-row">
            <span class="col-md-12">
                <span class="exams-list-title-text pointer">
                    {{'sitnet_archived_exams' | translate}}
                </span>
            </span>
        </div>
        <div class="indented-row" ng-show="archivedReviews.length === 0">
            <div class="col-md-12 text">N/A</div>
        </div>
        <div class="col-md-12" ng-show="archivedReviews.length > 0">
            <table class="table table-bordered table-striped exams-table">
                <thead>
                <tr>
                    <th colspan="2">{{'sitnet_student' | translate }}</th>
                    <th>{{'sitnet_exam_duration' | translate}}</th>
                    <th>{{'sitnet_grade' | translate }}</th>
                    <th>{{'sitnet_exam_credit' | translate}}</th>
                    <th>{{'sitnet_graded' | translate }}</th>
                </tr>
                </thead>

                <tbody>
                <tr ng-repeat="review in archivedReviews | offset: currentPageArchived*pageSize | limitTo: pageSize">
                    <td class="table-column-13 table-column-bold">
                        <a class="pointer" ng-click="go(review.exam)">
                            {{review.user.firstName}} {{review.user.lastName}}
                            <span ng-if="review.user.userIdentifier"><br/>({{review.user.userIdentifier}})</span>
                        </a>
                    </td>
                    <td class="table-column-15"><a class="pointer" href="mailto:{{review.user.email}}">{{review.user.email}}</a>
                    </td>
                    <td class="table-column-20">{{review.started | date: 'dd.MM.yyyy'}} {{'sitnet_clock_short' |
                        translate}} {{review.started | date: 'HH:mm'}} - {{review.ended | date: 'HH:mm'}}
                        ({{review.started | diffInMinutesTo:review.ended }}&nbsp;min)
                    </td>
                    <td class="table-column-25">{{translateGrade(review.exam)}}</td>
                    <td class="table-column-10">
                        {{ printExamCredit(review.exam.course.credits, review.exam.customCredit) }}
                    </td>
                    <td class="table-column-15">{{review.exam.gradedTime | date:'dd.MM.yyyy'}}</td>
                </tr>
                <!--Fill if page not full-->
                <tr ng-repeat="r in [] | pagefill: archivedReviews.length:currentPageArchived:pageSize">
                    <td class="table-column-examname">&nbsp;</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="detail-row">
            <div col-md-12 ng-show="archivedReviews.length > pageSize">
                <paginator items="archivedReviews" page-size="pageSize" current-page="currentPageArchived"/>
            </div>
        </div>
    </div>
</div>