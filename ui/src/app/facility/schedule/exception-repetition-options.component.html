<!--
SPDX-FileCopyrightText: 2024 The members of the EXAM Consortium

SPDX-License-Identifier: EUPL-1.2
-->

<div class="row align-items-center">
    <div class="col">
        @if (mode() === REPEAT_OPTION.once) {
            <div class="mt-2 mb-3">{{ 'i18n_repeats_once' | translate }}</div>
        }
        <div class="row mt-2">
            <div class="col">
                <label for="startDate">{{ 'i18n_begin' | translate }}:</label>
                <xm-date-time-picker
                    id="startDate"
                    [initialTime]="startDate()"
                    [hourStep]="1"
                    [minuteStep]="15"
                    [disableTime]="wholeDay()"
                    (updated)="startChanged($event)"
                >
                </xm-date-time-picker>
            </div>
            <div class="col">
                <label for="endDate">{{ 'i18n_end' | translate }}:</label>
                <xm-date-time-picker
                    id="endDate"
                    [initialTime]="endDate()"
                    [hourStep]="1"
                    [minuteStep]="15"
                    [disableTime]="wholeDay()"
                    (updated)="endChanged($event)"
                >
                </xm-date-time-picker>
            </div>
        </div>
    </div>
    @if (mode() === REPEAT_OPTION.daily_weekly) {
        <div class="col">
            <div class="mt-2 mb-3">{{ 'i18n_repeats_weekly_or_every_day' | translate }}</div>
            <div class="row">
                <div class="col">
                    <button (click)="selectWholeWeek()" class="btn btn-sm btn-outline-secondary">
                        {{ 'i18n_select_week' | translate }}
                    </button>
                    <div class="my-2">
                        @for (day of weekdays(); track day.ord; let index = $index) {
                            <button
                                class="badge pointer ms-1 blue-shadow-hover border-none"
                                (click)="weekdaySelected(day.selected, index)"
                                [class]="day.selected ? 'bg-success' : 'background-gray text-black'"
                            >
                                {{ day.day.slice(0, 2) }}
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
    @if (mode() === REPEAT_OPTION.monthly || mode() === REPEAT_OPTION.yearly) {
        <ng-template #yearView>
            @if (!useOrdinals()) {
                {{ 'i18n_day' | translate }}
            }
            {{ 'i18n_of_every' | translate }}
            <span class="dropdown" ngbDropdown>
                <button
                    ngbDropdownToggle
                    class="btn btn-outline-secondary me-1 mb-1"
                    type="button"
                    aria-expanded="true"
                >
                    {{ monthOfYear().name }}&nbsp;<span class="caret"></span>
                </button>
                <div ngbDropdownMenu style="padding-left: 0; min-width: 17em" role="menu" aria-labelledby="monthOfYear">
                    @for (swd of months(); track swd.ord; let index = $index) {
                        <button
                            ngbDropdownItem
                            role="presentation"
                            class="pointer"
                            (click)="monthOfYearChanged(index)"
                            (keydown.enter)="monthOfYearChanged(index)"
                        >
                            <a role="menuitem" title="{{ swd.month }}">{{ swd.month }}</a>
                        </button>
                    }
                </div>
            </span>
        </ng-template>
        <div class="col">
            @if (mode() === REPEAT_OPTION.monthly) {
                <div class="mt-2 mb-3">{{ 'i18n_repeats_monthly' | translate }}</div>
            } @else {
                <div class="mt-2 mb-3">{{ 'i18n_repeats_yearly' | translate }}</div>
            }
            <div class="row">
                <div class="col mb-3">
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="radio"
                            [ngModel]="useOrdinals()"
                            (ngModelChange)="useOrdinalsChanged()"
                            [value]="false"
                        />
                        <input
                            type="number"
                            class="ms-1 me-1 mb-1"
                            min="1"
                            max="31"
                            [ngModel]="dayOfMonth()"
                            (ngModelChange)="dayOfMonthChanged($event)"
                            [disabled]="useOrdinals()"
                        />
                        {{ 'i18n_day' | translate }}
                        @if (mode() === REPEAT_OPTION.yearly) {
                            <ng-container [ngTemplateOutlet]="yearView"></ng-container>
                        }
                    </div>
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="radio"
                            checked
                            [ngModel]="useOrdinals()"
                            (ngModelChange)="useOrdinalsChanged()"
                            [value]="true"
                        />
                        {{ 'i18n_of_month' | translate }}
                        <span class="dropdown" ngbDropdown>
                            <button
                                ngbDropdownToggle
                                class="btn btn-outline-secondary me-1 mb-1"
                                type="button"
                                aria-expanded="true"
                                [disabled]="!useOrdinals()"
                            >
                                {{ 'i18n_' + monthlyOrdinal().name.toLowerCase() | translate | lowercase }}&nbsp;<span
                                    class="caret"
                                ></span>
                            </button>
                            <div ngbDropdownMenu role="menu" aria-labelledby="selectWeekdayOrdinal">
                                @for (ord of ordinals; track ord.ord; let index = $index) {
                                    <button
                                        ngbDropdownItem
                                        role="presentation"
                                        class="pointer"
                                        (click)="monthlyOrdinalChanged(index)"
                                        (keydown.enter)="monthlyOrdinalChanged(index)"
                                    >
                                        <a role="menuitem" title="{{ 'i18n_' + ord.name.toLowerCase() | translate }}">{{
                                            'i18n_' + ord.name.toLowerCase() | translate | lowercase
                                        }}</a>
                                    </button>
                                }
                            </div>
                        </span>
                        <span class="dropdown" ngbDropdown>
                            <button
                                ngbDropdownToggle
                                class="btn btn-outline-secondary me-1 mb-1"
                                type="button"
                                aria-expanded="true"
                                [disabled]="!useOrdinals()"
                            >
                                {{ weekdayOfMonth().name }}&nbsp;<span class="caret"></span>
                            </button>
                            <div
                                ngbDropdownMenu
                                style="padding-left: 0; min-width: 17em"
                                role="menu"
                                aria-labelledby="weekdayOfMonth"
                            >
                                @for (swd of weekdays(); track swd.ord; let index = $index) {
                                    <button
                                        ngbDropdownItem
                                        role="presentation"
                                        class="pointer"
                                        (click)="weekdayOfMonthChanged(index)"
                                        (keydown.enter)="weekdayOfMonthChanged(index)"
                                    >
                                        <a role="menuitem" title="{{ swd.day }}">{{ swd.day }}</a>
                                    </button>
                                }
                            </div>
                        </span>
                        @if (mode() === REPEAT_OPTION.yearly) {
                            <ng-container [ngTemplateOutlet]="yearView"></ng-container>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>
