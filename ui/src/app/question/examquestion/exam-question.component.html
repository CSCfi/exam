<!--
SPDX-FileCopyrightText: 2024 The members of the EXAM Consortium

SPDX-License-Identifier: EUPL-1.2
-->

<div class="modal-header">
    <span class="xm-modal-title">{{ 'i18n_questions_edit' | translate }}</span>
</div>

<div class="modal-body">
    <div class="row">
        <div class="col-md-12">
            <form role="form" class="form-horizontal" [formGroup]="questionForm" name="form">
                <xm-question-usage [examNames]="examNames()" />
                <xm-question-basic-info
                    [question]="question()"
                    [questionTypes]="[]"
                    [questionId]="question()?.id"
                    (newText)="setText($event)"
                />

                @if (question()?.type === 'EssayQuestion' && examQuestion(); as eq) {
                    <xm-eq-essay
                        [(evaluationType)]="eq.evaluationType"
                        [(expectedWordCount)]="eq.expectedWordCount"
                        [(evaluationCriteria)]="eq.evaluationCriteria"
                        [lotteryOn]="lotteryOn()"
                        (evaluationTypeChange)="updateEvaluationType($event)"
                    />
                }

                <!-- Multiple choices - title -->
                @if (
                    question()?.type === 'MultipleChoiceQuestion' ||
                    question()?.type === 'WeightedMultipleChoiceQuestion' ||
                    question()?.type === 'ClaimChoiceQuestion'
                ) {
                    <div class="row mt-3 mb-2">
                        <div class="col-md-12 pe-0">
                            <div class="xm-paragraph-title edit-warning-container">
                                {{ 'i18n_question_options' | translate }}
                                @if (showWarning() && question()?.type !== 'MultipleChoiceQuestion') {
                                    <i class="bi-exclamation-circle ps-4 text-danger"></i>
                                    <span class="warning-text-small ps-2">
                                        {{ 'i18n_shared_question_property_info' | translate }}
                                    </span>
                                }
                            </div>
                        </div>
                    </div>
                }

                <!-- Type specific content - weighted multiple choice -->
                @if (question()?.type === 'WeightedMultipleChoiceQuestion') {
                    <xm-eq-weighted-mc
                        [(question)]="examQuestion"
                        [lotteryOn]="lotteryOn()"
                        [isInPublishedExam]="isInPublishedExam()"
                    />
                }

                @if (question()?.type === 'MultipleChoiceQuestion') {
                    <xm-eq-unweighted-mc
                        [(question)]="examQuestion"
                        [lotteryOn]="lotteryOn()"
                        [isInPublishedExam]="isInPublishedExam()"
                    />
                }

                <!-- Type specific content - claim choice option -->
                @if (question()?.type === 'ClaimChoiceQuestion' && examQuestion(); as eq) {
                    <xm-eq-claim-choice [(options)]="eq.options" [lotteryOn]="lotteryOn()" />
                }

                <!-- Max score -->
                @if (
                    (question()?.type === 'MultipleChoiceQuestion' ||
                        question()?.type === 'ClozeTestQuestion' ||
                        examQuestion()?.evaluationType === 'Points') &&
                        examQuestion();
                    as eq
                ) {
                    <div class="row mt-2">
                        <div class="col-md-3">
                            {{ 'i18n_max_score' | translate }}
                        </div>
                        <div class="col-md-2">
                            <input
                                id="maxScore"
                                name="maxScore"
                                type="number"
                                step="any"
                                lang="en"
                                class="form-control xm-numeric-input"
                                formControlName="maxScore"
                                [min]="0"
                                [max]="1000"
                                required
                                xmFixedPrecision
                            />
                        </div>
                    </div>
                }

                <!-- Additional info, no editable tags or users so tag has no children -->
                @if (additionalInfoConfig()) {
                    <xm-question-additional-info [config]="additionalInfoConfig()!" />
                }
            </form>
        </div>
    </div>
</div>
<div class="d-flex flex-row-reverse flex-align-r m-3">
    <button
        [disabled]="questionForm.invalid || hasInvalidClaimChoiceOptions() || !question()?.question"
        (click)="save()"
        type="submit"
        class="btn btn-success"
    >
        {{ 'i18n_save' | translate }}
    </button>
    <button (click)="cancel()" type="submit" class="btn btn-outline-secondary me-3">
        {{ 'i18n_button_cancel' | translate }}
    </button>
    <!--button
            (click)="openPreview()"
            type="submit"
            class="btn btn-outline-secondary me-3"
            [disabled]="questionForm.invalid || hasInvalidClaimChoiceOptions()"
        >
            {{ 'i18n_button_preview' | translate }}
        </button-->
</div>
