<!--
SPDX-FileCopyrightText: 2024 The members of the EXAM Consortium

SPDX-License-Identifier: EUPL-1.2
-->
<div cdkDrag [cdkDragConstrainPosition]="fixPosition" class="wrapper" [hidden]="shouldHide()">
    <div class="row align-items-center">
        <div class="col-1">
            <button
                type="button"
                class="border-none background-none"
                (click)="toggleVisibility()"
                [attr.aria-label]="(hideEditor() ? 'i18n_show' : 'i18n_hide') | translate"
                [attr.aria-expanded]="!hideEditor()"
                ngbPopover="{{ (hideEditor() ? 'i18n_show' : 'i18n_hide') | translate }}"
                triggers="mouseenter:mouseleave"
            >
                <i [ngClass]="hideEditor() ? 'bi-chevron-right' : 'bi-chevron-down'" aria-hidden="true"></i>
            </button>
        </div>
        <div class="col-11">{{ title | translate }}</div>
    </div>
    <div [ngbCollapse]="hideEditor()" class="body">
        <div class="row mt-2 mb-1">
            <div class="col-md-12">
                <xm-ckeditor
                    id="feedback-editor"
                    [data]="editorContent"
                    (dataChange)="commentChanged($event)"
                    name="ck"
                ></xm-ckeditor>
            </div>
        </div>
        @if (attachment()) {
        <div class="d-flex justify-content-end">
            <button
                type="button"
                class="btn btn-link"
                (click)="downloadAttachment()"
                [attr.aria-label]="'i18n_download_attachment' | translate"
            >
                {{ attachment()?.fileName }}
            </button>
            <button
                type="button"
                class="border-none background-none"
                (click)="removeAttachment()"
                [attr.aria-label]="'i18n_remove_attachment' | translate"
            >
                <i class="bi-x text-danger" aria-hidden="true" title="{{ 'i18n_remove_attachment' | translate }}"></i>
            </button>
        </div>
        }
        <div class="d-flex justify-content-between flex-row-reverse mt-2">
            <button class="btn btn-outline-success" (click)="save()">{{ 'i18n_save' | translate }}</button>
            <button type="button" class="btn btn-outline-secondary" (click)="selectFile()">
                {{ 'i18n_attach_file' | translate }}
            </button>
        </div>
    </div>
</div>
