<div class="row student-enrolment-wrapper details-view" [ngClass]="selectedRoom ? '' : 'notactive'">
    <div class="col-md-12">
        <div class="row">
            <span class="col-md-11 col-9">
                <h2 class="calendar-phase-title">{{ sequenceNumber }}. {{ 'i18n_calendar_phase_2' | translate }}</h2>
            </span>
            <span class="col-md-1 col-3">
                @if (selectedRoom) {
                    <span class="calendar-phase-icon float-end">
                        <img class="arrow_icon" src="/assets/images/icon-phase.png" alt="" />
                    </span>
                }
            </span>
        </div>
        <div class="row mt-2 mb-2">
            <!-- todo: make this a component -->
            <div class="col-md-12 mt-2 mb-2" [hidden]="isExternal">
                <div class="row">
                    <span class="col-md-12">
                        @if (!disabled) {
                            <button
                                class="infolink pointer border rounded"
                                (click)="showAccessibilityMenu.set(!showAccessibilityMenu())"
                                (keydown.enter)="showAccessibilityMenu.set(!showAccessibilityMenu())"
                                [attr.aria-expanded]="showAccessibilityMenu()"
                            >
                                {{ 'i18n_calendar_room_accessibility_info' | translate }}
                                @if (!showAccessibilityMenu()) {
                                    <img class="arrow_icon" aria-hidden="true" src="/assets/images/arrow_right.png" />
                                }
                                @if (showAccessibilityMenu()) {
                                    <img class="arrow_icon" aria-hidden="true" src="/assets/images/arrow_down.png" />
                                }
                            </button>
                        }
                        @if (disabled) {
                            <span class="text text-muted">
                                {{ 'i18n_calendar_room_accessibility_info' | translate }}
                            </span>
                        }
                        <div [ngbCollapse]="!showAccessibilityMenu()">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="calendar-accs-title">
                                        {{ 'i18n_exam_room_accessibility' | translate }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 calendar-accs-checkboxes">
                                    @for (accessibility of accessibilities(); track accessibility.id) {
                                        <span class="me-2 accs-list">
                                            <label for="{{ accessibility.name }}">
                                                <input
                                                    id="{{ accessibility.name }}"
                                                    type="checkbox"
                                                    (click)="selectAccessibility(accessibility)"
                                                    value="{{ accessibility.name }}"
                                                />
                                            </label>
                                            {{ accessibility.name }}
                                        </span>
                                    }
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
            </div>
        </div>
        <div class="row ms-1 mt-3">
            <div class="col" ngbDropdown>
                <button
                    ngbDropdownToggle
                    class="btn btn-outline-dark"
                    type="button"
                    id="dropDownMenu1"
                    aria-expanded="true"
                    [disabled]="(isExternal && !organisation) || disabled"
                >
                    {{ isExternal ? ('i18n_external_room' | translate) : ('i18n_room' | translate) }}
                    <span class="caret"></span>
                </button>
                <div ngbDropdownMenu role="menu" aria-labelledby="dropDownMenu1" class="scrollable-menu">
                    @for (room of rooms(); track room.id) {
                        <button ngbDropdownItem role="presentation" (click)="selectRoom(room)" title="{{ room.name }}">
                            <div ngbDropdownItem [disabled]="room.outOfService" role="menuitem">
                                <a> {{ room.name }}</a>
                            </div>
                        </button>
                    }
                </div>
            </div>
            <div class="col ps-0">
                @if (isInteroperable && !isExternal) {
                    <button class="btn btn-outline-dark" (click)="makeExternalReservation()">
                        {{ 'i18n_external_reservation' | translate }}&nbsp;
                    </button>
                }
            </div>
        </div>
        @if (selectedRoom) {
            <div class="row mt-2">
                <div class="col-md-12">
                    <xm-calendar-selected-room
                        [room]="selectedRoom"
                        [viewStart]="currentWeek()"
                        [maintenancePeriods]="maintenancePeriods()"
                    ></xm-calendar-selected-room>
                </div>
            </div>
        }
        @if (selectedRoom) {
            <div class="row mt-2">
                <div class="col-md-12">
                    <xm-booking-calendar
                        (eventSelected)="eventSelected($event)"
                        (moreEventsNeeded)="refresh($event)"
                        [minDate]="minDate"
                        [maxDate]="maxDate"
                        [room]="selectedRoom"
                        [accessibilities]="accessibilities()"
                        [visible]="selectedRoom !== undefined"
                    >
                    </xm-booking-calendar>
                </div>
            </div>
        }
    </div>
</div>
