<table class="table table-striped table-condensed exams-table mar60">
    <thead>
        <tr>
            <th class="reservation-search">
                <table-sort by="userAggregate" text="sitnet_student" [predicate]="predicate" [reverse]="reverse"
                    (click)="setPredicate('userAggregate')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="enrolment.exam.name" text="sitnet_exam" [predicate]="predicate" [reverse]="reverse"
                    (click)="setPredicate('enrolment.exam.name')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="enrolment.exam.course.code" text="sitnet_examcode" [predicate]="predicate"
                    [reverse]="reverse" (click)="setPredicate('enrolment.exam.course.code')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="enrolment.teacherAggregate" text="sitnet_teachers" [predicate]="predicate"
                    [reverse]="reverse" (click)="setPredicate('enrolment.teachereAggregate')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="startAt" text="sitnet_date_time" [predicate]="predicate" [reverse]="reverse"
                    (click)="setPredicate('startAt')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="machine.room.name" text="sitnet_examination_location_and_machine"
                    [predicate]="predicate" [reverse]="reverse" (click)="setPredicate('machine.room.name')">
                </table-sort>
            </th>
            <th class="reservation-search">
                <table-sort by="stateOrd" text="sitnet_exam_state" [predicate]="predicate" [reverse]="reverse"
                    (click)="setPredicate('stateOrd')">
                </table-sort>
            </th>
            <th class="reservation-search" *ngIf="isAdminView">{{'sitnet_remove_reservation' | translate}}</th>
            <th class="reservation-search" *ngIf="isAdminView">{{'sitnet_change_reservation_machine' | translate}}
            </th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let r of reservations | orderBy:predicate:reverse:'case-insensitive'">
            <td class="reservation-search">
                <span>{{r.userAggregate}}</span>
                <span *ngIf="r.user.userIdentifier">&nbsp;({{r.user.userIdentifier}})</span>
                <span *ngIf="r.user">
                    <br />
                    <a class="reservation" href="mailto:{{r.user.email}}">{{r.user.email}}</a>
                </span>
                <span *ngIf="r.externalUserRef">
                    <a class="reservation" href="mailto:{{r.externalUserRef}}">{{r.externalUserRef}}</a>
                </span>
            </td>

            <td class="reservation-search" *ngIf="r.enrolment.exam.state === 'PUBLISHED'">{{ r.enrolment.exam.name }}
            </td>
            <td class="reservation-search" *ngIf="!r.enrolment.exam.external && r.enrolment.exam.state !== 'PUBLISHED'">
                <a href="/assessments/{{r.enrolment.exam.id}}">{{r.enrolment.exam.name}}</a>
            </td>
            <td class="reservation-search text-primary" *ngIf="r.enrolment.exam.external">
                {{'sitnet_exam_status_external' | translate}}</td>

            <td class="reservation-search" *ngIf="!r.enrolment.exam.external">{{ r.enrolment.exam.course.code }}</td>
            <td class="reservation-search text-primary" *ngIf="r.enrolment.exam.external">
                {{'sitnet_exam_status_external' | translate}}</td>

            <td *ngIf="r.enrolment.exam.parent" class="width15">
                <teacher-list [exam]="r.enrolment.exam" [useParent]="true"></teacher-list>
            </td>
            <td class="reservation-search" *ngIf="!r.enrolment.exam.external && !r.enrolment.exam.parent"
                class="width15">
                <teacher-list [exam]="r.enrolment.exam"></teacher-list>
            </td>
            <td class="reservation-search text-primary" *ngIf="r.enrolment.exam.external" class="width15">
                {{'sitnet_exam_status_external' | translate}}
            </td>
            <td class="reservation-search">{{r.startAt | applyDst | date:'dd.MM.yyyy'}}
                <br />{{r.startAt | applyDst | date:'HH:mm'}}-{{r.endAt | applyDst | date:'HH:mm'}}
            </td>
            <td class="reservation-search">
                {{r.machine.room.name}}
                <span *ngIf="r.org">,&nbsp;{{ r.org.name }} ({{ r.org.code }})</span>
                <br />{{r.machine.name}}</td>
            <td class="reservation-search" [ngClass]="getStateClass(r)">
                {{'sitnet_exam_status_' + printExamState(r) | lowercase | translate}}</td>

            <td class="reservation-search" *ngIf="isAdminView">
                <button *ngIf="r.enrolment.exam.state === 'PUBLISHED' && !r.noShow" (click)="removeReservation(r)"
                    class="btn btn-primary pull-left">
                    {{'sitnet_remove_reservation' | translate}}
                </button>
                <button *ngIf="r.enrolment.exam.state === 'ABORTED' || r.noShow" (click)="permitRetrial(r)"
                    [disabled]="!r.enrolment.exam.trialCount || r.retrialPermitted" class="btn btn-primary pull-left">
                    {{'sitnet_permit_retrial' | translate}}
                </button>
            </td>
            <td class="reservation-search" *ngIf="isAdminView">
                <button *ngIf="r.enrolment.exam.state === 'PUBLISHED' && !r.noShow"
                    (click)="changeReservationMachine(r)" class="btn btn-primary pull-left">
                    {{'sitnet_change_reservation_machine' | translate}}
                </button>
            </td>
        </tr>
    </tbody>
</table>